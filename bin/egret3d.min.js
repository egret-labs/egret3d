"use strict";var __reflect=this&&this.__reflect||function(e,t,r){e.__class__=t,r?r.push(t):r=[t],e.__types__=e.__types__?r.concat(e.__types__):r},__extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);r.prototype=t.prototype,e.prototype=new r},__decorate=this&&this.__decorate||function(e,t,r,a){var i,n=arguments.length,s=3>n?t:null===a?a=Object.getOwnPropertyDescriptor(t,r):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,a);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(s=(3>n?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},__awaiter=this&&this.__awaiter||function(e,t,r,a){return new(r||(r=Promise))(function(i,n){function s(e){try{h(a.next(e))}catch(t){n(t)}}function o(e){try{h(a["throw"](e))}catch(t){n(t)}}function h(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,o)}h((a=a.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function r(e){return function(t){return a([e,t])}}function a(r){if(i)throw new TypeError("Generator is already executing.");for(;h;)try{if(i=1,n&&(s=n[2&r[0]?"return":r[0]?"throw":"next"])&&!(s=s.call(n,r[1])).done)return s;switch(n=0,s&&(r=[0,s.value]),r[0]){case 0:case 1:s=r;break;case 4:return h.label++,{value:r[1],done:!1};case 5:h.label++,n=r[1],r=[0];continue;case 7:r=h.ops.pop(),h.trys.pop();continue;default:if(s=h.trys,!(s=s.length>0&&s[s.length-1])&&(6===r[0]||2===r[0])){h=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){h.label=r[1];break}if(6===r[0]&&h.label<s[1]){h.label=s[1],s=r;break}if(s&&h.label<s[2]){h.label=s[2],h.ops.push(r);break}s[2]&&h.ops.pop(),h.trys.pop();continue}r=t.call(e,h)}catch(a){r=[6,a],n=0}finally{i=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var i,n,s,o,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:r(0),"throw":r(1),"return":r(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o},paper;!function(e){function t(e){return function(t){var r=t.prototype;if(i.indexOf(r)>=0){var a=r.__serializedType;a.indexOf(e)<0&&a.push(e)}else r.__serializedType=[e],i.push(r)}}function r(e,t){if(n.indexOf(e)>=0){var r=e.__serialized;r.indexOf(t)<0&&r.push(t)}else e.__serialized=[t],n.push(e)}function a(e,t){if(s.indexOf(e)>=0){var r=e.__deserializedIgnore;r.indexOf(t)<0&&r.push(t)}else e.__deserializedIgnore=[t],s.push(e)}var i=[],n=[],s=[];e.serializedType=t,e.serializedField=r,e.deserializedIgnore=a}(paper||(paper={}));var egret3d;!function(e){var t=function(){function t(e,t,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),this.x=e,this.y=t,this.z=r}return t.prototype.serialize=function(){return[this.x,this.y,this.z]},t.prototype.deserialize=function(e){this.x=e[0],this.y=e[1],this.z=e[2]},t.set=function(e,t,r,a){return a.x=e,a.y=t,a.z=r,a},t.normalize=function(e){var r=t.getLength(e);return r>Number.MIN_VALUE?(e.x=e.x/r,e.y=e.y/r,e.z=e.z/r):(e.x=0,e.y=0,e.z=0),e},t.copy=function(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t},t.add=function(e,t,r){return r.x=e.x+t.x,r.y=e.y+t.y,r.z=e.z+t.z,r},t.subtract=function(e,t,r){return r.x=e.x-t.x,r.y=e.y-t.y,r.z=e.z-t.z,r},t.multiply=function(e,t,r){return r.x=e.x*t.x,r.y=e.y*t.y,r.z=e.z*t.z,r},t.scale=function(e,t){return e.x=e.x*t,e.y=e.y*t,e.z=e.z*t,e},t.cross=function(e,t,r){return r.x=e.y*t.z-e.z*t.y,r.y=e.z*t.x-e.x*t.z,r.z=e.x*t.y-e.y*t.x,r},t.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},t.getLength=function(e){return Math.sqrt(this.getSqrLength(e))},t.getSqrLength=function(e){return e.x*e.x+e.y*e.y+e.z*e.z},t.getDistance=function(t,r){return this.subtract(t,r,e.helpVector3H),this.getLength(e.helpVector3H)},t.min=function(e,t,r){return r.x=Math.min(e.x,t.x),r.y=Math.min(e.y,t.y),r.z=Math.min(e.z,t.z),r},t.max=function(e,t,r){return r.x=Math.max(e.x,t.x),r.y=Math.max(e.y,t.y),r.z=Math.max(e.z,t.z),r},t.lerp=function(e,t,r,a){return a.x=e.x*(1-r)+t.x*r,a.y=e.y*(1-r)+t.y*r,a.z=e.z*(1-r)+t.z*r,a},t.equal=function(e,t,r){return void 0===r&&(r=1e-5),Math.abs(e.x-t.x)>r?!1:Math.abs(e.y-t.y)>r?!1:Math.abs(e.z-t.z)>r?!1:!0},t.ONE=new t(1,1,1),t}();e.Vector3=t,__reflect(t.prototype,"egret3d.Vector3",["paper.ISerializable"]),e.helpVector3A=new t,e.helpVector3B=new t,e.helpVector3C=new t,e.helpVector3D=new t,e.helpVector3E=new t,e.helpVector3F=new t,e.helpVector3G=new t,e.helpVector3H=new t}(egret3d||(egret3d={}));var paper;!function(e){var t=1,r=function(){function e(){this.hashCode=t++}return e.prototype.serialize=function(){console.warn("Unimplemented serialize method.")},e.prototype.deserialize=function(e){console.warn("Unimplemented deserialize method.")},e}();e.SerializableObject=r,__reflect(r.prototype,"paper.SerializableObject",["paper.IHashCode","paper.ISerializable"])}(paper||(paper={}));var paper;!function(e){var t=function(){function t(){if(this.enable=!0,this._level=0,this._interestComponentCount=0,this._interests=[],this._components=[],this._gameObjectOffsets={},!t._createEnabled)throw new Error("Create an instance of a system is not allowed.");t._createEnabled=!1}return t.prototype._onCreateComponent=function(e){for(var t=this._components,r=t.length,a=e.gameObject,i=0,n=this._interests;i<n.length;i++){var s=n[i],o=a.getComponent(s.componentClass);if(!o||t.indexOf(o)>=0)return t.length=r,!1;t.push(o)}return this._gameObjectOffsets[a.hashCode]=r,!0},t.prototype._onDestroyComponent=function(e){var t=e.gameObject;if(!(t.hashCode in this._gameObjectOffsets))return!1;var r=this._interestComponentCount,a=this._components,i=a.length,n=this._gameObjectOffsets[t.hashCode];if(i>r){for(var s=null,o=0;r>o;++o)s||(s=a[i-r].gameObject),a[n+o]=a[i-r+o];s&&(this._gameObjectOffsets[s.hashCode]=n)}return a.length-=r,delete this._gameObjectOffsets[t.hashCode],!0},t.prototype._getComponent=function(e,t){return e.hashCode in this._gameObjectOffsets?this._components[this._gameObjectOffsets[e.hashCode]+t]:null},t.prototype.initialize=function(){for(var t=this,r=0,a=this._interests;r<a.length;r++){var i=a[r];if(i.listeners)for(var n=0,s=i.listeners;n<s.length;n++){var o=s[n];e.EventPool.addEventListener(o.type,i.componentClass,o.listener)}this._interestComponentCount++,e.EventPool.addEventListener("__create__",i.componentClass,function(e){t._onCreateComponent(e)}),e.EventPool.addEventListener("__destroy__",i.componentClass,function(e){t._onDestroyComponent(e)})}},t.prototype.uninitialize=function(){this._components.length=0;for(var e in this._gameObjectOffsets)delete this._gameObjectOffsets[e]},Object.defineProperty(t.prototype,"components",{get:function(){return this._components},enumerable:!0,configurable:!0}),t._createEnabled=!1,t}();e.BaseSystem=t,__reflect(t.prototype,"paper.BaseSystem")}(paper||(paper={}));var egret3d;!function(e){var t=new e.Vector3,r=function(){function r(e){void 0===e&&(e=null),e?this.rawData=e:this.rawData=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return r.set=function(e,t,r,a,i,n,s,o,h,l,c,u,p,d,f,_,g){return g.rawData[0]=e,g.rawData[1]=i,g.rawData[2]=h,g.rawData[3]=p,g.rawData[4]=t,g.rawData[5]=n,g.rawData[6]=l,g.rawData[7]=d,g.rawData[8]=r,g.rawData[9]=s,g.rawData[10]=c,g.rawData[11]=f,g.rawData[12]=a,g.rawData[13]=o,g.rawData[14]=u,g.rawData[15]=_,g},r.getScale=function(e,t){return t.x=e.rawData[0],t.y=e.rawData[5],t.z=e.rawData[10],t},r.getTranslation=function(e,t){return t.x=e.rawData[12],t.y=e.rawData[13],t.z=e.rawData[14],t},r.getQuaternion=function(e,t){var r,a=e.rawData,i=a[0],n=a[4],s=a[8],o=a[1],h=a[5],l=a[9],c=a[2],u=a[6],p=a[10],d=i+h+p;return d>0?(r=.5/Math.sqrt(d+1),t.w=.25/r,t.x=(u-l)*r,t.y=(s-c)*r,t.z=(o-n)*r):i>h&&i>p?(r=2*Math.sqrt(1+i-h-p),t.w=(u-l)/r,t.x=.25*r,t.y=(n+o)/r,t.z=(s+c)/r):h>p?(r=2*Math.sqrt(1+h-i-p),t.w=(s-c)/r,t.x=(n+o)/r,t.y=.25*r,t.z=(l+u)/r):(r=2*Math.sqrt(1+p-i-h),t.w=(o-n)/r,t.x=(s+c)/r,t.y=(l+u)/r,t.z=.25*r),t},r.add=function(e,t,r){return r.rawData[0]=e.rawData[0]+t.rawData[0],r.rawData[1]=e.rawData[1]+t.rawData[1],r.rawData[2]=e.rawData[2]+t.rawData[2],r.rawData[3]=e.rawData[3]+t.rawData[3],r.rawData[4]=e.rawData[4]+t.rawData[4],r.rawData[5]=e.rawData[5]+t.rawData[5],r.rawData[6]=e.rawData[6]+t.rawData[6],r.rawData[7]=e.rawData[7]+t.rawData[7],r.rawData[8]=e.rawData[8]+t.rawData[8],r.rawData[9]=e.rawData[9]+t.rawData[9],r.rawData[10]=e.rawData[10]+t.rawData[10],r.rawData[11]=e.rawData[11]+t.rawData[11],r.rawData[12]=e.rawData[12]+t.rawData[12],r.rawData[13]=e.rawData[13]+t.rawData[13],r.rawData[14]=e.rawData[14]+t.rawData[14],r.rawData[15]=e.rawData[15]+t.rawData[15],r},r.multiply=function(e,t,r){var a=e.rawData[0],i=e.rawData[1],n=e.rawData[2],s=e.rawData[3],o=e.rawData[4],h=e.rawData[5],l=e.rawData[6],c=e.rawData[7],u=e.rawData[8],p=e.rawData[9],d=e.rawData[10],f=e.rawData[11],_=e.rawData[12],g=e.rawData[13],m=e.rawData[14],v=e.rawData[15],y=t.rawData[0],w=t.rawData[1],b=t.rawData[2],x=t.rawData[3];return r.rawData[0]=y*a+w*o+b*u+x*_,r.rawData[1]=y*i+w*h+b*p+x*g,r.rawData[2]=y*n+w*l+b*d+x*m,r.rawData[3]=y*s+w*c+b*f+x*v,y=t.rawData[4],w=t.rawData[5],b=t.rawData[6],x=t.rawData[7],r.rawData[4]=y*a+w*o+b*u+x*_,r.rawData[5]=y*i+w*h+b*p+x*g,r.rawData[6]=y*n+w*l+b*d+x*m,r.rawData[7]=y*s+w*c+b*f+x*v,y=t.rawData[8],w=t.rawData[9],b=t.rawData[10],x=t.rawData[11],r.rawData[8]=y*a+w*o+b*u+x*_,r.rawData[9]=y*i+w*h+b*p+x*g,r.rawData[10]=y*n+w*l+b*d+x*m,r.rawData[11]=y*s+w*c+b*f+x*v,y=t.rawData[12],w=t.rawData[13],b=t.rawData[14],x=t.rawData[15],r.rawData[12]=y*a+w*o+b*u+x*_,r.rawData[13]=y*i+w*h+b*p+x*g,r.rawData[14]=y*n+w*l+b*d+x*m,r.rawData[15]=y*s+w*c+b*f+x*v,r},r.scale=function(e,t){return t.rawData[0]*=e,t.rawData[1]*=e,t.rawData[2]*=e,t.rawData[3]*=e,t.rawData[4]*=e,t.rawData[5]*=e,t.rawData[6]*=e,t.rawData[7]*=e,t.rawData[8]*=e,t.rawData[9]*=e,t.rawData[10]*=e,t.rawData[11]*=e,t.rawData[12]*=e,t.rawData[13]*=e,t.rawData[14]*=e,t.rawData[15]*=e,t},r.transpose=function(e,t){return t.rawData[1]=e.rawData[4],t.rawData[2]=e.rawData[8],t.rawData[3]=e.rawData[12],t.rawData[4]=e.rawData[1],t.rawData[6]=e.rawData[9],t.rawData[7]=e.rawData[13],t.rawData[8]=e.rawData[2],t.rawData[9]=e.rawData[6],t.rawData[11]=e.rawData[14],t.rawData[12]=e.rawData[3],t.rawData[13]=e.rawData[7],t.rawData[14]=e.rawData[11],t},r.inverse=function(e,t){var r=e.rawData[0],a=e.rawData[1],i=e.rawData[2],n=e.rawData[3],s=e.rawData[4],o=e.rawData[5],h=e.rawData[6],l=e.rawData[7],c=e.rawData[8],u=e.rawData[9],p=e.rawData[10],d=e.rawData[11],f=e.rawData[12],_=e.rawData[13],g=e.rawData[14],m=e.rawData[15],v=p*m-d*g,y=u*m-d*_,w=u*g-p*_,b=c*m-d*f,x=c*g-p*f,T=c*_-u*f,E=o*v-h*y+l*w,A=-(s*v-h*b+l*x),D=s*y-o*b+l*T,S=-(s*w-o*x+h*T),C=1/(r*E+a*A+i*D+n*S),M=h*m-l*g,R=o*m-l*_,L=o*g-h*_,O=s*m-l*f,P=s*g-h*f,z=s*_-o*f,V=h*d-l*p,F=o*d-l*u,B=o*p-h*u,I=s*d-l*c,U=s*p-h*c,N=s*u-o*c;return t.rawData[0]=E*C,t.rawData[4]=A*C,t.rawData[8]=D*C,t.rawData[12]=S*C,t.rawData[1]=-(a*v-i*y+n*w)*C,t.rawData[5]=(r*v-i*b+n*x)*C,t.rawData[9]=-(r*y-a*b+n*T)*C,t.rawData[13]=(r*w-a*x+i*T)*C,t.rawData[2]=(a*M-i*R+n*L)*C,t.rawData[6]=-(r*M-i*O+n*P)*C,t.rawData[10]=(r*R-a*O+n*z)*C,t.rawData[14]=-(r*L-a*P+i*z)*C,t.rawData[3]=-(a*V-i*F+n*B)*C,t.rawData[7]=(r*V-i*I+n*U)*C,t.rawData[11]=-(r*F-a*I+n*N)*C,t.rawData[15]=(r*B-a*U+i*N)*C,t},r.decompose=function(t,r,i,n){n.x=t.rawData[12],n.y=t.rawData[13],n.z=t.rawData[14];var s=e.sign(t.rawData[0]*t.rawData[1]*t.rawData[2]*t.rawData[3])<0?-1:1,o=e.sign(t.rawData[4]*t.rawData[5]*t.rawData[6]*t.rawData[7])<0?-1:1,h=e.sign(t.rawData[8]*t.rawData[9]*t.rawData[10]*t.rawData[11])<0?-1:1;if(r.x=s*Math.sqrt(t.rawData[0]*t.rawData[0]+t.rawData[1]*t.rawData[1]+t.rawData[2]*t.rawData[2]),r.y=o*Math.sqrt(t.rawData[4]*t.rawData[4]+t.rawData[5]*t.rawData[5]+t.rawData[6]*t.rawData[6]),r.z=h*Math.sqrt(t.rawData[8]*t.rawData[8]+t.rawData[9]*t.rawData[9]+t.rawData[10]*t.rawData[10]),0===r.x||0===r.y||0===r.z)return i.x=0,i.y=0,i.z=0,i.w=1,!1;var l=a;return l.rawData[0]=t.rawData[0]/r.x,l.rawData[1]=t.rawData[1]/r.x,l.rawData[2]=t.rawData[2]/r.x,l.rawData[3]=0,l.rawData[4]=t.rawData[4]/r.y,l.rawData[5]=t.rawData[5]/r.y,l.rawData[6]=t.rawData[6]/r.y,l.rawData[7]=0,l.rawData[8]=t.rawData[8]/r.z,l.rawData[9]=t.rawData[9]/r.z,l.rawData[10]=t.rawData[10]/r.z,l.rawData[11]=0,this.getQuaternion(l,i),!0},r.copy=function(e,t){for(var r=0;16>r;r++)t.rawData[r]=e.rawData[r];return t},r.identify=function(e){return e.rawData[0]=1,e.rawData[1]=0,e.rawData[2]=0,e.rawData[3]=0,e.rawData[4]=0,e.rawData[5]=1,e.rawData[6]=0,e.rawData[7]=0,e.rawData[8]=0,e.rawData[9]=0,e.rawData[10]=1,e.rawData[11]=0,e.rawData[12]=0,e.rawData[13]=0,e.rawData[14]=0,e.rawData[15]=1,e},r.zero=function(e){return e.rawData[0]=0,e.rawData[1]=0,e.rawData[2]=0,e.rawData[3]=0,e.rawData[4]=0,e.rawData[5]=0,e.rawData[6]=0,e.rawData[7]=0,e.rawData[8]=0,e.rawData[9]=0,e.rawData[10]=0,e.rawData[11]=0,e.rawData[12]=0,e.rawData[13]=0,e.rawData[14]=0,e.rawData[15]=1,e},r.formScale=function(e,t,r,a){return a.rawData[0]=e,a.rawData[1]=0,a.rawData[2]=0,a.rawData[3]=0,a.rawData[4]=0,a.rawData[5]=t,a.rawData[6]=0,a.rawData[7]=0,a.rawData[8]=0,a.rawData[9]=0,a.rawData[10]=r,a.rawData[11]=0,a.rawData[12]=0,a.rawData[13]=0,a.rawData[14]=0,a.rawData[15]=1,a},r.fromTranslate=function(e,t,r,a){return a.rawData[0]=1,a.rawData[1]=0,a.rawData[2]=0,a.rawData[3]=0,a.rawData[4]=0,a.rawData[5]=1,a.rawData[6]=0,a.rawData[7]=0,a.rawData[8]=0,a.rawData[9]=0,a.rawData[10]=1,a.rawData[11]=0,a.rawData[12]=e,a.rawData[13]=t,a.rawData[14]=r,a.rawData[15]=1,a},r.fromRTS=function(t,r,n,s){var o=a;this.formScale(r.x,r.y,r.z,o);var h=i;return e.Quaternion.toMatrix(n,h),this.multiply(h,o,s),s.rawData[12]=t.x,s.rawData[13]=t.y,s.rawData[14]=t.z,s.rawData[15]=1,s},r.getVector3ByOffset=function(e,t,r){return r.x=e.rawData[t],r.y=e.rawData[t+1],r.z=e.rawData[t+2],r},r.transformVector3=function(e,t,r){var a=e.x*t.rawData[0]+e.y*t.rawData[4]+e.z*t.rawData[8]+t.rawData[12],i=e.x*t.rawData[1]+e.y*t.rawData[5]+e.z*t.rawData[9]+t.rawData[13],n=e.x*t.rawData[2]+e.y*t.rawData[6]+e.z*t.rawData[10]+t.rawData[14],s=e.x*t.rawData[3]+e.y*t.rawData[7]+e.z*t.rawData[11]+t.rawData[15];return r.x=a/s,r.y=i/s,r.z=n/s,r},r.transformNormal=function(e,t,r){var a=e.x*t.rawData[0]+e.y*t.rawData[4]+e.z*t.rawData[8],i=e.x*t.rawData[1]+e.y*t.rawData[5]+e.z*t.rawData[9],n=e.x*t.rawData[2]+e.y*t.rawData[6]+e.z*t.rawData[10];return r.x=a,r.y=i,r.z=n,r},r.lerp=function(e,t,r,a){for(var i=0;16>i;i++)a.rawData[i]=e.rawData[i]*(1-r)+t.rawData[i]*r;return a},r.perspectiveProjectLH=function(e,t,r,a,i){var n=1/Math.tan(.5*e);return i.rawData[0]=n/t,i.rawData[1]=i.rawData[2]=i.rawData[3]=0,i.rawData[4]=i.rawData[6]=i.rawData[7]=0,i.rawData[5]=n,i.rawData[8]=i.rawData[9]=0,i.rawData[10]=(a+r)/(a-r),i.rawData[11]=1,i.rawData[12]=i.rawData[13]=i.rawData[15]=0,i.rawData[14]=-2*(r*a)/(a-r),i},r.orthoProjectLH=function(e,t,r,a,i){var n=2/e,s=2/t,o=2/(a-r),h=(r+a)/(r-a);return i.rawData[0]=n,i.rawData[1]=0,i.rawData[2]=0,i.rawData[3]=0,i.rawData[4]=0,i.rawData[5]=s,i.rawData[6]=0,i.rawData[7]=0,i.rawData[8]=0,i.rawData[9]=0,i.rawData[10]=o,i.rawData[11]=0,i.rawData[12]=0,i.rawData[13]=0,i.rawData[14]=h,i.rawData[15]=1,i},r.toEulerAngles=function(e,a){var i,n,s,o,h,l,c,u,p=t;return r.getScale(e,p),o=p.x,h=p.y,l=p.z,c=e.rawData,n=Math.asin(-c[2]/o),u=.5*Math.PI,u>n?n>-u?(i=Math.atan2(c[6]/h,c[10]/l),s=Math.atan2(c[1]/o,c[0]/o)):(s=0,i=-Math.atan2(c[4]/h,c[5]/h)):(s=0,i=Math.atan2(c[4]/h,c[5]/h)),a.x=180*i/Math.PI,a.y=180*n/Math.PI,a.z=180*s/Math.PI,a},r.determinant=function(e){var t=e.rawData,r=t[0],a=t[4],i=t[8],n=t[12],s=t[1],o=t[5],h=t[9],l=t[13],c=t[2],u=t[6],p=t[10],d=t[14],f=t[3],_=t[7],g=t[11],m=t[15];return f*(+n*h*u-i*l*u-n*o*p+a*l*p+i*o*d-a*h*d)+_*(+r*h*d-r*l*p+n*s*p-i*s*d+i*l*c-n*h*c)+g*(+r*l*u-r*o*d-n*s*u+a*s*d+n*o*c-a*l*c)+m*(-i*o*c-r*h*u+r*o*p+i*s*u-a*s*p+a*h*c)},r}();e.Matrix=r,__reflect(r.prototype,"egret3d.Matrix");var a=new r,i=new r;e.helpMatrixA=new r,e.helpMatrixB=new r,e.helpMatrixC=new r,e.helpMatrixD=new r,e.helpMatrixE=new r,e.helpMatrixF=new r}(egret3d||(egret3d={}));var paper;!function(e){var t=function(t){function r(e,r){void 0===e&&(e=""),void 0===r&&(r="");var a=t.call(this)||this;return a.url="",a.name="",a.name=e,a.url=r,a}return __extends(r,t),r.register=function(e){this._assets[e.url]=e},r.unregister=function(e){delete this._assets[e.url]},r.find=function(e){return e in this._assets?this._assets[e]:null},Object.defineProperty(r,"assets",{get:function(){return this._assets},enumerable:!0,configurable:!0}),r.prototype.serialize=function(){var t=e.serializeRC(this);return t.url=this.url,t},r._assets={},__decorate([e.serializedField,e.deserializedIgnore],r.prototype,"url",void 0),r=__decorate([e.serializedType("assets")],r)}(e.SerializableObject);e.Asset=t,__reflect(t.prototype,"paper.Asset")}(paper||(paper={}));var paper;!function(e){var t=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e.gameObject=r._injectGameObject,e._enabled=!0,e}return __extends(r,t),r.prototype.initialize=function(){},r.prototype.uninitialize=function(){this.gameObject=null},r.prototype.serialize=function(){var t=e.serializeRC(this);return t._enabled=this._enabled,t},r.prototype.deserialize=function(e){this._enabled=e._enabled===!1?!1:!0},Object.defineProperty(r.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this._enabled!==t&&(this._enabled=t,e.EventPool.dispatchEvent("__enabled__",this))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isActiveAndEnabled",{get:function(){return this._enabled&&this.gameObject.activeInHierarchy},enumerable:!0,configurable:!0}),__decorate([e.serializedField],r.prototype,"_enabled",void 0),r}(e.SerializableObject);e.BaseComponent=t,__reflect(t.prototype,"paper.BaseComponent")}(paper||(paper={}));var editor;!function(e){function t(){return function(e){o[e.name]=!0}}function r(e,t){return function(r,a){h[r.constructor.name]||(h[r.constructor.name]={"extends":r.__proto__.constructor.name,propertyList:[]}),void 0!==e&&h[r.constructor.name].propertyList.push(new n(a,e,t))}}function a(e){return o[e.constructor.name]?!0:!1}function i(e){function t(e){var r=h[e];if(r){var a=t(r["extends"]);return a=a.concat(r.propertyList)}return[]}var r=e.constructor.name;return t(r)}var n=function(){function e(e,t,r){this.name=e,this.editType=t,this.option=r}return e}();e.PropertyInfo=n,__reflect(n.prototype,"editor.PropertyInfo");var s;!function(e){e[e.NUMBER=0]="NUMBER",e[e.TEXT=1]="TEXT",e[e.CHECKBOX=2]="CHECKBOX",e[e.VECTOR2=3]="VECTOR2",e[e.VECTOR3=4]="VECTOR3",e[e.VECTOR4=5]="VECTOR4",e[e.QUATERNION=6]="QUATERNION",e[e.COLOR=7]="COLOR",e[e.LIST=8]="LIST",e[e.RECT=9]="RECT",e[e.MATERIAL=10]="MATERIAL",e[e.MATERIAL_ARRAY=11]="MATERIAL_ARRAY",e[e.GAMEOBJECT=12]="GAMEOBJECT",e[e.TRANSFROM=13]="TRANSFROM",e[e.SOUND=14]="SOUND",e[e.MESH=15]="MESH",e[e.ARRAY=16]="ARRAY"}(s=e.EditType||(e.EditType={}));var o={};e.custom=t;var h={};e.property=r,e.isCustom=a,e.getEditInfo=i}(editor||(editor={}));var paper;!function(e){var t=function(){function t(){this._systems=[],this._unregisterSystems=[]}return t.prototype._checkRegistered=function(e){for(var t=0,r=this._systems;t<r.length;t++){var a=r[t];if(a&&a.constructor===e)return console.warn("The system has been registed.",egret.getQualifiedClassName(e)),!0}return!1},t.prototype.register=function(t,r){if(void 0===r&&(r=0),!this._checkRegistered(t)){var a=!1;e.BaseSystem._createEnabled=!0;var i=new t;if("number"==typeof r){i._level=r;for(var n=0,s=this._systems.length;s>n;++n){var o=this._systems[n];if(o._level>i._level){a=!0,this._systems.splice(n,0,i);break}}}a||this._systems.push(i),i.initialize()}},t.prototype.registerBefore=function(t,r){if(!this._checkRegistered(t)){var a=!1;e.BaseSystem._createEnabled=!0;for(var i=new t,n=0,s=this._systems.length;s>n;++n){var o=this._systems[n];if(o.constructor===r){a=!0,this._systems.splice(n,0,i);break}}a||this._systems.push(i),i.initialize()}},t.prototype.registerAfter=function(t,r){if(!this._checkRegistered(t)){var a=!1;e.BaseSystem._createEnabled=!0;for(var i=new t,n=0,s=this._systems.length;s>n;++n){var o=this._systems[n];if(o.constructor===r){a=!0,this._systems.splice(n+1,0,i);break}}a||this._systems.push(i),i.initialize()}},t.prototype.unregister=function(e){for(var t=0,r=0,a=this._systems;r<a.length;r++){var i=a[r];if(i&&i.constructor===e)return this._unregisterSystems.push(i),void(this._systems[t]=null);t++}},t.prototype.enableSystem=function(e){for(var t=0,r=this._systems;t<r.length;t++){var a=r[t];a&&a.constructor===e&&(a.enable=!0)}},t.prototype.disableSystem=function(e){for(var t=0,r=this._systems;t<r.length;t++){var a=r[t];a&&a.constructor===e&&(a.enable=!1)}},t.prototype.getSystemEnabled=function(e){for(var t=0,r=this._systems;t<r.length;t++){var a=r[t];if(a&&a.constructor===e)return a.enable}return!1},t.prototype.getSystem=function(e){for(var t=0,r=this._systems;t<r.length;t++){var a=r[t];if(a&&a.constructor===e)return a}return null},t.prototype.update=function(){for(var e=0,t=0,r=0,a=this._systems;r<a.length;r++){var i=a[r];i?(t>0&&(this._systems[e-t]=i,this._systems[e]=null),i.enable&&i.update()):t++,e++}if(t>0&&(this._systems.length-=t,this._unregisterSystems.length>0)){for(var n=0,s=this._unregisterSystems;n<s.length;n++){var i=s[n];i.uninitialize()}this._unregisterSystems.length=0}},t}();e.SystemManager=t,__reflect(t.prototype,"paper.SystemManager")}(paper||(paper={}));var egret3d;!function(e){function t(e,t){if(void 0===t&&(t="highp"),"highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}function r(e,t){for(var r=["","MOZ_","OP_","WEBKIT_"],a=0;a<r.length;++a){var i=r[a]+t,n=e.getExtension(i);if(n)return n}return null}var a=function(){function e(){this.precision="highp"}return e.prototype.initialize=function(e){this.version=parseFloat(/^WebGL\ ([0-9])/.exec(e.getParameter(e.VERSION))[1]),this.maxPrecision=t(e,this.precision),this.maxTextures=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxVertexTextures=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxCubemapSize=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),this.maxVertexUniformVectors=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),this.floatTextures=!!r(e,"OES_texture_float"),this.anisotropyExt=r(e,"EXT_texture_filter_anisotropic"),this.shaderTextureLOD=r(e,"EXT_shader_texture_lod"),this.maxAnisotropy=null!==this.anisotropyExt?e.getParameter(this.anisotropyExt.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,r(e,"OES_standard_derivatives"),r(e,"GL_OES_standard_derivatives")},e}();e.WebGLCapabilities=a,__reflect(a.prototype,"egret3d.WebGLCapabilities")}(egret3d||(egret3d={}));var paper;!function(e){var t=function(){function t(){this._scenes=[]}return t.prototype._addScene=function(e){this._scenes.indexOf(e)<0?this._scenes.unshift(e):console.warn("Add the scene again.",e.name)},t.prototype.createScene=function(t){var r=new e.Scene;return r.name=t,r.$rawScene=null,r},t.prototype.loadScene=function(t){var r=e.Asset.find(t);if(r){var a=r.createInstance();if(a)return a.$rawScene=r,e.Application.isPlaying&&egret3d.autoCombine(),a}return null},t.prototype.unloadScene=function(t){var r=this._scenes.indexOf(t);r>=0&&(t.$destroy(),this._scenes.splice(r,1)),0===this._scenes.length&&this.createScene(e.Scene.defaultName)},t.prototype.unloadAllScene=function(){for(var t=0,r=this._scenes;t<r.length;t++){var a=r[t];a.$destroy()}this._scenes.length=0,0===this._scenes.length&&this.createScene(e.Scene.defaultName)},t.prototype.getSceneByName=function(e){for(var t=0,r=this._scenes;t<r.length;t++){var a=r[t];if(a.name===e)return a}return null},t.prototype.getSceneByURL=function(e){for(var t=0,r=this._scenes;t<r.length;t++){var a=r[t];if(a.$rawScene&&a.$rawScene.url===e)return a}return null},t.prototype.getActiveScene=function(){return this._scenes[0]},t}();e.SceneManager=t,__reflect(t.prototype,"paper.SceneManager")}(paper||(paper={}));var egret3d;!function(e){var t=function(){function e(){this._eventMap={}}return e.prototype.addEventListener=function(e,t,r){var a=this._eventMap[e];a||(a=this._eventMap[e]=[]),a.push({listener:t,thisObject:r||this})},e.prototype.removeEventListener=function(e,t,r){var a=this._eventMap[e];if(a)for(var i=0,n=a.length;n>i;i++){var s=a[i];if(s.listener==t&&s.thisObject==(r||this)){a.splice(i,1);break}}},e.prototype.dispatchEvent=function(e){e.target=this,this.notifyListener(e)},e.prototype.notifyListener=function(e){var t=this._eventMap[e.type||e];if(t)for(var r=0,a=t.length;a>r;r++){var i=t[r];i.listener.call(i.thisObject,e)}},e}();e.EventDispatcher=t,__reflect(t.prototype,"egret3d.EventDispatcher")}(egret3d||(egret3d={}));var egret3d;!function(e){var t;!function(e){var t=function(){function t(){this._init()}return t.prototype._init=function(){var t=e.WebAudio.instance.audioContext;this.source=t.createBufferSource(),this.gain=t.createGain(),this.source.connect(this.gain),this.gain.connect(t.destination)},Object.defineProperty(t.prototype,"buffer",{set:function(e){this.source.buffer=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"volume",{get:function(){return this.gain.gain.value},set:function(e){e=Math.max(Math.min(e,1),-.999),this.gain.gain.value=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loop",{get:function(){return this.source.loop},set:function(e){this.source.loop=e},enumerable:!0,configurable:!0}),t.prototype.start=function(e){this.source.start(void 0,e||void 0)},t.prototype.stop=function(){this.source.stop()},t.prototype.dispose=function(){this.source.buffer=null},t}();e.WebAudioChannel2D=t,__reflect(t.prototype,"egret3d.sound.WebAudioChannel2D")}(t=e.sound||(e.sound={}))}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r._interests=[{componentClass:e.Camera}],r}return __extends(r,t),r.prototype._applyDrawCall=function(t,r){t.updateModel(r.transform);var a="base";r.boneData&&(t.updateBones(r.boneData),a="skin"),r.lightMapIndex>=0&&r.gameObject.scene.lightmaps.length>r.lightMapIndex&&(t.updateLightmap(r.gameObject.scene.lightmaps[r.lightMapIndex],r.mesh.glTFMesh.primitives[r.subMeshInfo].attributes.TEXCOORD_1?1:0,r.lightMapScaleOffset),a="lightmap");var i=r.gameObject.getComponent(e.MeshRenderer);i&&i.receiveShadows?t.receiveShadow=!0:t.receiveShadow=!1,e.WebGLKit.draw(t,r.material,r.mesh,r.subMeshInfo,a,r.transform._worldMatrixDeterminant<0)},r.prototype.$renderCamera=function(t){e.DrawCallList.updateZdist(t),e.DrawCallList.sort();for(var r=0,a=e.Pool.drawCall.instances;r<a.length;r++){var i=a[r];t.cullingMask&i.gameObject.layer&&i.gameObject.activeInHierarchy&&this._applyDrawCall(t.context,i)}var n=paper.Application.systemManager.getSystem(e.Egret2DRendererSystem);if(n&&n.enable)for(var s=0,o=n.components;s<o.length;s++){var h=o[s];t.cullingMask&h.gameObject.layer&&h.render(t.context,t)}},r.prototype.update=function(){this._components.sort(function(e,t){return e.order-t.order});for(var t=paper.Application.systemManager.getSystem(e.LightSystem),r=t?t.components:null,a=0,i=this._components;a<i.length;a++){var n=i[a];n.update(paper.Time.deltaTime),r&&r.length>0&&n.context.updateLights(r)}if(e.Performance.startCounter("render"),this._components.length>0)for(var s=0,o=this._components;s<o.length;s++){var n=o[s];if(0===n.postQueues.length)n.context.drawtype="",n._targetAndViewport(n.renderTarget,!1),this.$renderCamera(n);else for(var h=0,l=n.postQueues;h<l.length;h++){var c=l[h];c.render(n,this)}}else e.WebGLKit.webgl.clearColor(0,0,0,1),e.WebGLKit.webgl.clearDepth(1),e.WebGLKit.webgl.clear(e.WebGLKit.webgl.COLOR_BUFFER_BIT|e.WebGLKit.webgl.DEPTH_BUFFER_BIT);e.Performance.endCounter("render"),e.Performance.updateFPS()},r}(paper.BaseSystem);e.CameraSystem=t,__reflect(t.prototype,"egret3d.CameraSystem")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=new e.Vector3,r=new e.Vector3,a=new e.Vector3,i=new e.Matrix,n=function(){function n(e,t,r,a){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),void 0===a&&(a=1),this.x=e,this.y=t,this.z=r,this.w=a}return n.prototype.serialize=function(){return[this.x,this.y,this.z,this.w]},n.prototype.deserialize=function(e){this.x=e[0],this.y=e[1],this.z=e[2],this.w=e[3]},n.set=function(e,t,r,a,i){return i.x=e,i.y=t,i.z=r,i.w=a,i},n.getMagnitude=function(e){return Math.sqrt(e.w*e.w+e.x*e.x+e.y*e.y+e.z*e.z)},n.fromYawPitchRoll=function(e,t,r,a){var i=.5*r,n=.5*t,s=.5*e,o=Math.sin(i),h=Math.cos(i),l=Math.sin(n),c=Math.cos(n),u=Math.sin(s),p=Math.cos(s);return a.x=p*l*h+u*c*o,a.y=u*c*h-p*l*o,a.z=p*c*o-u*l*h,a.w=p*c*h+u*l*o,a},n.fromEulerAngles=function(e,t,r,a){e*=Math.PI/180,t*=Math.PI/180,r*=Math.PI/180;var i=.5*e,n=.5*t,s=.5*r,o=Math.cos(i),h=Math.sin(i),l=Math.cos(n),c=Math.sin(n),u=Math.cos(s),p=Math.sin(s);return a.w=o*l*u+h*c*p,a.x=h*l*u+o*c*p,a.y=o*c*u-h*l*p,a.z=o*l*p-h*c*u,this.normalize(a)},n.fromAxisAngle=function(e,t,r){t*=Math.PI/180;var a=.5*t,i=Math.sin(a);return r.w=Math.cos(a),r.x=e.x*i,r.y=e.y*i,r.z=e.z*i,this.normalize(r),r},n.fromMatrix=function(e,t){var r,a,i,n,s,o,h,l,c,u,p,d,f,_,g,m=e.rawData;return r=m[0],a=m[1],i=m[2],n=m[4],s=m[5],o=m[6],h=m[8],l=m[9],c=m[10],f=1/Math.sqrt(r*r+a*a+i*i),_=1/Math.sqrt(n*n+s*s+o*o),g=1/Math.sqrt(h*h+l*l+c*c),r*=f,a*=f,i*=f,n*=_,s*=_,o*=_,h*=g,l*=g,c*=g,u=r+s+c,u>=0?(p=Math.sqrt(u+1),t.w=.5*p,p=.5/p,t.x=(o-l)*p,t.y=(h-i)*p,t.z=(a-n)*p):r>s?r>c?(d=r-(s+c)+1,d=Math.sqrt(d),t.x=.5*d,d=.5/d,t.w=(o-l)*d,t.y=(a+n)*d,t.z=(i+h)*d):(d=c-(r+s)+1,d=Math.sqrt(d),t.z=.5*d,d=.5/d,t.w=(a-n)*d,t.x=(h+i)*d,t.y=(l+o)*d):s>c?(d=s-(c+r)+1,d=Math.sqrt(d),t.y=.5*d,d=.5/d,t.w=(h-i)*d,t.z=(o+l)*d,t.x=(n+a)*d):(d=c-(r+s)+1,d=Math.sqrt(d),t.z=.5*d,d=.5/d,t.w=(a-n)*d,t.x=(h+i)*d,t.y=(l+o)*d),t},n.lookAt=function(i,n,s){var o=t;e.Vector3.subtract(n,i,o),e.Vector3.normalize(o);var h=r;r.x=o.x,r.y=0,r.z=o.z,e.Vector3.normalize(h);var l=Math.acos(h.z);h.x<0&&(l=-l);var c=a;a.x=o.x,a.y=0,a.z=o.z;var u=e.Vector3.getLength(c);u>.9999999999&&(u=1),-.999999999>u&&(u=-1);var p=Math.acos(u);return o.y>0&&(p=-p),this.fromYawPitchRoll(l,p,0,s),this.normalize(s)},n.lookAtWithUp=function(s,o,h,l){var c=s,u=e.Vector3.subtract(o,c,t);e.Vector3.normalize(u);var p=e.Vector3.cross(h,u,r);e.Vector3.normalize(p);var d=e.Vector3.cross(u,p,a);return n.fromMatrix(e.Matrix.set(p.x,d.x,u.x,0,p.y,d.y,u.y,0,p.z,d.z,u.z,0,0,0,0,1,i),l)},n.multiply=function(e,t,r){var a=e.w,i=e.x,n=e.y,s=e.z,o=t.w,h=t.x,l=t.y,c=t.z;return r.w=a*o-i*h-n*l-s*c,r.x=a*h+i*o+n*c-s*l,r.y=a*l-i*c+n*o+s*h,r.z=a*c+i*l-n*h+s*o,this.normalize(r),r},n.normalize=function(e){var t=1/Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w);return e.x*=t,e.y*=t,e.z*=t,e.w*=t,e},n.copy=function(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t},n.inverse=function(e){var t=e.w*e.w+e.x*e.x+e.y*e.y+e.z*e.z;if(t>0){var r=1/t;e.w=e.w*r,e.x=-e.x*r,e.y=-e.y*r,e.z=-e.z*r}return e},n.toEulerAngles=function(t,r){var a=2*(t.w*t.x-t.y*t.z);return a=e.floatClamp(a,-1,1),r.x=Math.asin(a),r.y=Math.atan2(2*(t.w*t.y+t.z*t.x),1-2*(t.y*t.y+t.x*t.x)),r.z=Math.atan2(2*(t.w*t.z+t.y*t.x),1-2*(t.x*t.x+t.z*t.z)),r.x/=Math.PI/180,r.y/=Math.PI/180,r.z/=Math.PI/180,r},n.toMatrix=function(e,t){var r=2*e.x*e.y,a=2*e.x*e.z,i=2*e.x*e.w,n=2*e.y*e.z,s=2*e.y*e.w,o=2*e.z*e.w,h=e.x*e.x,l=e.y*e.y,c=e.z*e.z,u=e.w*e.w;return t.rawData[0]=h-l-c+u,t.rawData[4]=r-o,t.rawData[8]=a+s,t.rawData[12]=0,t.rawData[1]=r+o,t.rawData[5]=-h+l-c+u,t.rawData[9]=n-i,t.rawData[13]=0,t.rawData[2]=a-s,t.rawData[6]=n+i,t.rawData[10]=-h-l+c+u,t.rawData[14]=0,t.rawData[3]=0,t.rawData[7]=0,t.rawData[11]=0,t.rawData[15]=1,t},n.toAxisAngle=function(e,t){var r=e.x*e.x+e.y*e.y+e.z*e.z,a=0;return r>0?(a=2*Math.acos(e.w),r=1/Math.sqrt(r),t.x=e.x*r,t.y=e.y*r,t.z=e.z*r):(a=0,t.x=1,t.y=0,t.z=0),a/=Math.PI/180},n.transformVector3=function(e,t,r){var a,i,n,s,o=t.x,h=t.y,l=t.z;return s=-e.x*o-e.y*h-e.z*l,a=e.w*o+e.y*l-e.z*h,i=e.w*h-e.x*l+e.z*o,n=e.w*l+e.x*h-e.y*o,r.x=-s*e.x+a*e.w-i*e.z+n*e.y,r.y=-s*e.y+a*e.z+i*e.w-n*e.x,r.z=-s*e.z-a*e.y+i*e.x+n*e.w,r
},n.transformVector3ByQuaternionData=function(e,t,r,a){var i,n,s,o,h=r.x,l=r.y,c=r.z,u=e[t],p=e[t+1],d=e[t+2],f=e[t+3];return o=-u*h-p*l-d*c,i=f*h+p*c-d*l,n=f*l-u*c+d*h,s=f*c+u*l-p*h,a.x=-o*u+i*f-n*d+s*p,a.y=-o*p+i*d+n*f-s*u,a.z=-o*d-i*p+n*u+s*f,a},n.multiplyByQuaternionData=function(e,t,r,a){var i=e[t+3],n=e[t+0],s=e[t+1],o=e[t+2],h=r.w,l=r.x,c=r.y,u=r.z;return a.w=i*h-n*l-s*c-o*u,a.x=i*l+n*h+s*u-o*c,a.y=i*c-n*u+s*h+o*l,a.z=i*u+n*c-s*l+o*h,this.normalize(a),a},n.lerp=function(e,t,r,a){var i=e.w,n=e.x,s=e.y,o=e.z,h=t.w,l=t.x,c=t.y,u=t.z;0>i*h+n*l+s*c+o*u&&(h=-h,l=-l,c=-c,u=-u),r.w=i+a*(h-i),r.x=n+a*(l-n),r.y=s+a*(c-s),r.z=o+a*(u-o);var p=1/Math.sqrt(r.w*r.w+r.x*r.x+r.y*r.y+r.z*r.z);return r.w*=p,r.x*=p,r.y*=p,r.z*=p,r},n}();e.Quaternion=n,__reflect(n.prototype,"egret3d.Quaternion",["paper.ISerializable"])}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e._assets={},e._raw=null,e}return __extends(r,t),r.prototype.$parse=function(t){if(this._raw=JSON.parse(t),this._raw)for(var r=0,a=this._raw.assets;r<a.length;r++){var i=a[r];i.url.indexOf("shader.json")<0&&(this._assets[i.hashCode]=paper.Asset.find(e.utils.combinePath(e.utils.getPathByUrl(this.url)+"/",i.url)))}},r.prototype.dispose=function(){for(var e=0,t=this._assets;e<t.length;e++){var r=t[e];delete this._assets[r]}this._raw=null},r.prototype.caclByteLength=function(){return 0},r}(paper.Asset);e.BaseObjectAsset=t,__reflect(t.prototype,"egret3d.BaseObjectAsset");var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createInstance=function(){if(!this._raw)return null;var e=paper.deserialize(this._raw,this._assets);return e},t.prototype.getClone=function(){return this.createInstance()},t}(t);e.Prefab=r,__reflect(r.prototype,"egret3d.Prefab")}(egret3d||(egret3d={}));var egret3d;!function(e){function t(t){void 0===t&&(t={antialias:!1});var r=document.getElementsByClassName("egret-player")[0],a={antialias:t.antialias,contentWidth:parseInt(r.getAttribute("data-content-width")),contentHeight:parseInt(r.getAttribute("data-content-height"))},i=document.createElement("canvas");r.appendChild(i),e.WebGLKit.init(i,a),e.InputManager.init(i),e.DefaultMeshes.init(),e.DefaultTextures.init(),e.DefaultShaders.init(),e.stage.init(i,a),paper.Application.init()}e.runEgret=t}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(){function e(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.x=e,this.y=t}return e.prototype.serialize=function(){return[this.x,this.y]},e.prototype.deserialize=function(e){this.x=e[0],this.y=e[1]},e.set=function(e,t,r){return r.x=e,r.y=t,r},e.normalize=function(e){var t=this.getLength(e);return t>Number.MIN_VALUE?(e.x=e.x/t,e.y=e.y/t):(e.x=0,e.y=0),e},e.add=function(e,t,r){return r.x=e.x+t.x,r.y=e.y+t.y,r},e.subtract=function(e,t,r){return r.x=e.x-t.x,r.y=e.y-t.y,r},e.multiply=function(e,t,r){return r.x=e.x*t.x,r.y=e.y*t.y,r},e.dot=function(e,t){return e.x*t.x+e.y*t.y},e.scale=function(e,t){return e.x=e.x*t,e.y=e.y*t,e},e.getLength=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},e.getDistance=function(e,t){return this.subtract(e,t,r),this.getLength(r)},e.copy=function(e,t){return t.x=e.x,t.y=e.y,t},e.equal=function(e,t,r){return void 0===r&&(r=1e-5),Math.abs(e.x-t.x)>r?!1:Math.abs(e.y-t.y)>r?!1:!0},e.lerp=function(e,t,r,a){return a.x=e.x*(1-r)+t.x*r,a.y=e.y*(1-r)+t.y*r,a},e}();e.Vector2=t,__reflect(t.prototype,"egret3d.Vector2",["paper.ISerializable"]);var r=new t;e.helpVector2A=new t,e.helpVector2B=new t,e.helpVector2C=new t,e.helpVector2D=new t}(egret3d||(egret3d={}));var paper;!function(e){var t=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e._bufferedComponents=[],e._bufferedGameObjects=[],e}return __extends(r,t),r.prototype.update=function(){for(var t=0,r=this._bufferedComponents;t<r.length;t++){var a=r[t];e.EventPool.dispatchEvent("__destroy__",a),a.uninitialize()}this._bufferedComponents.length=0,this._bufferedGameObjects.length=0},r.prototype.bufferComponent=function(e){this._bufferedComponents.indexOf(e)>=0||this._bufferedComponents.push(e)},r.prototype.bufferGameObject=function(e){if(!(this._bufferedGameObjects.indexOf(e)>=0)&&(this._bufferedGameObjects.push(e),e.transform))for(var t=0,r=e.transform.children;t<r.length;t++){var a=r[t];a.gameObject.destroy()}},r}(e.BaseSystem);e.DestroySystem=t,__reflect(t.prototype,"paper.DestroySystem")}(paper||(paper={}));var paper;!function(e){var t=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return __extends(r,t),r.prototype.update=function(){egret3d.InputManager.update(e.Time.deltaTime),egret3d.Performance.endCounter("all")},r}(e.BaseSystem);e.EndSystem=t,__reflect(t.prototype,"paper.EndSystem")}(paper||(paper={}));var paper;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.update=function(){egret3d.Performance.startCounter("all"),egret3d.stage.update();var e=egret3d.stage.absolutePosition,t=e.x,r=e.y,a=e.w,i=egret3d.stage.screenViewport.w/a;egret3d.InputManager.touch.updateOffsetAndScale(t,r,i),egret3d.InputManager.mouse.updateOffsetAndScale(t,r,i)},t}(e.BaseSystem);e.StartSystem=t,__reflect(t.prototype,"paper.StartSystem")}(paper||(paper={}));var paper;!function(e){function t(t,r){if(void 0===r&&(r=""),_={objects:[]},d=r,!d&&t instanceof e.Scene){var a=t.$rawScene;d=a?a.url:""}o(t),f.length=0;var i=_;return _=null,i}function r(e){var t=o(e);return!d||e instanceof egret3d.Shader||(t.url=egret3d.utils.getRelativePath(e.url,d)),e.url?n(e):null}function a(t){var r=egret.getQualifiedClassName(t);return{hashCode:t.hashCode,"class":e.findClassCode(r)||r}}function i(e,t,r){if(void 0===r&&(r=null),t in e){r=r||[];for(var a=0,n=e[t];a<n.length;a++){var s=n[a];r.push(s)}}return e.__proto__&&i(e.__proto__,t,r),r}function n(e){return{hashCode:e.hashCode}}function s(t){var r=egret.getQualifiedClassName(t);return{"class":e.findClassCode(r)||r}}function o(e,t){if(void 0===t&&(t=!1),f.indexOf(e.hashCode)>=0)return n(e);var r=e.constructor.prototype,o=r.hasOwnProperty(p),l=o?r[p].apply(e):t?s(e):a(e);if(!t&&_)if(f.push(e.hashCode),"__serializedType"in e)for(var c=0,u=e.__serializedType;c<u.length;c++){var d=u[c];d in _?_[d].push(l):_[d]=[l]}else _.objects.push(l);if(!o){var g=i(r,"__serialized");if(g&&g.length>0)for(var m=0,v=g;m<v.length;m++){var y=v[m];l[y]=h(e[y],e,y)}}return l}function h(t,i,s){if(null===t||void 0===t)return t;switch(typeof t){case"function":return;case"object":if(Array.isArray(t)){for(var p=[],d=0,f=t;d<f.length;d++){var _=f[d];p.push(h(_,i,s))}return p}if(t.constructor===Object){var p={};for(var g in t)p[g]=h(t[g],i,s);return p}if(t instanceof e.Asset)return r(t);if(t instanceof e.Scene||t instanceof e.GameObject||t instanceof e.BaseComponent){if(i)if(i instanceof e.Scene){if(s===l)return o(t),n(t)}else if(i instanceof e.GameObject){if(s===c)return o(t),n(t)}else if(i instanceof egret3d.Transform&&s===u)return o(t.gameObject),n(t);return a(t)}return o(t,!0);default:return t}}var l="gameObjects",c="components",u="children",p="serialize",d="",f=[],_=null;e.serialize=t,e.serializeAsset=r,e.serializeRC=a,e.getTypesFromPrototype=i}(paper||(paper={}));var egret3d;!function(e){function t(e,t,r,a,i){var n=t,s=r,o=a,h=i,l=t/o||0,c=r/h||0;return l>c?n=Math.round(o*c):s=Math.round(h*l),o%2!=0&&(o+=1),h%2!=0&&(h+=1),n%2!=0&&(n+=1),s%2!=0&&(s+=1),{stageWidth:o,stageHeight:h,displayWidth:n,displayHeight:s}}var r=function(){function e(){this.screenViewport={x:0,y:0,w:0,h:0},this.absolutePosition={x:0,y:0,w:0,h:0},this._resizeDirty=!0}return e.prototype.init=function(e,t){var r=this;this._canvas=e,window.addEventListener("resize",function(){return r._resizeDirty=!0},!1);var a=this.screenViewport;a.w=t.contentWidth,a.h=t.contentHeight,e.width=a.w,e.height=a.h},e.prototype.update=function(){this._resizeDirty&&(this._resize(),this._resizeDirty=!1)},e.prototype._resize=function(){var e=window.innerWidth,r=window.innerHeight,a=t("showAll",e,r,this.screenViewport.w,this.screenViewport.h),i=this._canvas,n=this.absolutePosition;n.w=a.displayWidth,n.h=a.displayHeight;var s=a.displayWidth>a.displayHeight,o=0;s?(n.y=o+(r-a.displayHeight)/2,n.x=(e-a.displayWidth)/2):(n.y=o+(r-a.displayHeight)/2,n.x=(e-a.displayWidth)/2);var h=n.x,l=n.y,c=n.w,u=n.h;i.style.left=h+"px",i.style.top=l+"px",i.style.width=c+"px",i.style.height=u+"px",i.style.position="absolute"},e}();e.Stage3D=r,__reflect(r.prototype,"egret3d.Stage3D"),e.stage=new r}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(){function e(e,t,r,a){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),void 0===a&&(a=0),this.x=e,this.y=t,this.z=r,this.w=a}return e.prototype.serialize=function(){return[this.x,this.y,this.z,this.w]},e.prototype.deserialize=function(e){this.x=e[0],this.y=e[1],this.z=e[2],this.w=e[3]},e.set=function(e,t,r,a,i){return i.x=e,i.y=t,i.z=r,i.w=a,i},e.copy=function(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t},e}();e.Vector4=t,__reflect(t.prototype,"egret3d.Vector4",["paper.ISerializable"]),e.helpVector4A=new t,e.helpVector4B=new t,e.helpVector4C=new t,e.helpVector4D=new t,e.helpVector4E=new t,e.helpVector4F=new t,e.helpVector4G=new t,e.helpVector4H=new t}(egret3d||(egret3d={}));var paper;!function(e){var t=function(){function t(){}return t._update=function(){if(e.Time.update(),this._isRunning&&requestAnimationFrame(this._bindUpdate),this.systemManager.update(),this._laterCalls.length>0){for(var t=0,r=this._laterCalls;t<r.length;t++){var a=r[t];a()}this._laterCalls.length=0}},t.init=function(){for(var t=this.systemManager,r=[e.StartSystem,e.BehaviourSystem,egret3d.BoxColliderSystem,egret3d.AnimationSystem,egret3d.GuidpathSystem,egret3d.TrailRenderSystem,egret3d.MeshRendererSystem,egret3d.SkinnedMeshRendererSystem,egret3d.Egret2DRendererSystem,egret3d.LightSystem,egret3d.CameraSystem,egret3d.AudioSource3DSystem,e.DestroySystem,e.EndSystem],a=0,i=0,n=r;i<n.length;i++){var s=n[i];t.register(s,a++)}e.Time.initialize(),this._isEditor=!1,this._isPlaying=!0,this.resume()},t.pause=function(){this._isRunning=!1},t.resume=function(){this._isRunning||(this._isRunning=!0,this._bindUpdate||(this._bindUpdate=this._update.bind(this)),this._update())},t.callLater=function(e){this._laterCalls.push(e)},Object.defineProperty(t,"isEditor",{get:function(){return this._isEditor},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isFocused",{get:function(){return this._isFocused},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isPlaying",{get:function(){return this._isPlaying},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isRunning",{get:function(){return this._isRunning},enumerable:!0,configurable:!0}),t.systemManager=new e.SystemManager,t.sceneManager=new e.SceneManager,t._isEditor=!1,t._isFocused=!1,t._isPlaying=!1,t._isRunning=!1,t._standDeltaTime=-1,t._laterCalls=[],t._bindUpdate=null,t}();e.Application=t,__reflect(t.prototype,"paper.Application")}(paper||(paper={}));var paper;!function(e){var t;!function(e){function t(e,t,r){var a=egret.getQualifiedClassName(t),i=a in n?n[a]:n[a]={},s=e in i?i[e]:i[e]=[];s.push(r)}function r(e,t,r){var a=egret.getQualifiedClassName(t);if(a in n){var i=n[a];if(e in i)for(var s=i[e],o=0,h=s.length;h>o;o++)if(s[o]===r){s.splice(o,1);break}}}function a(e,t){var r=egret.getQualifiedClassName(t);if(r in n){var a=n[r];e in a&&(a[e].length=0)}}function i(e,t){var r="paper.Behaviour",a="";if(a="__create__"!==e&&"__destroy__"!==e&&"__enabled__"!==e||!egret.is(t,r)?egret.getQualifiedClassName(t.constructor):r,a in n){var i=n[a];if(e in i)for(var s=i[e],o=0,h=s;o<h.length;o++){var l=h[o];l(t)}}}var n={};e.addEventListener=t,e.removeEventListener=r,e.removeAllEventListener=a,e.dispatchEvent=i}(t=e.EventPool||(e.EventPool={}))}(paper||(paper={}));var egret3d;!function(e){var t=function(){function e(e,t,r,a){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),void 0===a&&(a=0),this.x=0,this.y=0,this.w=0,this.h=0,this.x=e,this.y=t,this.w=r,this.h=a}return e.prototype.serialize=function(){return[this.x,this.y,this.w,this.h]},e.prototype.deserialize=function(e){this.x=e[0],this.y=e[1],this.w=e[2],this.h=e[3]},e}();e.Rect=t,__reflect(t.prototype,"egret3d.Rect",["egret3d.RectData","paper.ISerializable"]),e.helpRectA=new t,e.helpRectB=new t,e.helpRectC=new t,e.helpRectD=new t}(egret3d||(egret3d={}));var paper;!function(e){var t=function(t){function r(r,a){void 0===r&&(r="NoName"),void 0===a&&(a="");var i=t.call(this)||this;return i.isStatic=!1,i.layer=2,i.name="",i.tag="",i.transform=null,i.prefab=null,i._destroyed=!1,i._activeSelf=!0,i._activeInHierarchy=!0,i._activeDirty=!0,i._components=[],i._scene=null,i._scene=e.Application.sceneManager.getActiveScene(),i._scene.$addGameObject(i),i.name=r,i.tag=a,i.transform=i.addComponent(egret3d.Transform),i}return __extends(r,t),r.find=function(t){for(var r=0,a=e.Application.sceneManager.getActiveScene().gameObjects;r<a.length;r++){var i=a[r];if(i.name===t)return i}return null},r.findWithTag=function(t){for(var r=0,a=e.Application.sceneManager.getActiveScene().gameObjects;r<a.length;r++){var i=a[r];if(i.tag===t)return i}return null},r.findGameObjectsWithTag=function(t){for(var r=[],a=0,i=e.Application.sceneManager.getActiveScene().gameObjects;a<i.length;a++){var n=i[a];n.tag===t&&r.push(n)}return r},r.prototype._activeInHierarchyDirty=function(){this._activeDirty=!0;for(var t=0,r=this._components;t<r.length;t++){var a=r[t];e.EventPool.dispatchEvent("__enabled__",a)}for(var i=0,n=this.transform.children;i<n.length;i++){var s=n[i];s.gameObject._activeInHierarchyDirty()}},r.prototype._removeComponentReference=function(t){t.enabled=!1;var r=e.Application.systemManager.getSystem(e.DestroySystem);r&&r.bufferComponent(t)},r.prototype._getComponentsInChildren=function(e,t,r){for(var a=t._components,i=0,n=a;i<n.length;i++){var s=n[i];egret.is(s,egret.getQualifiedClassName(e))&&r.push(s)}for(var o=0,h=t.transform.children;o<h.length;o++){var l=h[o];this._getComponentsInChildren(e,l.gameObject,r)}},r.prototype.destroy=function(){if(this._destroyed)return void console.warn("The game object has been destroyed.",this.hashCode);this._destroyed=!0,this.removeAllComponents(),this._scene.$removeGameObject(this),this._scene=null;var t=e.Application.systemManager.getSystem(e.DestroySystem);t&&t.bufferGameObject(this)},r.prototype.addComponent=function(t){e.BaseComponent._injectGameObject=this;var r=new t;return this._components.push(r),r.initialize(),e.EventPool.dispatchEvent("__create__",r),r},r.prototype.removeComponent=function(t){if(t instanceof e.BaseComponent){if(t===this.transform)return;for(var r=0,a=0,i=this._components;a<i.length;a++){var n=i[a];if(n===t)return this._removeComponentReference(n),void this._components.splice(r,1);r++}}else{if(t===egret3d.Transform)return;for(var r=0,s=0,o=this._components;s<o.length;s++){var n=o[s];if(egret.is(n,egret.getQualifiedClassName(t)))return this._removeComponentReference(n),void this._components.splice(r,1);r++}}},r.prototype.removeAllComponents=function(){for(var e=0,t=this._components;e<t.length;e++){var r=t[e];this._removeComponentReference(r)}this._components.length=0},r.prototype.getComponent=function(e){for(var t=0,r=this._components;t<r.length;t++){var a=r[t];if(egret.is(a,egret.getQualifiedClassName(e)))return a}return null},r.prototype.getComponentInParent=function(e){for(var t=null,r=this.transform.parent;!t&&r;)t=r.gameObject.getComponent(e),r=r.parent;return t},r.prototype.getComponentsInChildren=function(e){var t=[];return this._getComponentsInChildren(e,this,t),t},r.prototype.sendMessage=function(t,r,a){void 0===a&&(a=!0);for(var i=0,n=this._components;i<n.length;i++){var s=n[i];s.isActiveAndEnabled&&s.constructor instanceof e.Behaviour&&(t in s?s[t](r):a&&console.warn(this.name,egret.getQualifiedClassName(s),t))}},r.prototype.sendMessageUpwards=function(e,t,r){void 0===r&&(r=!0),this.sendMessage(e,t,r);var a=this.transform.parent;a&&a.gameObject.activeInHierarchy&&a.gameObject.sendMessage(e,t,r)},r.prototype.broadcastMessage=function(e,t,r){void 0===r&&(r=!0),this.sendMessage(e,t,r);for(var a=0,i=this.transform.children;a<i.length;a++){var n=i[a];n.gameObject.activeInHierarchy&&n.gameObject.broadcastMessage(e,t,r)}},Object.defineProperty(r.prototype,"activeSelf",{get:function(){return this._activeSelf},set:function(e){this._activeSelf!==e&&(this._activeSelf=e,this._activeInHierarchyDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"activeInHierarchy",{get:function(){if(this._activeDirty){var e=this.transform.parent;e&&!e.gameObject.activeInHierarchy?this._activeInHierarchy=!1:this._activeInHierarchy=this._activeSelf,this._activeDirty=!1}return this._activeInHierarchy},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"components",{get:function(){return this._components},set:function(e){this._components.length=0;for(var t=0,r=e;t<r.length;t++){var a=r[t];this._components.push(a)}this.transform=this.getComponent(egret3d.Transform)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),__decorate([e.serializedField,editor.property(editor.EditType.CHECKBOX)],r.prototype,"isStatic",void 0),__decorate([e.serializedField,e.deserializedIgnore],r.prototype,"layer",void 0),__decorate([e.serializedField,editor.property(editor.EditType.TEXT)],r.prototype,"name",void 0),__decorate([e.serializedField],r.prototype,"tag",void 0),__decorate([e.serializedField],r.prototype,"prefab",void 0),__decorate([e.serializedField],r.prototype,"_activeSelf",void 0),__decorate([e.serializedField],r.prototype,"components",null),r}(e.SerializableObject);e.GameObject=t,__reflect(t.prototype,"paper.GameObject")}(paper||(paper={}));var paper;!function(e){var t=function(t){function r(){var r=t.call(this)||this;return r.name="",r.lightmaps=[],r.gameObjects=[],r.$rawScene=null,e.Application.sceneManager._addScene(r),r}return __extends(r,t),r.prototype.$destroy=function(){for(var e=0,t=this.gameObjects;e<t.length;e++){var r=t[e];r.destroy()}this.lightmaps.length=0,this.gameObjects.length=0,this.$rawScene=null},r.prototype.$removeGameObject=function(e){var t=this.gameObjects.indexOf(e);t>-1?this.gameObjects.splice(t,1):console.debug("Remove game object again.",e.hashCode)},r.prototype.$addGameObject=function(e){this.gameObjects.indexOf(e)<0?this.gameObjects.push(e):console.debug("Add game object again.",e.hashCode)},r.prototype.getRootGameObjects=function(){for(var e=[],t=0,r=this.gameObjects;t<r.length;t++){var a=r[t];a.transform.parent||e.push(a)}return e},r.defaultName="default",__decorate([e.serializedField],r.prototype,"name",void 0),__decorate([e.serializedField],r.prototype,"lightmaps",void 0),__decorate([e.serializedField,e.deserializedIgnore],r.prototype,"gameObjects",void 0),r}(e.SerializableObject);e.Scene=t,__reflect(t.prototype,"paper.Scene")}(paper||(paper={}));var paper;!function(e){function t(t){e._executeInEditModeComponents.push(t)}e._executeInEditModeComponents=[],e.executeInEditMode=t;var r=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r._interests=[{componentClass:e.Behaviour,listeners:[{type:"__enabled__",listener:function(e){e.isActiveAndEnabled?r._onEnableBehaviours.indexOf(e)<0&&r._onEnableBehaviours.push(e):r._onDisableBehaviours.indexOf(e)<0&&r._onDisableBehaviours.push(e)}}]}],r._onEnableBehaviours=[],r._resetBehaviours=[],r._startBehaviours=[],r._onDisableBehaviours=[],r}return __extends(r,t),r.prototype._onCreateComponent=function(t){return this._gameObjectOffsets[t.gameObject.hashCode]=this._components.length,this._components.push(t),this._onEnableBehaviours.push(t),e.Application.isEditor&&!e.Application.isPlaying&&this._resetBehaviours.push(t),this._startBehaviours.push(t),!0},r.prototype._onDestroyComponent=function(e){for(var t=e.gameObject,r=0;r<this._components.length;r++)if(this._components[r]===e){this._components.splice(r,1);break}return delete this._gameObjectOffsets[t.hashCode],!0},r.prototype.update=function(){var t=0,r=0;if(e.Application.isEditor&&!e.Application.isPlaying){if(this._onEnableBehaviours.length>0){for(var a=0,i=this._onEnableBehaviours;a<i.length;a++){var n=i[a];n.isActiveAndEnabled&&e._executeInEditModeComponents.indexOf(n.constructor)>=0&&n.onEnable()}this._onEnableBehaviours.length=0}if(this._resetBehaviours.length>0){for(var s=0,o=this._resetBehaviours;s<o.length;s++){var n=o[s];n.onReset()}this._resetBehaviours.length=0}if(t=this._startBehaviours.length,t>0)for(;t--;){var n=this._startBehaviours[t];(!n||n.isActiveAndEnabled)&&(n.isActiveAndEnabled&&e._executeInEditModeComponents.indexOf(n.constructor)>=0&&n.onStart(),this._startBehaviours.splice(t,1))}for(r=this._components.length,t=0;r>t;++t){var n=this._components[t];n.isActiveAndEnabled&&e._executeInEditModeComponents.indexOf(n.constructor)>=0&&n.onUpdate(e.Time.deltaTime)}for(t=0;r>t;++t){var n=this._components[t];n.isActiveAndEnabled&&e._executeInEditModeComponents.indexOf(n.constructor)>=0&&n.onLateUpdate(e.Time.deltaTime)}if(this._onDisableBehaviours.length>0){for(var h=0,l=this._onDisableBehaviours;h<l.length;h++){var n=l[h];!n.isActiveAndEnabled&&e._executeInEditModeComponents.indexOf(n.constructor)>=0&&n.onDisable()}this._onDisableBehaviours.length=0}}else{if(this._onEnableBehaviours.length>0){for(var c=0,u=this._onEnableBehaviours;c<u.length;c++){var n=u[c];n.isActiveAndEnabled&&n.onEnable()}this._onEnableBehaviours.length=0}if(t=this._startBehaviours.length,t>0)for(;t--;){var n=this._startBehaviours[t];(!n||n.isActiveAndEnabled)&&(n.isActiveAndEnabled&&n.onStart(),this._startBehaviours.splice(t,1))}for(r=this._components.length,t=0;r>t;++t){var n=this._components[t];n.isActiveAndEnabled&&n.onUpdate(e.Time.deltaTime)}for(t=0;r>t;++t){var n=this._components[t];n.isActiveAndEnabled&&n.onLateUpdate(e.Time.deltaTime)}if(this._onDisableBehaviours.length>0){for(var p=0,d=this._onDisableBehaviours;p<d.length;p++){var n=d[p];n.isActiveAndEnabled||n.onDisable()}this._onDisableBehaviours.length=0}}},r}(e.BaseSystem);e.BehaviourSystem=r,__reflect(r.prototype,"paper.BehaviourSystem")}(paper||(paper={}));var paper;!function(e){var t=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return __extends(r,t),r.prototype.initialize=function(){t.prototype.initialize.call(this),(!e.Application.isEditor||e._executeInEditModeComponents.indexOf(this.constructor)>=0)&&this.onAwake()},r.prototype.uninitialize=function(){(!e.Application.isEditor||e._executeInEditModeComponents.indexOf(this.constructor)>=0)&&this.onDestroy(),t.prototype.uninitialize.call(this)},r.prototype.onAwake=function(){},r.prototype.onEnable=function(){},r.prototype.onReset=function(){},r.prototype.onStart=function(){},r.prototype.onFixedUpdate=function(){},r.prototype.onUpdate=function(e){},r.prototype.onLateUpdate=function(e){},r.prototype.onDisable=function(){},r.prototype.onDestroy=function(){},r}(e.BaseComponent);e.Behaviour=t,__reflect(t.prototype,"paper.Behaviour")}(paper||(paper={}));var paper;!function(e){var t=function(){function e(){}return e.initialize=function(){this._lastTimer=this._beginTimer=this.now},e.update=function(e){var t=e||this.now;this._frameCount+=1,this._unscaledTime=t-this._beginTimer,this._unscaledDeltaTime=t-this._lastTimer,this._lastTimer=t},Object.defineProperty(e,"now",{get:function(){return window.performance?.001*window.performance.now():Date.now?.001*Date.now():.001*(new Date).getTime()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"frameCount",{get:function(){return this._frameCount},enumerable:!0,configurable:!0}),Object.defineProperty(e,"time",{get:function(){return this._unscaledTime*this.timeScale},enumerable:!0,configurable:!0}),Object.defineProperty(e,"unscaledTime",{get:function(){return this._unscaledTime},enumerable:!0,configurable:!0}),Object.defineProperty(e,"deltaTime",{get:function(){return this._unscaledDeltaTime*this.timeScale},enumerable:!0,configurable:!0}),Object.defineProperty(e,"unscaledDeltaTime",{get:function(){return this._unscaledDeltaTime},enumerable:!0,configurable:!0}),e.timeScale=1,e._frameCount=0,e._lastTimer=0,e._beginTimer=0,e._unscaledTime=0,e._unscaledDeltaTime=0,e}();e.Time=t,__reflect(t.prototype,"paper.Time")}(paper||(paper={}));var egret3d;!function(e){var t=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return __extends(r,t),r.prototype.update=function(){this._components.sort(function(e,t){return e.order-t.order});for(var t=paper.Application.systemManager.getSystem(e.LightSystem),r=t?t.components:null,a=null,i=0,n=this._components;i<n.length;i++){var s=n[i];"EditorCamera"===s.gameObject.tag&&(a=s),s.update(paper.Time.deltaTime),r&&r.length>0&&s.context.updateLights(r)}a?(a.context.drawtype="",a._targetAndViewport(a.renderTarget,!1),this.$renderCamera(a)):(e.WebGLKit.webgl.clearColor(0,0,0,1),e.WebGLKit.webgl.clearDepth(1),e.WebGLKit.webgl.clear(e.WebGLKit.webgl.COLOR_BUFFER_BIT|e.WebGLKit.webgl.DEPTH_BUFFER_BIT))},r}(e.CameraSystem);e.EditorCameraSystem=t,__reflect(t.prototype,"egret3d.EditorCameraSystem")}(egret3d||(egret3d={}));var paper;!function(e){function t(t){for(var r in e.serializeClassMap)if(e.serializeClassMap[r]===t)return r;return""}function r(t){var r=t.__proto__,a=r.__class__,i=e.findClassCode(a);return i}e.serializeClassMap={0:"paper.Scene",1:"paper.GameObject",2:"egret3d.AniPlayer",3:"egret3d.BoxCollider",4:"egret3d.Camera",5:"egret3d.MeshFilter",6:"egret3d.MeshRenderer",7:"egret3d.ParticleSystem",8:"egret3d.ParticleSystemRenderer",9:"egret3d.SkinnedMeshRenderer",10:"egret3d.SphereCollider",11:"egret3d.Transform",12:"egret3d.Shader",13:"egret3d.Mesh",14:"egret3d.Material",15:"egret3d.AnimationClip",16:"egret3d.TPoseInfo",17:"egret3d.PoseBoneMatrix",18:"egret3d.Texture",19:"egret3d.Texture",20:"egret3d.Vector2",21:"egret3d.Vector3",22:"egret3d.Vector4",23:"egret3d.Quaternion",24:"egret3d.Color",25:"egret3d.Gradient",26:"egret3d.Curve",27:"egret3d.Keyframe",28:"egret3d.Rect",29:"egret3d.MainModule",30:"egret3d.EmissionModule",31:"egret3d.ShapeModule",32:"egret3d.VelocityOverLifetimeModule",33:"egret3d.RotationOverLifetimeModule",34:"egret3d.ColorOverLifetimeModule",35:"egret3d.SizeOverLifetimeModule",36:"egret3d.MinMaxCurve",37:"egret3d.MinMaxGradient",38:"egret3d.alphaKey",39:"egret3d.colorKey",40:"egret3d.Animation",41:"egret3d.GLTFAsset"},e.findClassCode=t,e.findClassCodeFrom=r}(paper||(paper={}));var egret3d;!function(e){var t;!function(e){e[e.once=0]="once",e[e.loop=1]="loop",e[e.pingpong=2]="pingpong"}(t=e.pathtype||(e.pathtype={}));var r;!function(e){e[e.VertexPoint=0]="VertexPoint",e[e.ControlPoint=1]="ControlPoint"}(r||(r={}));var a=function(a){function i(){var e=null!==a&&a.apply(this,arguments)||this;return e.paths=[],e.items=[],e.lines=[],e}return __extends(i,a),i.prototype.dispose=function(){this.paths.length=0},i.prototype.caclByteLength=function(){if(this.paths){var e=this.paths.length,t=12*e;return t}},i.prototype.$parse=function(a){var i=a.type;switch(i){case"once":this.type=t.once;break;case"loop":this.type=t.loop;break;case"pingpong":this.type=t.pingpong}this.instertPointcount=a.insertPointcount;var n=a.path;for(var s in n){var o={type:void 0,point:void 0},h=n[s],l=h.type;switch(l){case"VertexPoint":o.type=r.VertexPoint;break;case"ControlPoint":o.type=r.ControlPoint}var c=h.point,u=c.split(",");o.point=new e.Vector3(parseFloat(u[0]),parseFloat(u[1]),parseFloat(u[2])),this.items.push(o)}this.getpaths(),this.items.length=0;for(var p=0;p<this.lines.length;p++)this.lines[p].length=0;this.lines.length=0},i.prototype.getpaths=function(){for(var e=new Array,a=0;a<this.items.length;a++){var i=this.items[a];0==a?(e.push(i.point),this.lines.push(e)):a==this.items.length-1?this.type==t.loop?i.type==r.VertexPoint?(e.push(i.point),e=new Array,e.push(i.point),e.push(this.items[0].point),this.lines.push(e)):(e.push(i.point),e.push(this.items[0].point)):e.push(i.point):i.type==r.VertexPoint?(e.push(i.point),e=new Array,e.push(i.point),this.lines.push(e)):e.push(i.point)}for(var n=this.lines.length,s=0,a=0;n>a;a++)if(a==n-1)for(var o=0;o<this.instertPointcount;o++){var h=o/(this.instertPointcount-1);this.paths[s]=this.getBezierPointAlongCurve(this.lines[a],h),s++}else for(var o=0;o<this.instertPointcount;o++){var h=o/this.instertPointcount;this.paths[s]=this.getBezierPointAlongCurve(this.lines[a],h),s++}},i.prototype.getBezierPointAlongCurve=function(t,r,a){void 0===a&&(a=!1);var i=t.length;if(t.length<2)return void console.log("need more than 2 point to calculate bezier!");if(2==i){var n=new e.Vector3;return this.vec3Lerp(t[0],t[1],r,n),a&&(t.length=0),n}for(var s=[],o=0;i-1>o;o++){var h=new e.Vector3;this.vec3Lerp(t[o],t[o+1],r,h),s[o]=h}return a&&(t.length=0),this.getBezierPointAlongCurve(s,r,!0)},i.prototype.vec3Lerp=function(t,r,a,i){e.Vector3.subtract(r,t,i),e.Vector3.scale(i,a),e.Vector3.add(t,i,i)},i}(paper.Asset);e.PathAsset=a,__reflect(a.prototype,"egret3d.PathAsset")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createInstance=function(){return this._raw?paper.deserialize(this._raw,this._assets):null},t}(e.BaseObjectAsset);e.RawScene=t,__reflect(t.prototype,"egret3d.RawScene")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.dispose=function(){this.buffer=null},t.prototype.caclByteLength=function(){return this.buffer?this.buffer.length:void 0},t}(paper.Asset);e.Sound=t,__reflect(t.prototype,"egret3d.Sound")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.atlas="",r.rect=new e.Rect,r.border=new e.Border,r._urange=null,r._vrange=null,r._texture=null,r}return __extends(r,t),r.spriteAnimation=function(e,t,r,a){var i=1/t,n=1/e,s=i*(r%t),o=n*Math.floor(r/t);a.x=i,a.y=n,a.z=s,a.w=o},r.prototype.dispose=function(){this.atlas="",this._urange=null,this._vrange=null,this._texture=null},r.prototype.caclByteLength=function(){var e=0;return this._texture&&(e+=this._texture.caclByteLength()),e},Object.defineProperty(r.prototype,"urange",{get:function(){return this._urange||(this._urange=new e.Vector2,this._texture?(this._urange.x=this.rect.x/this._texture.glTexture.width,this._urange.y=(this.rect.x+this.rect.w)/this._texture.glTexture.width):(this._urange.x=0,this._urange.y=1)),this._urange},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"vrange",{get:function(){return this._vrange||(this._vrange=new e.Vector2,this._texture?(this._vrange.x=this.rect.y/this._texture.glTexture.height,this._vrange.y=(this.rect.y+this.rect.h)/this._texture.glTexture.height):(this._vrange.x=0,this._vrange.y=1)),this._vrange},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"texture",{get:function(){return this._texture},set:function(e){this._urange=null,this._vrange=null,this._texture=e},enumerable:!0,configurable:!0}),r}(paper.Asset);e.Sprite=t,__reflect(t.prototype,"egret3d.Sprite")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e.content="",e}return __extends(r,t),r.prototype.dispose=function(){this.content=""},r.prototype.caclByteLength=function(){return this.content?e.utils.caclStringByteLength(this.content):0},r}(paper.Asset);e.TextAsset=t,__reflect(t.prototype,"egret3d.TextAsset")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e._realName="",e}return __extends(r,t),r.prototype.dispose=function(){this.glTexture.dispose(e.WebGLKit.webgl)},r.prototype.caclByteLength=function(){return this.glTexture?this.glTexture.caclByteLength():0},Object.defineProperty(r.prototype,"realName",{get:function(){return this._realName
},set:function(e){this._realName=e},enumerable:!0,configurable:!0}),r}(paper.Asset);e.Texture=t,__reflect(t.prototype,"egret3d.Texture")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(){function e(){this._instances=[]}return e.prototype.add=function(e){if(Array.isArray(e))for(var t=0,r=e;t<r.length;t++){var a=r[t];this._instances.indexOf(a)<0&&this._instances.push(a)}else this._instances.indexOf(e)<0&&this._instances.push(e)},e.prototype.remove=function(e){if(Array.isArray(e))for(var t=0,r=e;t<r.length;t++){var a=r[t],i=this._instances.indexOf(a);i>=0&&this._instances.splice(i,1)}else{var i=this._instances.indexOf(e);i>=0&&this._instances.splice(i,1)}},e.prototype.clear=function(){this._instances.length=0},Object.defineProperty(e.prototype,"instances",{get:function(){return this._instances},enumerable:!0,configurable:!0}),e.drawCall=new e,e.shadowCaster=new e,e}();e.Pool=t,__reflect(t.prototype,"egret3d.Pool")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(){function t(e){this._drawCalls={},this._createDrawCalls=e}return t.updateZdist=function(e){},t.sort=function(){e.Pool.drawCall.instances.sort(function(e,t){return e.material.renderQueue===t.material.renderQueue?t.zdist-e.zdist:e.material.renderQueue-t.material.renderQueue})},t.prototype.updateDrawCalls=function(t,r){this.removeDrawCalls(t);var a=this._createDrawCalls(t);a&&(this._drawCalls[t.hashCode]=a,e.Pool.drawCall.add(a),r&&e.Pool.shadowCaster.add(a))},t.prototype.updateShadowCasters=function(t,r){if(t.hashCode in this._drawCalls){var a=this._drawCalls[t.hashCode];if(r)for(var i=0,n=a;i<n.length;i++){var s=n[i];e.Pool.shadowCaster.add(s)}else for(var o=0,h=a;o<h.length;o++){var s=h[o];e.Pool.shadowCaster.remove(s)}}},t.prototype.removeDrawCalls=function(t){if(t.hashCode in this._drawCalls){var r=this._drawCalls[t.hashCode];e.Pool.drawCall.remove(r),e.Pool.shadowCaster.remove(r),delete this._drawCalls[t.hashCode]}},t.prototype.getDrawCalls=function(e){return e.hashCode in this._drawCalls?this._drawCalls[e.hashCode]:null},t}();e.DrawCallList=t,__reflect(t.prototype,"egret3d.DrawCallList")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(paper.BaseComponent);e.Audio3DListener=t,__reflect(t.prototype,"egret3d.Audio3DListener")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r._interests=[{componentClass:e.Audio3DListener}],r}return __extends(r,t),r.prototype._updateAudioListener=function(t){if(t.gameObject){var r=t.gameObject.transform.getPosition();e.sound.WebAudio.instance.getAudioListener().setPosition(r.x,r.y,r.z);var a=t.gameObject.transform.getWorldMatrix();e.sound.WebAudio.instance.getAudioListener().setOrientation(a)}},r.prototype.update=function(){for(var e=0,t=this._components;e<t.length;e++){var r=t[e];this._updateAudioListener(r)}},r}(paper.BaseSystem);e.Audio3DListenerSystem=t,__reflect(t.prototype,"egret3d.Audio3DListenerSystem")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e._volume=1,e._loop=!1,e._playing=!1,e}return __extends(r,t),Object.defineProperty(r.prototype,"sound",{set:function(t){this._channel&&this._playing&&(this._channel.stop(),this._channel.dispose()),e.sound.WebAudio.instance.isSupported&&(this._channel=new e.sound.WebAudioChannel2D,this._channel.buffer=t.buffer,this._sound=t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"volume",{get:function(){return this._volume},set:function(e){this._channel&&(this._channel.volume=e,this._volume=e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"loop",{get:function(){return this._loop},set:function(e){this._channel&&(this._channel.loop=e,this._loop=e)},enumerable:!0,configurable:!0}),r.prototype.play=function(e){this._channel&&(this._channel.start(e),this._playing=!0)},r.prototype.stop=function(){this._channel&&(this._channel.stop(),this._playing=!1)},__decorate([editor.property(editor.EditType.SOUND)],r.prototype,"sound",null),__decorate([editor.property(editor.EditType.NUMBER)],r.prototype,"volume",null),__decorate([editor.property(editor.EditType.CHECKBOX)],r.prototype,"loop",null),r}(paper.BaseComponent);e.AudioSource2D=t,__reflect(t.prototype,"egret3d.AudioSource2D")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e._volume=1,e._loop=!1,e._playing=!1,e}return __extends(r,t),r.prototype.update=function(e){if(this._channel&&this._playing&&this.gameObject){var t=this.gameObject.transform.getPosition();this._channel.setPosition(t.x,t.y,t.z)}},Object.defineProperty(r.prototype,"sound",{set:function(t){this._channel&&this._playing&&(this._channel.stop(),this._channel.dispose()),e.sound.WebAudio.instance.isSupported&&(this._channel=new e.sound.WebAudioChannel3D,this._channel.buffer=t.buffer,this._sound=t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"volume",{get:function(){return this._volume},set:function(e){this._channel&&(this._channel.volume=e,this._volume=e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"loop",{get:function(){return this._loop},set:function(e){this._channel&&(this._channel.loop=e,this._loop=e)},enumerable:!0,configurable:!0}),r.prototype.play=function(e){this._channel&&!this._playing&&(this._channel.start(e),this._playing=!0)},r.prototype.stop=function(){this._channel&&this._playing&&(this._channel.stop(),this._playing=!1)},Object.defineProperty(r.prototype,"maxDistance",{get:function(){return this._channel?this._channel.maxDistance:0},set:function(e){this._channel&&(this._channel.maxDistance=e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"minDistance",{get:function(){return this._channel?this._channel.minDistance:0},set:function(e){this._channel&&(this._channel.minDistance=e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rollOffFactor",{get:function(){return this._channel?this._channel.rollOffFactor:0},set:function(e){this._channel&&(this._channel.rollOffFactor=e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"distanceModel",{get:function(){return this._channel?this._channel.distanceModel:""},set:function(e){this._channel&&(this._channel.distanceModel=e)},enumerable:!0,configurable:!0}),r.prototype.getVelocity=function(){return this._channel?this._channel.getVelocity():new e.Vector3},r.prototype.setVelocity=function(e,t,r){this._channel&&this._channel.setVelocity(e,t,r)},__decorate([editor.property(editor.EditType.SOUND)],r.prototype,"sound",null),__decorate([editor.property(editor.EditType.NUMBER)],r.prototype,"volume",null),__decorate([editor.property(editor.EditType.CHECKBOX)],r.prototype,"loop",null),__decorate([editor.property(editor.EditType.NUMBER)],r.prototype,"maxDistance",null),__decorate([editor.property(editor.EditType.NUMBER)],r.prototype,"minDistance",null),__decorate([editor.property(editor.EditType.NUMBER)],r.prototype,"rollOffFactor",null),__decorate([editor.property(editor.EditType.LIST,{listItems:[{label:"linear",value:"linear"},{label:"inverse",value:"inverse"},{label:"exponential",value:"exponential"}]})],r.prototype,"distanceModel",null),r}(paper.BaseComponent);e.AudioSource3D=t,__reflect(t.prototype,"egret3d.AudioSource3D")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r._interests=[{componentClass:e.AudioSource3D}],r}return __extends(r,t),r.prototype.update=function(){for(var e=paper.Time.deltaTime,t=0,r=this._components;t<r.length;t++){var a=r[t];a.update(e)}},r}(paper.BaseSystem);e.AudioSource3DSystem=t,__reflect(t.prototype,"egret3d.AudioSource3DSystem")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r._bounds=new e.OBB,r}return __extends(r,t),Object.defineProperty(r.prototype,"bounds",{get:function(){return this._bounds},enumerable:!0,configurable:!0}),__decorate([paper.serializedField],r.prototype,"_bounds",void 0),r}(paper.BaseComponent);e.BaseCollider=t,__reflect(t.prototype,"egret3d.BaseCollider");var r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._dirtyMask=0,t}return __extends(t,e),t.prototype.initialize=function(){e.prototype.initialize.call(this),this._dirtyMask|=1,this._center=this._bounds.center,this._size=this._bounds.size},Object.defineProperty(t.prototype,"center",{get:function(){return this._center},set:function(e){this._dirtyMask|=1,this._center.x=e.x,this._center.y=e.y,this._center.z=e.z},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._size},set:function(e){this._dirtyMask|=1,this._size.x=e.x,this._size.y=e.y,this._size.z=e.z},enumerable:!0,configurable:!0}),t}(t);e.BoxCollider=r,__reflect(r.prototype,"egret3d.BoxCollider")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r._interests=[{componentClass:e.BoxCollider}],r}return __extends(r,t),r.prototype.update=function(){for(var e=0,t=this._components.length;t>e;e+=this._interestComponentCount){var r=this._components[e];if(0!==r._dirtyMask&&1&r._dirtyMask){r._dirtyMask&=-2;var a=r.bounds;a&&a.setByCenterSize(a.center,a.size)}var i=r.gameObject.transform.getWorldMatrix();r.bounds.update(i)}},r}(paper.BaseSystem);e.BoxColliderSystem=t,__reflect(t.prototype,"egret3d.BoxColliderSystem")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.clearOption_Color=!0,r.clearOption_Depth=!0,r.cullingMask=6,r.order=0,r.fov=.25*Math.PI,r.size=2,r.opvalue=1,r.backgroundColor=new e.Color(.13,.28,.51,1),r.viewport=new e.Rect(0,0,1,1),r.postQueues=[],r.renderTarget=null,r.context=null,r._near=.01,r._far=1e3,r.matView=new e.Matrix,r.matProjP=new e.Matrix,r.matProjO=new e.Matrix,r.matProj=new e.Matrix,r.frameVecs=[new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3],r}return __extends(r,t),Object.defineProperty(r,"main",{get:function(){var e=paper.GameObject.findWithTag("MainCamera");return e?e.getComponent(r):null},enumerable:!0,configurable:!0}),r.prototype.calcCameraFrame=function(){var t=e.helpRectA;this.calcViewPortPixel(t);var r=this.frameVecs[0],a=this.frameVecs[1],i=this.frameVecs[2],n=this.frameVecs[3],s=this.frameVecs[4],o=this.frameVecs[5],h=this.frameVecs[6],l=this.frameVecs[7],c=this.near*Math.tan(.5*this.fov),u=t.w/t.h,p=c*u;e.Vector3.set(-p,c,this.near,o),e.Vector3.set(-p,-c,this.near,a),e.Vector3.set(p,c,this.near,l),e.Vector3.set(p,-c,this.near,n);var d=this.far*Math.tan(.5*this.fov),f=d*u;e.Vector3.set(-f,d,this.far,s),e.Vector3.set(-f,-d,this.far,r),e.Vector3.set(f,d,this.far,h),e.Vector3.set(f,-d,this.far,i);var _=this.gameObject.transform.getWorldMatrix();e.Matrix.transformVector3(r,_,r),e.Matrix.transformVector3(a,_,a),e.Matrix.transformVector3(i,_,i),e.Matrix.transformVector3(n,_,n),e.Matrix.transformVector3(s,_,s),e.Matrix.transformVector3(o,_,o),e.Matrix.transformVector3(h,_,h),e.Matrix.transformVector3(l,_,l)},r.prototype._targetAndViewport=function(t,r){var a,i,n=e.WebGLKit.webgl;t?(a=t.width,i=t.height,t.use(n)):(a=e.stage.screenViewport.w,i=e.stage.screenViewport.h,e.GlRenderTarget.useNull(n)),n.viewport(a*this.viewport.x,i*this.viewport.y,a*this.viewport.w,i*this.viewport.h),n.depthRange(0,1),r||(this.clearOption_Color&&this.clearOption_Depth?(e.WebGLKit.zWrite(!0),n.clearColor(this.backgroundColor.r,this.backgroundColor.g,this.backgroundColor.b,this.backgroundColor.a),n.clearDepth(1),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT)):this.clearOption_Depth?(e.WebGLKit.zWrite(!0),n.clearDepth(1),n.clear(n.DEPTH_BUFFER_BIT)):this.clearOption_Color&&(n.clearColor(this.backgroundColor.r,this.backgroundColor.g,this.backgroundColor.b,this.backgroundColor.a),n.clear(n.COLOR_BUFFER_BIT)))},r.prototype.deserialize=function(e){this.fov=e.fov,this.opvalue=e.opvalue,this._near=e._near,this._far=e._far,this.cullingMask=e.cullingMask,this.order=e.order,this.clearOption_Color=e.clearOption_Color,this.clearOption_Depth=e.clearOption_Depth,this.backgroundColor.deserialize(e.backgroundColor),this.viewport.deserialize(e.viewport)},r.prototype.initialize=function(){t.prototype.initialize.call(this),this.context=new e.RenderContext,this.near=this._near,this.far=this._far},r.prototype.update=function(e){this.calcCameraFrame(),this.context.updateCamera(this)},r.prototype.calcViewMatrix=function(t){var r=this.gameObject.transform.getWorldMatrix();return e.Matrix.inverse(r,this.matView),e.Matrix.copy(this.matView,t),t},r.prototype.calcProjectMatrix=function(t,r){return this.opvalue>0&&e.Matrix.perspectiveProjectLH(this.fov,t,this.near,this.far,this.matProjP),this.opvalue<1&&e.Matrix.orthoProjectLH(this.size*t,this.size,this.near,this.far,this.matProjO),0===this.opvalue?e.Matrix.copy(this.matProjO,this.matProj):1===this.opvalue?e.Matrix.copy(this.matProjP,this.matProj):e.Matrix.lerp(this.matProjO,this.matProjP,this.opvalue,this.matProj),e.Matrix.copy(this.matProj,r),r},r.prototype.calcViewPortPixel=function(t){var r,a,i=this.renderTarget,n=this.viewport;i?(r=i.width,a=i.height):(r=e.stage.screenViewport.w,a=e.stage.screenViewport.h),t.x=r*n.x,t.y=a*n.y,t.w=r*n.w,t.h=a*n.h},r.prototype.createRayByScreen=function(t,r){var a=e.helpVector3C;a.x=t,a.y=r,a.z=0;var i=e.helpVector3D;i.x=t,i.y=r,i.z=1;var n=e.helpVector3E,s=e.helpVector3F;this.calcWorldPosFromScreenPos(a,n),this.calcWorldPosFromScreenPos(i,s);var o=e.helpVector3G;e.Vector3.subtract(s,n,o),e.Vector3.normalize(o);var h=new e.Ray(n,o);return h},r.prototype.calcWorldPosFromScreenPos=function(t,r){var a=e.helpRectA;this.calcViewPortPixel(a);var i=e.helpVector3A;i.x=t.x/a.w*2-1,i.y=1-t.y/a.h*2,i.z=t.z;var n=e.helpMatrixA,s=e.helpMatrixB,o=a.w/a.h;this.calcViewMatrix(n),this.calcProjectMatrix(o,s);var h=e.helpMatrixC,l=e.helpMatrixD;e.Matrix.multiply(s,n,h),e.Matrix.inverse(h,l),e.Matrix.transformVector3(i,l,r)},r.prototype.calcScreenPosFromWorldPos=function(t,r){var a=e.helpRectA;this.calcViewPortPixel(a);var i=e.helpMatrixA,n=e.helpMatrixB,s=a.w/a.h;this.calcViewMatrix(i),this.calcProjectMatrix(s,n);var o=e.helpMatrixC;e.Matrix.multiply(n,i,o);var h=e.helpVector3A;e.Matrix.transformVector3(t,o,h),r.x=(h.x+1)*a.w*.5,r.y=(1-h.y)*a.h*.5},r.prototype.getPosAtXPanelInViewCoordinateByScreenPos=function(t,r,a){var i=e.helpRectA;this.calcViewPortPixel(i);var n=e.helpVector3A;n.z=-this.near,n.x=t.x-.5*i.w,n.y=.5*i.h-t.y;var s=e.helpVector3B;s.z=-this.far,s.x=this.far*n.x/this.near,s.y=this.far*n.y/this.near;var o=(n.z-r)/(n.z-s.z);a.x=n.x-(n.x-s.x)*o,a.y=n.y-(n.y-s.y)*o},r.prototype.testFrustumCulling=function(e){var t=e.aabb;return t.intersectPlane(this.frameVecs[0],this.frameVecs[1],this.frameVecs[5])&&t.intersectPlane(this.frameVecs[1],this.frameVecs[3],this.frameVecs[7])&&t.intersectPlane(this.frameVecs[3],this.frameVecs[2],this.frameVecs[6])&&t.intersectPlane(this.frameVecs[2],this.frameVecs[0],this.frameVecs[4])&&t.intersectPlane(this.frameVecs[5],this.frameVecs[7],this.frameVecs[6])&&t.intersectPlane(this.frameVecs[0],this.frameVecs[2],this.frameVecs[3])?!0:!1},Object.defineProperty(r.prototype,"near",{get:function(){return this._near},set:function(e){e>=this.far&&(e=this.far-1),.01>e&&(e=.01),this._near=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"far",{get:function(){return this._far},set:function(e){e<=this.near&&(e=this.near+1),e>=1e3&&(e=1e3),this._far=e},enumerable:!0,configurable:!0}),__decorate([paper.serializedField],r.prototype,"clearOption_Color",void 0),__decorate([paper.serializedField],r.prototype,"clearOption_Depth",void 0),__decorate([paper.serializedField],r.prototype,"cullingMask",void 0),__decorate([paper.serializedField],r.prototype,"order",void 0),__decorate([paper.serializedField],r.prototype,"fov",void 0),__decorate([paper.serializedField],r.prototype,"size",void 0),__decorate([paper.serializedField],r.prototype,"opvalue",void 0),__decorate([paper.serializedField],r.prototype,"backgroundColor",void 0),__decorate([paper.serializedField],r.prototype,"viewport",void 0),__decorate([paper.serializedField],r.prototype,"_near",void 0),__decorate([paper.serializedField],r.prototype,"_far",void 0),r}(paper.BaseComponent);e.Camera=t,__reflect(t.prototype,"egret3d.Camera")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(){function t(){this.renderTarget=null}return t.prototype.render=function(t,r){var a=e.WebGLKit.webgl;t._targetAndViewport(this.renderTarget,!0),e.WebGLKit.zWrite(!0),a.clearColor(0,0,0,0),a.clearDepth(1),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),t.context.drawtype="_depth",r.$renderCamera(t),e.GlRenderTarget.useNull(a)},t}();e.CameraPostQueueDepth=t,__reflect(t.prototype,"egret3d.CameraPostQueueDepth",["egret3d.ICameraPostQueue"]);var r=function(){function t(){this.material=new e.Material,this.renderTarget=null}return t.prototype.render=function(t,r){var a=e.WebGLKit.webgl;t._targetAndViewport(this.renderTarget,!0),e.WebGLKit.zWrite(!0),a.clearColor(0,.3,0,0),a.clearDepth(1),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);var i=e.DefaultMeshes.QUAD;t.context.drawtype="",e.WebGLKit.draw(t.context,this.material,i,0,"quad")},t}();e.CameraPostQueueQuad=r,__reflect(r.prototype,"egret3d.CameraPostQueueQuad",["egret3d.ICameraPostQueue"]);var a=function(){function t(){this.renderTarget=null}return t.prototype.render=function(t,r){var a=e.WebGLKit.webgl;t._targetAndViewport(this.renderTarget,!1),t.context.drawtype="",r.$renderCamera(t),e.GlRenderTarget.useNull(a)},t}();e.CameraPostQueueColor=a,__reflect(a.prototype,"egret3d.CameraPostQueueColor",["egret3d.ICameraPostQueue"])}(egret3d||(egret3d={}));var egret3d;!function(e){var t=new e.Vector3,r=function(){function r(){this.receiveShadow=!1,this.version=0,this.lightmapUV=1,this.lightCount=0,this.directLightCount=0,this.pointLightCount=0,this.spotLightCount=0,this.drawtype="",this.lightmap=null,this.boneData=null,this.directLightArray=new Float32Array(0),this.pointLightArray=new Float32Array(0),this.spotLightArray=new Float32Array(0),this.directShadowMatrix=new Float32Array(0),this.spotShadowMatrix=new Float32Array(0),this.matrix_m=new e.Matrix,this.matrix_mvp=new e.Matrix,this.directShadowMaps=[],this.pointShadowMaps=[],this.spotShadowMaps=[],this.viewPortPixel={x:0,y:0,w:0,h:0},this.matrix_v=new e.Matrix,this.matrix_p=new e.Matrix,this.matrix_mv=new e.Matrix,this.matrix_vp=new e.Matrix,this.lightmapOffset=new Float32Array([1,1,0,0]),this.lightPosition=new Float32Array([0,0,0,1]),this.lightShadowCameraNear=0,this.lightShadowCameraFar=0}return r.prototype.updateLightmap=function(e,t,r){this.lightmap=e,this.lightmapUV=t,this.lightmapOffset[0]=r.x,this.lightmapOffset[1]=r.y,this.lightmapOffset[2]=r.z,this.lightmapOffset[3]=r.w,this.version++},r.prototype.updateCamera=function(t){var r=this.viewPortPixel;t.calcViewPortPixel(r);var a=r.w/r.h;t.calcViewMatrix(this.matrix_v),t.calcProjectMatrix(a,this.matrix_p),e.Matrix.multiply(this.matrix_p,this.matrix_v,this.matrix_vp),this.version++},r.prototype.updateLights=function(r){for(var a=0,i=0,n=0,s=0,o=0,h=r;o<h.length;o++){var l=h[o];switch(l.type){case e.LightTypeEnum.Direction:i++;break;case e.LightTypeEnum.Point:n++;break;case e.LightTypeEnum.Spot:s++}a++}this.directLightArray.length!==15*i&&(this.directLightArray=new Float32Array(15*i)),this.pointLightArray.length!==19*n&&(this.pointLightArray=new Float32Array(19*n)),this.spotLightArray.length!==19*s&&(this.spotLightArray=new Float32Array(19*s)),this.directShadowMatrix.length!==16*i&&(this.directShadowMatrix=new Float32Array(16*i)),this.spotShadowMatrix.length!==16*s&&(this.spotShadowMatrix=new Float32Array(16*s)),this.directShadowMaps.length=i,this.pointShadowMaps.length=n,this.spotShadowMaps.length=s,this.lightCount=a,this.directLightCount=i,this.pointLightCount=n,this.spotLightCount=s;for(var c=0,u=0,p=0,d=0,f=0,_=0,g=r;_<g.length;_++){var l=g[_],m=this.directLightArray;l.type===e.LightTypeEnum.Direction?(m=this.directLightArray,d=c,f=15):l.type===e.LightTypeEnum.Point?(m=this.pointLightArray,d=u,f=19):l.type===e.LightTypeEnum.Spot&&(m=this.spotLightArray,d=p,f=19);var v=0,y=l.gameObject.transform.getPosition();m[d*f+v++]=y.x,m[d*f+v++]=y.y,m[d*f+v++]=y.z;var w=l.gameObject.transform.getForward(t);m[d*f+v++]=w.x,m[d*f+v++]=w.y,m[d*f+v++]=w.z,m[d*f+v++]=l.color.r,m[d*f+v++]=l.color.g,m[d*f+v++]=l.color.b,m[d*f+v++]=l.intensity,(l.type===e.LightTypeEnum.Point||l.type===e.LightTypeEnum.Spot)&&(m[d*f+v++]=l.distance,m[d*f+v++]=l.decay,l.type===e.LightTypeEnum.Spot&&(m[d*f+v++]=Math.cos(l.angle),m[d*f+v++]=Math.cos(l.angle*(1-l.penumbra)))),l.castShadows?(m[d*f+v++]=1,l.type===e.LightTypeEnum.Direction?(m[d*f+v++]=l.$directLightShadow.bias,m[d*f+v++]=l.$directLightShadow.radius,m[d*f+v++]=l.$directLightShadow.windowSize,m[d*f+v++]=l.$directLightShadow.windowSize,this.directShadowMatrix.set(l.$directLightShadow.matrix.rawData,16*c),this.directShadowMaps[c]=l.$directLightShadow.map):l.type===e.LightTypeEnum.Point?(m[d*f+v++]=l.$pointLightShadow.bias,m[d*f+v++]=l.$pointLightShadow.radius,m[d*f+v++]=l.$pointLightShadow.camera.near,m[d*f+v++]=l.$pointLightShadow.camera.far,m[d*f+v++]=l.$pointLightShadow.windowSize,m[d*f+v++]=l.$pointLightShadow.windowSize,this.pointShadowMaps[u]=l.$pointLightShadow.map):l.type===e.LightTypeEnum.Spot&&(m[d*f+v++]=l.$spotLightShadow.bias,m[d*f+v++]=l.$spotLightShadow.radius,m[d*f+v++]=l.$spotLightShadow.windowSize,m[d*f+v++]=l.$spotLightShadow.windowSize,this.spotShadowMatrix.set(l.$spotLightShadow.matrix.rawData,16*p),this.spotShadowMaps[p]=l.$spotLightShadow.map)):(m[d*f+v++]=0,m[d*f+v++]=0,m[d*f+v++]=0,m[d*f+v++]=0,m[d*f+v++]=0,l.type===e.LightTypeEnum.Direction?this.directShadowMaps[c]=null:l.type===e.LightTypeEnum.Point?this.pointShadowMaps[u]=null:l.type===e.LightTypeEnum.Spot&&(this.spotShadowMaps[p]=null)),l.type===e.LightTypeEnum.Direction?c++:l.type===e.LightTypeEnum.Point?u++:l.type===e.LightTypeEnum.Spot&&p++}this.version++},r.prototype.updateOverlay=function(){e.Matrix.identify(this.matrix_mvp),this.version++},r.prototype.updateModel=function(t){e.Matrix.copy(t.getWorldMatrix(),this.matrix_m),e.Matrix.multiply(this.matrix_v,this.matrix_m,this.matrix_mv),e.Matrix.multiply(this.matrix_vp,this.matrix_m,this.matrix_mvp),this.version++},r.prototype.updateModeTrail=function(){e.Matrix.copy(this.matrix_v,this.matrix_mv),e.Matrix.copy(this.matrix_vp,this.matrix_mvp),this.version++},r.prototype.updateBones=function(e){this.boneData=e,this.version++},r.prototype.updateLightDepth=function(t){var r=null;switch(t.type){case e.LightTypeEnum.Direction:r=t.$directLightShadow;break;case e.LightTypeEnum.Point:r=t.$pointLightShadow;break;case e.LightTypeEnum.Spot:r=t.$spotLightShadow}this.lightPosition=t.gameObject.transform.$getGlobalPosition(),r&&(this.lightShadowCameraNear=r.camera.near,this.lightShadowCameraFar=r.camera.far)},r}();e.RenderContext=r,__reflect(r.prototype,"egret3d.RenderContext")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(t){function r(){var r=t.call(this)||this;return r.frustumTest=!1,r._screenAdapter=new e.ConstantAdapter,r._catchedEvent={},r._stageWidth=0,r._stageHeight=0,r._scaler=1,r.stage=new egret.Stage,r.stage.maxTouches=1,r.root=new egret.DisplayObjectContainer,r.stage.addChild(r.root),r}return __extends(r,t),Object.defineProperty(r.prototype,"screenAdapter",{get:function(){return this._screenAdapter},set:function(e){e.$dirty=!0,this._screenAdapter=e},enumerable:!0,configurable:!0}),r.prototype.initialize=function(){t.prototype.initialize.call(this);var r=e.WebGLKit.webgl;this.renderer||(this.renderer=egret.web.Renderer.getInstance(r));var a=this.stage,i=new egret.sys.DisplayList(a);i.renderBuffer=new egret.sys.RenderBuffer(void 0,void 0,!0),a.$displayList=i,e.InputManager.touch.addEventListener("touchstart",this._onTouchStart,this),e.InputManager.touch.addEventListener("touchend",this._onTouchEnd,this),e.InputManager.touch.addEventListener("touchcancel",this._onTouchEnd,this),e.InputManager.touch.addEventListener("touchmove",this._onTouchMove,this),e.InputManager.mouse.addEventListener("mousedown",this._onTouchStart,this),e.InputManager.mouse.addEventListener("mouseup",this._onTouchEnd,this),e.InputManager.mouse.addEventListener("mousemove",this._onTouchMove,this)},r.prototype.uninitialize=function(){t.prototype.uninitialize.call(this),e.InputManager.touch.removeEventListener("touchstart",this._onTouchStart,this),e.InputManager.touch.removeEventListener("touchend",this._onTouchEnd,this),e.InputManager.touch.removeEventListener("touchcancel",this._onTouchEnd,this),e.InputManager.touch.removeEventListener("touchmove",this._onTouchMove,this),e.InputManager.mouse.removeEventListener("mousedown",this._onTouchStart,this),e.InputManager.mouse.removeEventListener("mouseup",this._onTouchEnd,this),e.InputManager.mouse.removeEventListener("mousemove",this._onTouchMove,this)},r.prototype.checkEventThrough=function(e,t){return!!this._catchedEvent[e+"_"+t]},r.prototype._onTouchStart=function(e){this.stage.$onTouchBegin(e.x/this._scaler,e.y/this._scaler,e.identifier)&&(this._catchedEvent[e.x+"_"+e.y]=!0)},r.prototype._onTouchMove=function(e){this.stage.$onTouchMove(e.x/this._scaler,e.y/this._scaler,e.identifier)&&(this._catchedEvent[e.x+"_"+e.y]=!0)},r.prototype._onTouchEnd=function(e){this.stage.$onTouchEnd(e.x/this._scaler,e.y/this._scaler,e.identifier)&&(this._catchedEvent[e.x+"_"+e.y]=!0)},r.prototype.screenPosToUIPos=function(t,r){return void 0===r&&(r=new e.Vector2),r.x=t.x/this._scaler,r.y=t.y/this._scaler,r},Object.defineProperty(r.prototype,"scaler",{get:function(){return this._scaler},enumerable:!0,configurable:!0}),r.prototype.update=function(t){var r=this.stage,a=e.stage.screenViewport,i=a.w,n=a.h;if(this._stageWidth!=i||this._stageHeight!=n||this.screenAdapter.$dirty){var s={w:0,h:0,s:0};this.screenAdapter.calculateScaler(i,n,s),this.screenAdapter.$dirty=!1,r.$displayList.offsetMatrix.a=s.s,r.$displayList.offsetMatrix.d=s.s,this._scaler=s.s;var o=s.w,h=s.h;r.$stageWidth=o,r.$stageHeight=h,r.pushResize(i,n),r.dispatchEventWith(egret.Event.RESIZE),this._stageWidth=i,this._stageHeight=n}this._catchedEvent={}},r.prototype.render=function(t,r){e.WebGLKit.webgl;this.renderer.beforeRender(),this.stage.drawToSurface(),e.WebGLKit.resetState()},r}(paper.BaseComponent);e.Egret2DRenderer=t,__reflect(t.prototype,"egret3d.Egret2DRenderer")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r._interests=[{componentClass:e.Egret2DRenderer}],r}return __extends(r,t),r.prototype.update=function(){for(var e=paper.Time.deltaTime,t=0,r=this._components;t<r.length;t++){var a=r[t];a.update(e)}this._components.length>0&&egret.ticker.update()},r}(paper.BaseSystem);e.Egret2DRendererSystem=t,__reflect(t.prototype,"egret3d.Egret2DRendererSystem")}(egret3d||(egret3d={}));var egret;!function(e){var t;!function(t){var r=function(){function r(t){this.context=t;var r=this.egretWebGLRenderContext=e.web.WebGLRenderContext.getInstance(0,0);r.setContext(t),this.drawCmdManager=r.drawCmdManager,this.vao=r.vao,r.$drawWebGL=this.$drawWebGL.bind(this),e.sys.RenderBuffer=e.web.WebGLRenderBuffer,e.sys.systemRenderer=new e.web.WebGLRenderer,e.sys.canvasRenderer=new e.CanvasRenderer,e.sys.customHitTestBuffer=new e.web.WebGLRenderBuffer(3,3),e.sys.canvasHitTestBuffer=new e.web.CanvasRenderBuffer(3,3),e.Capabilities.$renderMode="webgl",this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer()}return r.getInstance=function(e){return this._instance||(this._instance=new r(e)),this._instance},r.prototype.beforeRender=function(){var e=this.context;e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE),e.enable(e.BLEND),e.disable(e.STENCIL_TEST),e.colorMask(!0,!0,!0,!0),this.setBlendMode("source-over"),e.activeTexture(e.TEXTURE0)},r.prototype.$drawWebGL=function(){if(0!=this.drawCmdManager.drawDataLen){this.uploadVerticesArray(this.vao.getVertices()),this.vao.isMesh()&&this.uploadIndicesArray(this.vao.getMeshIndices());for(var e=this.drawCmdManager.drawDataLen,t=0,r=0;e>r;r++){var a=this.drawCmdManager.drawData[r];a&&(t=this.drawData(a,t),6==a.type&&(this.activatedBuffer=a.buffer,this.egretWebGLRenderContext.activatedBuffer=a.buffer),(0==a.type||1==a.type||2==a.type)&&this.activatedBuffer&&this.activatedBuffer.$computeDrawCall&&this.activatedBuffer.$drawCalls++)}this.vao.isMesh()&&this.uploadIndicesArray(this.vao.getIndices()),this.drawCmdManager.clear(),this.vao.clear()}},r.prototype.drawData=function(e,r){if(e){var a,i=this.context,n=e.filter;switch(e.type){case 0:n?"custom"===n.type?a=t.EgretWebGLProgram.getProgram(i,n.$vertexSrc,n.$fragmentSrc,n.$shaderKey):"colorTransform"===n.type?a=t.EgretWebGLProgram.getProgram(i,t.EgretShaderLib.default_vert,t.EgretShaderLib.colorTransform_frag,"colorTransform"):"blurX"===n.type?a=t.EgretWebGLProgram.getProgram(i,t.EgretShaderLib.default_vert,t.EgretShaderLib.blur_frag,"blur"):"blurY"===n.type?a=t.EgretWebGLProgram.getProgram(i,t.EgretShaderLib.default_vert,t.EgretShaderLib.blur_frag,"blur"):"glow"===n.type&&(a=t.EgretWebGLProgram.getProgram(i,t.EgretShaderLib.default_vert,t.EgretShaderLib.glow_frag,"glow")):a=t.EgretWebGLProgram.getProgram(i,t.EgretShaderLib.default_vert,t.EgretShaderLib.texture_frag,"texture"),this.activeProgram(i,a),this.syncUniforms(a,n,e.textureWidth,e.textureHeight),r+=this.drawTextureElements(e,r);break;case 1:a=t.EgretWebGLProgram.getProgram(i,t.EgretShaderLib.default_vert,t.EgretShaderLib.primitive_frag,"primitive"),this.activeProgram(i,a),this.syncUniforms(a,n,e.textureWidth,e.textureHeight),r+=this.drawPushMaskElements(e,r);break;case 2:a=t.EgretWebGLProgram.getProgram(i,t.EgretShaderLib.default_vert,t.EgretShaderLib.primitive_frag,"primitive"),this.activeProgram(i,a),this.syncUniforms(a,n,e.textureWidth,e.textureHeight),r+=this.drawPopMaskElements(e,r);break;case 3:this.setBlendMode(e.value);break;case 4:e.buffer.rootRenderTarget.resize(e.width,e.height),this.onResize(e.width,e.height);break;case 5:if(this.activatedBuffer){var s=this.activatedBuffer.rootRenderTarget;(0!=s.width||0!=s.height)&&s.clear(!0)}break;case 6:this.activateBuffer(e.buffer);break;case 7:var o=this.activatedBuffer;o&&(o.rootRenderTarget&&o.rootRenderTarget.enabledStencil(),o.enableScissor(e.x,e.y,e.width,e.height));break;case 8:o=this.activatedBuffer,o&&o.disableScissor()}return r}},r.prototype.activeProgram=function(e,t){e.useProgram(t.id);var r=t.attributes;for(var a in r)"aVertexPosition"===a?(e.vertexAttribPointer(r.aVertexPosition.location,2,e.FLOAT,!1,20,0),e.enableVertexAttribArray(r.aVertexPosition.location)):"aTextureCoord"===a?(e.vertexAttribPointer(r.aTextureCoord.location,2,e.FLOAT,!1,20,8),e.enableVertexAttribArray(r.aTextureCoord.location)):"aColor"===a&&(e.vertexAttribPointer(r.aColor.location,1,e.FLOAT,!1,20,16),e.enableVertexAttribArray(r.aColor.location));this.currentProgram=t},r.prototype.syncUniforms=function(e,t,r,a){var i=e.uniforms;for(var n in i)if("projectionVector"===n)i[n].setValue({x:this.projectionX,y:this.projectionY});else if("uTextureSize"===n)i[n].setValue({x:r,y:a});else if("uSampler"===n);else{var s=t.$uniforms[n];void 0!==s&&i[n].setValue(s)}},r.prototype.drawTextureElements=function(e,t){var r=this.context;r.bindTexture(r.TEXTURE_2D,e.texture);var a=3*e.count;return r.drawElements(r.TRIANGLES,a,r.UNSIGNED_SHORT,2*t),a},r.prototype.activateBuffer=function(e){e.rootRenderTarget.activate(),this.bindIndices||this.uploadIndicesArray(this.vao.getIndices()),e.restoreStencil(),e.restoreScissor(),this.onResize(e.width,e.height)
},r.prototype.onResize=function(e,t){this.projectionX=e/2,this.projectionY=-t/2,this.context&&this.context.viewport(0,0,e,t)},r.prototype.uploadVerticesArray=function(e){var t=this.context;t.bufferData(t.ARRAY_BUFFER,e,t.STREAM_DRAW)},r.prototype.uploadIndicesArray=function(e){var t=this.context;t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW),this.bindIndices=!0},r.prototype.drawPushMaskElements=function(e,t){var r=this.context,a=3*e.count,i=this.activatedBuffer;if(i){i.rootRenderTarget&&i.rootRenderTarget.enabledStencil(),0==i.stencilHandleCount&&(i.enableStencil(),r.clear(r.STENCIL_BUFFER_BIT));var n=i.stencilHandleCount;i.stencilHandleCount++,r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.EQUAL,n,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR),r.drawElements(r.TRIANGLES,a,r.UNSIGNED_SHORT,2*t),r.stencilFunc(r.EQUAL,n+1,255),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)}return a},r.prototype.drawPopMaskElements=function(e,t){var r=this.context,a=3*e.count,i=this.activatedBuffer;if(i)if(i.stencilHandleCount--,0==i.stencilHandleCount)i.disableStencil();else{var n=i.stencilHandleCount;r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.EQUAL,n+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR),r.drawElements(r.TRIANGLES,a,r.UNSIGNED_SHORT,2*t),r.stencilFunc(r.EQUAL,n,255),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)}return a},r.prototype.setBlendMode=function(e){var t=this.context,a=r.blendModesForGL[e];a&&t.blendFunc(a[0],a[1])},r.initBlendMode=function(){r.blendModesForGL={},r.blendModesForGL["source-over"]=[1,771],r.blendModesForGL.lighter=[1,1],r.blendModesForGL["lighter-in"]=[770,771],r.blendModesForGL["destination-out"]=[0,771],r.blendModesForGL["destination-in"]=[0,770]},r.blendModesForGL=null,r}();t.Renderer=r,__reflect(r.prototype,"egret.web.Renderer"),r.initBlendMode()}(t=e.web||(e.web={}))}(egret||(egret={}));var egret3d;!function(e){var t=function(){function e(){this.$dirty=!0,this._scaleFactor=1}return Object.defineProperty(e.prototype,"scaleFactor",{set:function(e){this._scaleFactor=e,this.$dirty=!0},enumerable:!0,configurable:!0}),e.prototype.calculateScaler=function(e,t,r){var a=this._scaleFactor;r.s=a,r.w=e/a,r.h=t/a},e}();e.ConstantAdapter=t,__reflect(t.prototype,"egret3d.ConstantAdapter",["egret3d.IScreenAdapter"]);var r=function(){function t(){this.$dirty=!0,this._resolution=new e.Vector2(640,1136)}return t.prototype.setResolution=function(e,t){this._resolution.x=e,this._resolution.y=t,this.$dirty=!0},t.prototype.calculateScaler=function(e,t,r){var a=e/t,i=this._resolution.x/this._resolution.y,n=1;n=a>i?t/this._resolution.y:e/this._resolution.x,r.s=n,r.w=e/n,r.h=t/n},t}();e.ExpandAdapter=r,__reflect(r.prototype,"egret3d.ExpandAdapter",["egret3d.IScreenAdapter"]);var a=function(){function t(){this.$dirty=!0,this._resolution=new e.Vector2(640,1136)}return t.prototype.setResolution=function(e,t){this._resolution.x=e,this._resolution.y=t,this.$dirty=!0},t.prototype.calculateScaler=function(e,t,r){var a=e/t,i=this._resolution.x/this._resolution.y,n=1;n=a>i?e/this._resolution.x:t/this._resolution.y,r.s=n,r.w=e/n,r.h=t/n},t}();e.ShrinkAdapter=a,__reflect(a.prototype,"egret3d.ShrinkAdapter",["egret3d.IScreenAdapter"]);var i=function(){function t(){this.$dirty=!0,this._resolution=new e.Vector2(640,1136),this._matchFactor=0}return t.prototype.setResolution=function(e,t){this._resolution.x=e,this._resolution.y=t,this.$dirty=!0},Object.defineProperty(t.prototype,"matchFactor",{set:function(e){this._matchFactor=e,this.$dirty=!0},enumerable:!0,configurable:!0}),t.prototype.calculateScaler=function(e,t,r){var a=e/this._resolution.x,i=t/this._resolution.y,n=a+(i-a)*this._matchFactor;r.s=n,r.w=e/n,r.h=t/n},t}();e.MatchWidthOrHeightAdapter=i,__reflect(i.prototype,"egret3d.MatchWidthOrHeightAdapter",["egret3d.IScreenAdapter"])}(egret3d||(egret3d={}));var egret3d;!function(e){var t=new e.Quaternion,r=function(r){function a(){var e=null!==r&&r.apply(this,arguments)||this;return e.speed=1,e.isactived=!1,e.loopCount=1,e.isloop=!1,e.datasafe=!1,e.folowindex=0,e.lookforward=!1,e.adjustDir=!1,e}return __extends(a,r),Object.defineProperty(a.prototype,"pathasset",{get:function(){return this._pathasset},set:function(e){this._pathasset=e},enumerable:!0,configurable:!0}),a.prototype.play=function(e){void 0===e&&(e=1),this.isactived=!0,this.loopCount=e},a.prototype.pause=function(){this.isactived=!1},a.prototype.stop=function(){this.isactived=!1,this.folowindex=0},a.prototype.replay=function(e){void 0===e&&(e=1),this.isactived=!0,this.folowindex=0,this.loopCount=e},a.prototype.setpathasset=function(e,t,r){return void 0===t&&(t=1),void 0===r&&(r=null),this.pathasset=e,null==e?void console.log(this.gameObject.name+":are you sure set the right pathasseterrornull"):(this.paths=e.paths,null!=this.paths[0]&&(this.gameObject.transform.setLocalPosition(this.paths[0]),this.datasafe=!0),this.mystrans=this.gameObject.transform,this.speed=t,void(this.oncomplete=r))},a.prototype.update=function(e){this.isactived&&this.datasafe&&this.followmove(e)},a.prototype.followmove=function(r){var a=e.Vector3.getDistance(this.mystrans.getLocalPosition(),this.paths[this.folowindex]);if(.01>a)if(this.folowindex<this.paths.length-1){var i=new e.Vector3;this.mystrans.setLocalPosition(this.paths[this.folowindex]),this.folowindex++,this.adjustDir=!0}else this.folowindex=0,this.isloop||(this.loopCount--,0==this.loopCount&&(this.isactived=!1,this.loopCount=1,this.oncomplete&&this.oncomplete()));else{var i=new e.Vector3;if(e.Vector3.subtract(this.paths[this.folowindex],this.mystrans.getLocalPosition(),i),this.adjustDir){var n=this.paths[this.folowindex],s=this.mystrans.getLocalPosition(),o=t;e.Quaternion.lookAt(s,n,o),e.Quaternion.copy(o,this.mystrans.getLocalRotation()),this.adjustDir=!1}var h=this.speed*r;h>a&&(h=a);var l=h/a,c=new e.Vector3;e.Vector3.lerp(this.mystrans.getLocalPosition(),this.paths[this.folowindex],l,c),this.mystrans.setLocalPosition(c)}},a}(paper.BaseComponent);e.Guidpath=r,__reflect(r.prototype,"egret3d.Guidpath")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r._interests=[{componentClass:e.Guidpath}],r}return __extends(r,t),r.prototype.update=function(){for(var e=paper.Time.deltaTime,t=0,r=this._components;t<r.length;t++){var a=r[t];a.update(e)}},r}(paper.BaseSystem);e.GuidpathSystem=t,__reflect(t.prototype,"egret3d.GuidpathSystem")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=new e.Matrix,r=new e.Matrix,a=function(){function a(){this.bias=3e-4,this.radius=2,this.windowSize=16,this.renderTarget=new e.GlRenderTarget(e.WebGLKit.webgl,1024,1024,!0),this.map=this.renderTarget.texture,this.matrix=new e.Matrix,this.camera=new e.Camera,this.camera.opvalue=0,this.camera.backgroundColor.r=1,this.camera.backgroundColor.g=1,this.camera.backgroundColor.b=1,this.camera.backgroundColor.a=1,this.camera.clearOption_Color=!0,this.camera.clearOption_Depth=!0,this.camera.near=.1,this.camera.far=1e3,this.camera.renderTarget=this.renderTarget,this.camera.initialize()}return a.prototype.update=function(e){this.bias=e.shadowBias,this.radius=e.shadowRadius,this.windowSize=e.shadowSize,this._updateCamera(e),this._updateMatrix()},a.prototype._updateCamera=function(e){this.camera.gameObject=e.gameObject,this.camera.near=e.shadowCameraNear,this.camera.far=e.shadowCameraFar,this.camera.size=this.windowSize},a.prototype._updateMatrix=function(){var a=this.matrix,i=this.camera;e.Matrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1,a);var n=i.calcViewMatrix(t),s=i.calcProjectMatrix(1,r);e.Matrix.multiply(a,s,a),e.Matrix.multiply(a,n,a)},a}();e.DirectLightShadow=a,__reflect(a.prototype,"egret3d.DirectLightShadow",["egret3d.ILightShadow"])}(egret3d||(egret3d={}));var egret3d;!function(e){var t;!function(e){e[e.Direction=1]="Direction",e[e.Point=2]="Point",e[e.Spot=3]="Spot"}(t=e.LightTypeEnum||(e.LightTypeEnum={}));var r=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.type=0,r.color=new e.Color(1,1,1,1),r.intensity=2,r.distance=50,r.decay=2,r.angle=Math.PI/6,r.penumbra=0,r.spotAngelCos=.9,r.castShadows=!1,r.shadowBias=3e-4,r.shadowRadius=2,r.shadowSize=16,r.shadowCameraNear=.1,r.shadowCameraFar=200,r}return __extends(r,t),__decorate([paper.serializedField,editor.property(editor.EditType.LIST,{listItems:[{label:"Direction",value:1},{label:"Point",value:2},{label:"Spot",value:3}]})],r.prototype,"type",void 0),__decorate([paper.serializedField,editor.property(editor.EditType.COLOR)],r.prototype,"color",void 0),__decorate([paper.serializedField,editor.property(editor.EditType.NUMBER)],r.prototype,"intensity",void 0),__decorate([paper.serializedField,editor.property(editor.EditType.NUMBER)],r.prototype,"distance",void 0),__decorate([paper.serializedField,editor.property(editor.EditType.NUMBER)],r.prototype,"decay",void 0),__decorate([paper.serializedField,editor.property(editor.EditType.NUMBER)],r.prototype,"angle",void 0),__decorate([paper.serializedField,editor.property(editor.EditType.NUMBER)],r.prototype,"penumbra",void 0),__decorate([paper.serializedField,editor.property(editor.EditType.NUMBER)],r.prototype,"spotAngelCos",void 0),__decorate([paper.serializedField,editor.property(editor.EditType.CHECKBOX)],r.prototype,"castShadows",void 0),__decorate([paper.serializedField,editor.property(editor.EditType.NUMBER)],r.prototype,"shadowBias",void 0),__decorate([paper.serializedField,editor.property(editor.EditType.NUMBER)],r.prototype,"shadowRadius",void 0),__decorate([paper.serializedField,editor.property(editor.EditType.NUMBER)],r.prototype,"shadowSize",void 0),__decorate([paper.serializedField,editor.property(editor.EditType.NUMBER)],r.prototype,"shadowCameraNear",void 0),__decorate([paper.serializedField,editor.property(editor.EditType.NUMBER)],r.prototype,"shadowCameraFar",void 0),r}(paper.BaseComponent);e.Light=r,__reflect(r.prototype,"egret3d.Light")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r._interests=[{componentClass:e.Light}],r}return __extends(r,t),r.prototype.update=function(){for(var t=0,r=this._components;t<r.length;t++){var a=r[t],i=void 0,n=1;if(a.isActiveAndEnabled&&a.castShadows){switch(a.type){case e.LightTypeEnum.Point:a.$pointLightShadow||(a.$pointLightShadow=new e.PointLightShadow),i=a.$pointLightShadow,n=6;break;case e.LightTypeEnum.Spot:a.$spotLightShadow||(a.$spotLightShadow=new e.SpotLightShadow),i=a.$spotLightShadow,n=1;break;case e.LightTypeEnum.Direction:default:a.$directLightShadow||(a.$directLightShadow=new e.DirectLightShadow),i=a.$directLightShadow,n=1}for(var s=0;n>s;s++){i.update(a,s),i.renderTarget.activeCubeFace=s,i.camera._targetAndViewport(i.renderTarget,!1);var o=i.camera.context;a.type===e.LightTypeEnum.Point?o.drawtype="_distance_package":o.drawtype="_depth_package",o.updateCamera(i.camera),o.updateLightDepth(a);for(var h=0,l=e.Pool.shadowCaster.instances;h<l.length;h++){var c=l[h];if(c.gameObject.activeInHierarchy){o.updateModel(c.transform);var u="base";c.boneData&&(o.updateBones(c.boneData),u="skin"),e.WebGLKit.draw(o,c.material,c.mesh,c.subMeshInfo,u)}}}e.GlRenderTarget.useNull(e.WebGLKit.webgl)}}},r}(paper.BaseSystem);e.LightSystem=t,__reflect(t.prototype,"egret3d.LightSystem")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=new e.Matrix,r=new e.Matrix,a=new e.Vector3,i=function(){function i(){this.bias=3e-4,this.radius=2,this.windowSize=16,this._targets=[new e.Vector3(-1,0,0),new e.Vector3(1,0,0),new e.Vector3(0,1,0),new e.Vector3(0,-1,0),new e.Vector3(0,0,1),new e.Vector3(0,0,-1)],this._ups=[new e.Vector3(0,-1,0),new e.Vector3(0,-1,0),new e.Vector3(0,0,1),new e.Vector3(0,0,-1),new e.Vector3(0,-1,0),new e.Vector3(0,-1,0)],this.renderTarget=new e.GlRenderTargetCube(e.WebGLKit.webgl,1024,1024,!0),this.map=this.renderTarget.texture,this.matrix=new e.Matrix,this.camera=new e.Camera,this.camera.opvalue=1,this.camera.backgroundColor.r=1,this.camera.backgroundColor.g=1,this.camera.backgroundColor.b=1,this.camera.backgroundColor.a=1,this.camera.clearOption_Color=!0,this.camera.clearOption_Depth=!0,this.camera.near=.1,this.camera.far=1e3,this.camera.renderTarget=this.renderTarget,this.camera.initialize()}return i.prototype.update=function(e,t){this.bias=e.shadowBias,this.radius=e.shadowRadius,this.windowSize=e.shadowSize,this._updateCamera(e,t),this._updateMatrix()},i.prototype._updateCamera=function(t,r){this.camera.gameObject=t.gameObject,this.camera.near=t.shadowCameraNear,this.camera.far=t.shadowCameraFar;var i=t.gameObject.transform.getPosition(),n=e.Vector3.set(i.x+this._targets[r].x,i.y+this._targets[r].y,i.z+this._targets[r].z,a);this.camera.gameObject.transform.lookAt(n,this._ups[r]),this.camera.size=this.windowSize,this.camera.fov=Math.PI/2},i.prototype._updateMatrix=function(){var a=this.matrix,i=this.camera;e.Matrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1,a);var n=i.calcViewMatrix(t),s=i.calcProjectMatrix(1,r);e.Matrix.multiply(a,s,a),e.Matrix.multiply(a,n,a)},i}();e.PointLightShadow=i,__reflect(i.prototype,"egret3d.PointLightShadow",["egret3d.ILightShadow"])}(egret3d||(egret3d={}));var egret3d;!function(e){var t=new e.Matrix,r=new e.Matrix,a=function(){function a(){this.bias=3e-4,this.radius=2,this.windowSize=16,this.renderTarget=new e.GlRenderTarget(e.WebGLKit.webgl,1024,1024,!0),this.map=this.renderTarget.texture,this.matrix=new e.Matrix,this.camera=new e.Camera,this.camera.opvalue=1,this.camera.backgroundColor.r=1,this.camera.backgroundColor.g=1,this.camera.backgroundColor.b=1,this.camera.backgroundColor.a=1,this.camera.clearOption_Color=!0,this.camera.clearOption_Depth=!0,this.camera.near=.1,this.camera.far=1e3,this.camera.renderTarget=this.renderTarget,this.camera.initialize()}return a.prototype.update=function(e){this.bias=e.shadowBias,this.radius=e.shadowRadius,this.windowSize=e.shadowSize,this._updateCamera(e),this._updateMatrix()},a.prototype._updateCamera=function(e){this.camera.gameObject=e.gameObject,this.camera.near=e.shadowCameraNear,this.camera.far=e.shadowCameraFar,this.camera.fov=e.angle},a.prototype._updateMatrix=function(){var a=this.matrix,i=this.camera;e.Matrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1,a);var n=i.calcViewMatrix(t),s=i.calcProjectMatrix(1,r);e.Matrix.multiply(a,s,a),e.Matrix.multiply(a,n,a)},a}();e.SpotLightShadow=a,__reflect(a.prototype,"egret3d.SpotLightShadow",["egret3d.ILightShadow"])}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._mesh=null,t}return __extends(t,e),t.prototype.uninitialize=function(){e.prototype.uninitialize.call(this),this._mesh&&this._mesh.dispose(),this._mesh=null},Object.defineProperty(t.prototype,"mesh",{get:function(){return this._mesh},set:function(e){this._mesh!==e&&(this._mesh&&this._mesh.dispose(),this._mesh=e,paper.EventPool.dispatchEvent("mesh",this))},enumerable:!0,configurable:!0}),__decorate([paper.serializedField],t.prototype,"_mesh",void 0),__decorate([editor.property(editor.EditType.MESH)],t.prototype,"mesh",null),t}(paper.BaseComponent);e.MeshFilter=t,__reflect(t.prototype,"egret3d.MeshFilter")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(t){function r(){var r=t.call(this)||this;r._receiveShadows=!1,r._castShadows=!1,r._lightmapIndex=-1,r._lightmapScaleOffset=new e.Vector4(1,1,0,0),r._materials=[];var a=new e.Material;return a.setShader(e.DefaultShaders.DIFFUSE),r._materials.push(a),r}return __extends(r,t),r.prototype.serialize=function(){var e=t.prototype.serialize.call(this);e._receiveShadows=this._receiveShadows,e._castShadows=this._castShadows,e._lightmapIndex=this._lightmapIndex,e._lightmapScaleOffset=[this._lightmapScaleOffset.x,this._lightmapScaleOffset.y,this._lightmapScaleOffset.z,this._lightmapScaleOffset.w],e._materials=[];for(var r=0,a=this._materials;r<a.length;r++){var i=a[r];e._materials.push(paper.serializeAsset(i))}return e},r.prototype.deserialize=function(e){if(this._receiveShadows=e._receiveShadows||!1,this._castShadows=e._castShadows||!1,this._lightmapIndex=e._lightmapIndex,e._materials){this._materials.length=0;for(var t=0,r=e._materials.length;r>t;t++)this._materials.push(paper.getDeserializedObject(e._materials[t]))}e._lightmapScaleOffset&&this._lightmapScaleOffset.deserialize(e._lightmapScaleOffset)},r.prototype.uninitialize=function(){t.prototype.uninitialize.call(this),this._materials.length=0},Object.defineProperty(r.prototype,"receiveShadows",{get:function(){return this._receiveShadows},set:function(e){e!==this._receiveShadows&&(this._receiveShadows=e,paper.EventPool.dispatchEvent("receiveShadows",this))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"castShadows",{get:function(){return this._castShadows},set:function(e){e!==this._castShadows&&(this._castShadows=e,paper.EventPool.dispatchEvent("castShadows",this))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"lightmapIndex",{get:function(){return this._lightmapIndex},set:function(e){e!==this._lightmapIndex&&(this._lightmapIndex=e,paper.EventPool.dispatchEvent("lightmapIndex",this))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"lightmapScaleOffset",{get:function(){return this._lightmapScaleOffset},set:function(e){this._lightmapScaleOffset.x=e.x,this._lightmapScaleOffset.y=e.y,this._lightmapScaleOffset.z=e.z,this._lightmapScaleOffset.w=e.w,paper.EventPool.dispatchEvent("lightmapScaleOffset",this)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"materials",{get:function(){return this._materials},set:function(e){if(e!==this._materials){this._materials.length=0;for(var t=0,r=e;t<r.length;t++){var a=r[t];this._materials.push(a)}paper.EventPool.dispatchEvent("materials",this)}},enumerable:!0,configurable:!0}),__decorate([paper.serializedField],r.prototype,"_receiveShadows",void 0),__decorate([paper.serializedField],r.prototype,"_castShadows",void 0),__decorate([paper.serializedField],r.prototype,"_lightmapIndex",void 0),__decorate([paper.serializedField],r.prototype,"_lightmapScaleOffset",void 0),__decorate([paper.serializedField],r.prototype,"_materials",void 0),__decorate([editor.property(editor.EditType.CHECKBOX)],r.prototype,"receiveShadows",null),__decorate([editor.property(editor.EditType.CHECKBOX)],r.prototype,"castShadows",null),__decorate([editor.property(editor.EditType.NUMBER)],r.prototype,"lightmapIndex",null),__decorate([editor.property(editor.EditType.VECTOR4)],r.prototype,"lightmapScaleOffset",null),__decorate([editor.property(editor.EditType.MATERIAL_ARRAY)],r.prototype,"materials",null),r}(paper.BaseComponent);e.MeshRenderer=t,__reflect(t.prototype,"egret3d.MeshRenderer",["paper.IRenderer"])}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r._interests=[{componentClass:e.MeshRenderer,listeners:[{type:"__enabled__",listener:function(e){var t=r._getComponent(e.gameObject,1);t&&r._drawCallList.updateShadowCasters(e.gameObject,e.castShadows)}},{type:"castShadows",listener:function(e){var t=r._getComponent(e.gameObject,1);t&&r._drawCallList.updateShadowCasters(e.gameObject,e.castShadows)}},{type:"lightmapIndex",listener:function(e){var t=r._getComponent(e.gameObject,1);t&&r._updateLightMap(e)}},{type:"lightmapScaleOffset",listener:function(e){var t=r._getComponent(e.gameObject,1);t&&r._updateLightMap(e)}},{type:"materials",listener:function(e){var t=r._getComponent(e.gameObject,1);t&&r._drawCallList.updateDrawCalls(e.gameObject,e.castShadows)}}]},{componentClass:e.MeshFilter,listeners:[{type:"mesh",listener:function(e){var t=r._getComponent(e.gameObject,0);t&&r._drawCallList.updateDrawCalls(e.gameObject,t.castShadows)}}]}],r._createDrawCalls=function(e){var t=r._getComponent(e,0),a=r._getComponent(e,1);if(a.isActiveAndEnabled&&a.mesh&&t.isActiveAndEnabled&&t.materials.length>0){for(var i=0,n=[],s=0,o=a.mesh.glTFMesh.primitives;s<o.length;s++){var h=o[s];n.push({subMeshInfo:i,mesh:a.mesh,material:t.materials[h.material||0],lightMapIndex:t.lightmapIndex,lightMapScaleOffset:t.lightmapScaleOffset,boneData:null,gameObject:e,transform:e.transform,frustumTest:!1,zdist:-1}),i++}return n}return null},r._drawCallList=new e.DrawCallList(r._createDrawCalls),r}return __extends(r,t),r.prototype._onCreateComponent=function(e){if(!t.prototype._onCreateComponent.call(this,e))return!1;var r=this._getComponent(e.gameObject,0);return this._drawCallList.updateDrawCalls(r.gameObject,r.castShadows),!0},r.prototype._onDestroyComponent=function(e){return t.prototype._onDestroyComponent.call(this,e)?(this._drawCallList.removeDrawCalls(e.gameObject),!0):!1},r.prototype._updateLightMap=function(e){var t=this._drawCallList.getDrawCalls(e.gameObject);if(t)for(var r=0,a=t;r<a.length;r++){var i=a[r];i.lightMapIndex=e.lightmapIndex,i.lightMapScaleOffset=e.lightmapScaleOffset}},r.prototype.update=function(){},r}(paper.BaseSystem);e.MeshRendererSystem=t,__reflect(t.prototype,"egret3d.MeshRendererSystem")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=new e.Vector3,r=new e.Vector3,a=new e.Vector3,i=new e.Vector3,n=new e.Vector3,s=new e.Vector3,o=new e.Vector3,h=new e.Matrix,l=new e.Matrix,c=new e.Matrix,u=new e.Matrix,p=new e.Matrix,d=new e.Matrix,f=function(f){function _(){var t=null!==f&&f.apply(this,arguments)||this;return t._materials=[],t._mesh=null,t._bones=[],t.center=new e.Vector3,t.size=new e.Vector3,t._boneDirty=!0,t._maxBoneCount=0,t._retargetBoneNames=null,t._efficient=!0,t}return __extends(_,f),Object.defineProperty(_.prototype,"mesh",{get:function(){return this._mesh},set:function(e){this._mesh!==e&&(this._mesh&&this._mesh.dispose(),this._mesh=e,paper.EventPool.dispatchEvent("mesh",this))},enumerable:!0,configurable:!0}),_.prototype._getMatByIndex=function(t,r){var a=e.helpVector4E;if(this.mesh.getVertexAttribute(t,"JOINTS_0",0,a),a.x>=this._maxBoneCount||a.y>=this._maxBoneCount||a.z>=this._maxBoneCount||a.w>=this._maxBoneCount)return null;var i=e.helpVector4F;if(this.mesh.getVertexAttribute(t,"WEIGHTS_0",0,i),this._efficient){var n=e.helpVector4A,s=e.helpVector3A;n.x=this._skeletonMatrixData[8*a.x+0],n.y=this._skeletonMatrixData[8*a.x+1],n.z=this._skeletonMatrixData[8*a.x+2],n.w=this._skeletonMatrixData[8*a.x+3],s.x=this._skeletonMatrixData[8*a.x+4],s.y=this._skeletonMatrixData[8*a.x+5],s.z=this._skeletonMatrixData[8*a.x+6];var o=e.helpVector4B,h=e.helpVector3B;o.x=this._skeletonMatrixData[8*a.y+0],o.y=this._skeletonMatrixData[8*a.y+1],o.z=this._skeletonMatrixData[8*a.y+2],o.w=this._skeletonMatrixData[8*a.y+3],h.x=this._skeletonMatrixData[8*a.y+4],h.y=this._skeletonMatrixData[8*a.y+5],h.z=this._skeletonMatrixData[8*a.y+6];var l=e.helpVector4C,c=e.helpVector3C;l.x=this._skeletonMatrixData[8*a.z+0],l.y=this._skeletonMatrixData[8*a.z+1],l.z=this._skeletonMatrixData[8*a.z+2],l.w=this._skeletonMatrixData[8*a.z+3],c.x=this._skeletonMatrixData[8*a.z+4],c.y=this._skeletonMatrixData[8*a.z+5],c.z=this._skeletonMatrixData[8*a.z+6];var u=e.helpVector4D,p=e.helpVector3D;u.x=this._skeletonMatrixData[8*a.w+0],u.y=this._skeletonMatrixData[8*a.w+1],u.z=this._skeletonMatrixData[8*a.w+2],u.w=this._skeletonMatrixData[8*a.w+3],p.x=this._skeletonMatrixData[8*a.w+4],p.y=this._skeletonMatrixData[8*a.w+5],p.z=this._skeletonMatrixData[8*a.w+6];var d=e.helpMatrixA,f=e.helpMatrixB,_=e.helpMatrixC,g=e.helpMatrixD;e.Matrix.fromRTS(s,e.Vector3.ONE,n,d),e.Matrix.fromRTS(h,e.Vector3.ONE,o,f),e.Matrix.fromRTS(c,e.Vector3.ONE,l,_),e.Matrix.fromRTS(p,e.Vector3.ONE,u,g),e.Matrix.scale(i.x,d),e.Matrix.scale(i.y,f),e.Matrix.scale(i.z,_),e.Matrix.scale(i.w,g),e.Matrix.add(d,f,r),e.Matrix.add(r,_,r),e.Matrix.add(r,g,r)}else{var d=e.helpMatrixA,f=e.helpMatrixB,_=e.helpMatrixC,g=e.helpMatrixD;d.rawData=this._skeletonMatrixData.slice(16*a.x,16*a.x+16),f.rawData=this._skeletonMatrixData.slice(16*a.y,16*a.y+16),_.rawData=this._skeletonMatrixData.slice(16*a.z,16*a.z+16),g.rawData=this._skeletonMatrixData.slice(16*a.w,16*a.w+16),e.Matrix.scale(i.x,d),e.Matrix.scale(i.y,f),e.Matrix.scale(i.z,_),e.Matrix.scale(i.w,g),e.Matrix.add(d,f,r),e.Matrix.add(r,_,r),e.Matrix.add(r,g,r)}return r},_.prototype.initialize=function(){f.prototype.initialize.call(this),this.materials=this._materials,this.mesh=this._mesh,this.bones=this._bones;var e=0;if(this._materials.length>0){var t=this._materials[0].getShader().passes.skin;t&&0!==t.length||(e=1)}switch(e){case 1:this._maxBoneCount=24,this._skeletonMatrixData=new Float32Array(16*this._maxBoneCount);break;case 0:this._maxBoneCount=55,this._skeletonMatrixData=new Float32Array(8*this._maxBoneCount);for(var r=0;r<this._maxBoneCount;++r){var a=8*r;this._skeletonMatrixData[a++]=0,this._skeletonMatrixData[a++]=0,this._skeletonMatrixData[a++]=0,this._skeletonMatrixData[a++]=1,this._skeletonMatrixData[a++]=0,this._skeletonMatrixData[a++]=0,this._skeletonMatrixData[a++]=0,this._skeletonMatrixData[a++]=1}}},_.prototype.uninitialize=function(){f.prototype.uninitialize.call(this),this._mesh&&this._mesh.dispose(),this._bones.length=0,this._mesh=null},_.prototype.serialize=function(){var e=f.prototype.serialize.call(this);e.center=[this.center.x,this.center.y,this.center.z],e.size=[this.size.x,this.size.y,this.size.z],e.rootBone=null,e._bones=[],e._mesh=this._mesh?this._mesh.serialize():null,e._materials=[],this.rootBone&&(e.rootBone={hashCode:this.rootBone.hashCode});var t=this._materials;e._materials.length=t.length;for(var r=0,a=t.length;a>r;r++){var i=t[r];e._materials[r]=paper.serializeAsset(i)}var n=this._bones;e._bones.length=n.length;for(var r=0,a=n.length;a>r;r++){var s=n[r];e._bones[r]={hashCode:s.hashCode}}return e},_.prototype.deserialize=function(t){if(this.center.deserialize(t.center),this.size.deserialize(t.size),t._mesh&&(this._mesh=new e.Mesh,this._mesh.deserialize(t._mesh)),t.rootBone&&(this.rootBone=paper.getDeserializedObject(t.rootBone)),this._materials.length=0,t._materials)for(var r=0,a=t._materials.length;a>r;r++)this._materials.push(paper.getDeserializedObject(t._materials[r]));if(this._bones.length=0,t._bones)for(var r=0,a=t._bones.length;a>r;r++)this._bones.push(paper.getDeserializedObject(t._bones[r]))},_.prototype.intersects=function(f){for(var _=this.gameObject.transform.getWorldMatrix(),g=null,m=0,v=0,y=this._mesh.glTFMesh.primitives;v<y.length;v++){for(var w=y[v],b=h,x=l,T=c,E=u,A=p,D=d,S=this._mesh.getIndices(m),C=this.mesh.glTFAsset.getAccessor(w.indices),M=this.mesh.glTFAsset.getBufferOffset(C),R=t,L=r,O=a,P=0;P<C.count;P+=3){var z=S[P],V=S[P+1],F=S[P+2],B=i,I=n,U=s;if(this.mesh.getVertexPosition(z,m,B),this.mesh.getVertexPosition(V,m,I),this.mesh.getVertexPosition(F,m,U),this._getMatByIndex(z,b),this._getMatByIndex(V,x),this._getMatByIndex(F,T),null!==b&&null!==x&&null!==T){e.Matrix.multiply(_,b,E),e.Matrix.multiply(_,x,A),e.Matrix.multiply(_,T,D),e.Matrix.transformVector3(B,E,R),e.Matrix.transformVector3(I,A,L),e.Matrix.transformVector3(U,D,O);var N=f.intersectsTriangle(R,L,O);if(N){if(N.distance<0)continue;if(!g||g.distance>N.distance){g=N,g.faceId=(M+P)/3,g.subMeshId=m;var G=o;e.Vector3.copy(f.direction,G),e.Vector3.scale(G,N.distance),e.Vector3.add(f.origin,G,g.hitposition)}}}}m++}return g},Object.defineProperty(_.prototype,"materials",{get:function(){return this._materials},set:function(e){if(e!==this._materials)for(var t=0,r=e;t<r.length;t++){var a=r[t];this._materials.push(a)}paper.EventPool.dispatchEvent("materials",this)},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"bones",{get:function(){return this._bones},set:function(e){if(e!==this._bones){this._bones.length=0;for(var t=0,r=e;t<r.length;t++){var a=r[t];this._bones.push(a)}}},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"boneBuffer",{get:function(){return this.cacheData||this._skeletonMatrixData},enumerable:!0,configurable:!0}),_.dataCaches=[],__decorate([paper.serializedField],_.prototype,"_materials",void 0),__decorate([paper.serializedField],_.prototype,"_mesh",void 0),__decorate([paper.serializedField],_.prototype,"_bones",void 0),__decorate([paper.serializedField],_.prototype,"rootBone",void 0),__decorate([paper.serializedField],_.prototype,"center",void 0),__decorate([paper.serializedField],_.prototype,"size",void 0),_}(paper.BaseComponent);e.SkinnedMeshRenderer=f,__reflect(f.prototype,"egret3d.SkinnedMeshRenderer",["paper.IRenderer"])}(egret3d||(egret3d={}));var egret3d;!function(e){var t=new e.Vector3,r=new e.Vector3,a=new e.Vector3,i=(new e.Vector3,["POSITION","COLOR_0","TEXCOORD_0"]),n=function(n){function o(){var t=n.call(this)||this;return t.extenedOneSide=!0,t._vertexCount=24,t.color=new e.Color(1,1,1,1),t.width=1,t.speed=.5,t.lookAtCamera=!1,t.$active=!1,t._reInit=!1,t._material=new e.Material,t._material.setShader(e.DefaultShaders.DIFFUSE),t}return __extends(o,n),Object.defineProperty(o.prototype,"material",{get:function(){return this._material},set:function(e){this._material=e,paper.EventPool.dispatchEvent("material",this)},enumerable:!0,configurable:!0}),o.prototype.initialize=function(){n.prototype.initialize.call(this),this._buildMesh(this._vertexCount)},o.prototype.uninitialize=function(){n.prototype.uninitialize.call(this),this._mesh&&this._mesh.dispose(),this._mesh=null},o.prototype.update=function(i){if(this.$active){this._reInit&&(this._buildData(this._vertexCount),this._reInit=!1);var n=e.Camera.main,s=this.gameObject.transform.getPosition();if(this.lookAtCamera){if(n){var o=e.Vector3.copy(n.gameObject.transform.getPosition(),t),h=e.Vector3.subtract(o,this._sticks[0].location,r);e.Vector3.normalize(h);var l=e.Vector3.subtract(s,this._sticks[0].location,a);e.Vector3.normalize(l),e.Vector3.cross(h,l,this._sticks[0].up),e.Vector3.scale(this._sticks[0].up,this.width)}}else this.gameObject.transform.getUp(this._sticks[0].up),e.Vector3.scale(this._sticks[0].up,this.width);e.Vector3.copy(s,this._sticks[0].location);for(var c=this._sticks.length,u=1;c>u;u++)e.Vector3.lerp(this._sticks[u].location,this._sticks[u-1].location,this.speed,this._sticks[u].location);if(this.lookAtCamera){if(n)for(var o=e.Vector3.copy(n.gameObject.transform.getPosition(),t),u=1;c>u;u++){var h=e.Vector3.subtract(o,this._sticks[u].location,t);e.Vector3.normalize(h);var p=e.Vector3.subtract(this._sticks[u-1].location,this._sticks[u].location,r);e.Vector3.normalize(p),e.Vector3.cross(h,p,this._sticks[u].up),e.Vector3.scale(this._sticks[u].up,this.width)}}else for(var u=1;c>u;u++)e.Vector3.lerp(this._sticks[u].up,this._sticks[u-1].up,this.speed,this._sticks[u].up);this._updateTrailData()}},o.prototype._buildMesh=function(t){this._mesh=new e.Mesh(t,6*(t/2-1),i,2)},o.prototype._buildData=function(t){var r=t/2;this._sticks=[];var a=this.gameObject.transform.getPosition(),n=new e.Vector3;this.gameObject.transform.getUp(n),e.Vector3.scale(n,this.width);for(var o=0;r>o;o++){var h=new s;e.Vector3.copy(a,h.location),e.Vector3.copy(n,h.up),this._sticks.push(h)}for(var o=0;r>o;o++){var l=2*o,c=o/(r-1);this._mesh.setVertexAttribute(l,"POSITION",0,0,0,0),this._mesh.setVertexAttribute(l,"COLOR_0",0,this.color.r,this.color.g,this.color.b,this.color.a),this._mesh.setVertexAttribute(l,"TEXCOORD_0",0,c,0),this._mesh.setVertexAttribute(l+1,"POSITION",0,0,0,0),this._mesh.setVertexAttribute(l+1,"COLOR_0",0,this.color.r,this.color.g,this.color.b,this.color.a),this._mesh.setVertexAttribute(l+1,"TEXCOORD_0",0,c,1)}for(var u=this._mesh.getIndices(),p=0;r-1>p;p++){var l=6*p,d=2*p,f=2*(p+1),_=2*p+1,g=2*(p+1)+1;u[l+0]=d,u[l+1]=f,u[l+2]=_,u[l+3]=_,u[l+4]=f,u[l+5]=g}this._mesh.uploadSubVertexBuffer(i),this._mesh.uploadSubIndexBuffer()},o.prototype._updateTrailData=function(){var e,t,r=this._vertexCount/2;if(this.extenedOneSide)for(var a=0;r>a;a++){var i=2*a;e=this._sticks[a].location,t=this._sticks[a].up,this._mesh.setVertexAttribute(i,"POSITION",0,e.x,e.y,e.z),this._mesh.setVertexAttribute(i+1,"POSITION",0,e.x+t.x,e.y+t.y,e.z+t.z)}else for(var a=0;r>a;a++){var i=2*a;e=this._sticks[a].location,t=this._sticks[a].up,this._mesh.setVertexAttribute(i,"POSITION",0,e.x,e.y,e.z),this._mesh.setVertexAttribute(i+1,"POSITION",0,e.x+t.x,e.y+t.y,e.z+t.z)
}this._mesh.uploadSubVertexBuffer("POSITION")},__decorate([paper.serializedField],o.prototype,"extenedOneSide",void 0),__decorate([paper.serializedField],o.prototype,"_material",void 0),__decorate([paper.serializedField],o.prototype,"color",void 0),__decorate([paper.serializedField],o.prototype,"width",void 0),__decorate([paper.serializedField],o.prototype,"speed",void 0),__decorate([paper.serializedField],o.prototype,"lookAtCamera",void 0),o}(paper.BaseComponent);e.TrailRender=n,__reflect(n.prototype,"egret3d.TrailRender",["paper.IRenderer"]);var s=function(){function t(){this.location=new e.Vector3(0,0,0),this.up=new e.Vector3(0,1,0)}return t}();__reflect(s.prototype,"TrailStick")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r._interests=[{componentClass:e.TrailRender,listeners:[{type:"__enabled__",listener:function(e){var t=r._getComponent(e.gameObject,0);t&&r._drawCallList.updateDrawCalls(e.gameObject,!1)}},{type:"material",listener:function(e){var t=r._getComponent(e.gameObject,0);t&&r._drawCallList.updateDrawCalls(e.gameObject,!1)}}]}],r._transform=new e.Transform,r._createDrawCalls=function(e){var t=r._getComponent(e,0);if(t.isActiveAndEnabled&&t._mesh&&t._material&&t.$active){for(var a=0,i=[],n=0,s=t._mesh.glTFMesh.primitives;n<s.length;n++){s[n];i.push({subMeshInfo:a,mesh:t._mesh,material:t._material,lightMapIndex:-1,boneData:null,gameObject:e,transform:r._transform,frustumTest:!1,zdist:-1}),a++}return i}return null},r._drawCallList=new e.DrawCallList(r._createDrawCalls),r}return __extends(r,t),r.prototype._onCreateComponent=function(e){return t.prototype._onCreateComponent.call(this,e)?(this._drawCallList.updateShadowCasters(e.gameObject,!1),!0):!1},r.prototype._onDestroyComponent=function(e){return t.prototype._onDestroyComponent.call(this,e)?(this._drawCallList.removeDrawCalls(e.gameObject),!0):!1},r.prototype.update=function(){for(var e=paper.Time.deltaTime,t=0,r=this._components;t<r.length;t++){var a=r[t];a.update(e)}},r}(paper.BaseSystem);e.TrailRenderSystem=t,__reflect(t.prototype,"egret3d.TrailRenderSystem")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r._interests=[{componentClass:e.SkinnedMeshRenderer,listeners:[{type:"__enabled__",listener:function(e){var t=r._getComponent(e.gameObject,0);t&&r._updateDrawCalls(e)}},{type:"mesh",listener:function(e){var t=r._getComponent(e.gameObject,0);t&&r._updateDrawCalls(e)}},{type:"materials",listener:function(e){var t=r._getComponent(e.gameObject,0);t&&r._updateDrawCalls(e)}}]}],r._createDrawCalls=function(e){var t=r._getComponent(e,0);if(t.isActiveAndEnabled&&t.mesh&&t.materials.length>0){for(var a=0,i=[],n=0,s=t.mesh.glTFMesh.primitives;n<s.length;n++){var o=s[n];i.push({subMeshInfo:a,mesh:t.mesh,material:t.materials[o.material||0],lightMapIndex:-1,boneData:t.boneBuffer,gameObject:e,transform:e.transform,frustumTest:!1,zdist:-1}),a++}return i}return null},r._drawCallList=new e.DrawCallList(r._createDrawCalls),r}return __extends(r,t),r.prototype._updateDrawCalls=function(e){var t=e.gameObject;this._drawCallList.updateDrawCalls(t,!1);var r=this._drawCallList.getDrawCalls(t);if(r)for(var a=0,i=r;a<i.length;a++){var n=i[a];n.boneData=e.boneBuffer}},r.prototype._onCreateComponent=function(e){return t.prototype._onCreateComponent.call(this,e)?(this._updateDrawCalls(e),!0):!1},r.prototype._onDestroyComponent=function(e){return t.prototype._onDestroyComponent.call(this,e)?(this._drawCallList.removeDrawCalls(e.gameObject),!0):!1},r.prototype.update=function(){},r}(paper.BaseSystem);e.SkinnedMeshRendererSystem=t,__reflect(t.prototype,"egret3d.SkinnedMeshRendererSystem")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e.buffers=[],e.config=null,e}return __extends(r,t),r.getComponentTypeCount=function(e){switch(e){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:return 4;case 5126:return 4;default:throw new Error}},r.getAccessorTypeCount=function(e){switch(e){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16;default:throw new Error}},r.getMeshAttributeType=function(e){switch(e){case"POSITION":case"NORMAL":return"VEC3";case"TEXCOORD_0":case"TEXCOORD_1":return"VEC2";case"TANGENT":case"COLOR_0":case"COLOR_1":case"JOINTS_0":case"WEIGHTS_0":return"VEC4";default:throw new Error}},r.createGLTFAsset=function(){var e=new r;return e.config={asset:{version:"2"}},e},r.prototype.parse=function(e,t){this.config=e;for(var r=0,a=t;r<a.length;r++){var i=a[r];this.buffers.push(new Uint32Array(i))}},r.prototype.parseFromBinary=function(t){var r=0,a=new Uint32Array(t);if(1179937895!==a[r++]||2!==a[r++])return void console.assert(!1,"Nonsupport glTF data.");if(a[r++]!==t.byteLength)return void console.assert(!1,"Error glTF data.");for(var i=0,n=0;r<a.length;){if(i=a[r++],n=a[r++],i%4&&console.assert(!1,"Error glTF data."),1313821514===n){var s=new Uint8Array(t,4*r,i),o=e.io.BinReader.utf8ArrayToString(s);this.config=JSON.parse(o)}else{if(5130562!==n)return void console.assert(!1,"Nonsupport glTF data.");var h=new Uint32Array(t,4*r);this.buffers.push(h)}r+=i/4}},r.prototype.createTypeArrayFromBufferView=function(e,t){var r=this.buffers[e.buffer],a=r.byteOffset+(e.byteOffset||0);switch(t){case 5120:return new Int8Array(r.buffer,a,e.byteLength/Int8Array.BYTES_PER_ELEMENT);case 5121:return new Uint8Array(r.buffer,a,e.byteLength/Uint8Array.BYTES_PER_ELEMENT);case 5122:return new Int16Array(r.buffer,a,e.byteLength/Int16Array.BYTES_PER_ELEMENT);case 5123:return new Uint16Array(r.buffer,a,e.byteLength/Uint16Array.BYTES_PER_ELEMENT);case 5125:return new Int32Array(r.buffer,a,e.byteLength/Int32Array.BYTES_PER_ELEMENT);case 5125:return new Uint32Array(r.buffer,a,e.byteLength/Uint32Array.BYTES_PER_ELEMENT);case 5126:return new Float32Array(r.buffer,a,e.byteLength/Float32Array.BYTES_PER_ELEMENT)}throw new Error},r.prototype.createTypeArrayFromAccessor=function(e){var t=r.getAccessorTypeCount(e.type)*e.count,a=this.getBufferView(e),i=this.buffers[a.buffer],n=i.byteOffset+(a.byteOffset||0)+(e.byteOffset||0);switch(e.componentType){case 5120:return new Int8Array(i.buffer,n,t);case 5121:return new Uint8Array(i.buffer,n,t);case 5122:return new Int16Array(i.buffer,n,t);case 5123:return new Uint16Array(i.buffer,n,t);case 5125:return new Int32Array(i.buffer,n,t);case 5125:return new Uint32Array(i.buffer,n,t);case 5126:return new Float32Array(i.buffer,n,t)}throw new Error},r.prototype.getBufferLength=function(e){return r.getAccessorTypeCount(e.type)*r.getComponentTypeCount(e.componentType)*e.count},r.prototype.getBufferOffset=function(e){var t=this.getBufferView(e);return(t.byteOffset||0)+(e.byteOffset||0)},r.prototype.getBuffer=function(e){var t=this.getBufferView(e);return this.buffers[t.buffer]},r.prototype.getBufferView=function(e){if(!this.config.bufferViews)throw new Error;return this.config.bufferViews[e.bufferView||0]},r.prototype.getAccessor=function(e){if(!this.config.accessors)throw new Error;return this.config.accessors[e]},r.prototype.getNode=function(e){if(!this.config.nodes)throw new Error;return this.config.nodes[e]},r.prototype.getAnimationClip=function(e){if(!this.config.animations||0===this.config.animations.length)return null;var t=this.config.animations[0];if(0===t.extensions.paper.clips.length)return null;if(!e)return t.extensions.paper.clips[0];for(var r=0,a=this.config.animations;r<a.length;r++)for(var i=a[r],n=0,s=i.extensions.paper.clips;n<s.length;n++){var o=s[n];if(o.name===e)return o}return null},r.prototype.caclByteLength=function(){return 0},r.prototype.dispose=function(){this.buffers.length=0},r}(paper.Asset);e.GLTFAsset=t,__reflect(t.prototype,"egret3d.GLTFAsset")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=new e.Vector3,r=new e.Vector3,a=new e.Vector3,i=new e.Vector3,n=new e.Vector3,s=new e.Vector3,o=new e.Vector3,h=function(h){function l(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var a=h.call(this)||this;if(a.vertexCount=0,a.isSharedBuffer=!0,a._drawMode=1,a._version=0,a._glTFMeshIndex=0,a._glTFAsset=null,a._glTFMesh=null,a._vertexBuffer=null,a.ibos=[],a.vbo=null,0===t.length)return a;if(t[0]instanceof e.GLTFAsset)a._drawMode=t[2]||1,a._glTFMeshIndex=t[1],a._glTFAsset=t[0];else{var i="number"==typeof t[2];a._drawMode=(i?t[4]:t[3])||1,a._glTFAsset=e.GLTFAsset.createGLTFAsset(),a._glTFAsset.config.buffers=[{byteLength:0}],a._glTFAsset.config.bufferViews=[{buffer:0,byteOffset:0,byteLength:0,target:34962}],a._glTFAsset.config.accessors=[],a._glTFMesh={primitives:[{attributes:{POSITION:0}}]},a._glTFAsset.config.meshes=[a._glTFMesh];for(var n=i?t[3]:t[2],s=a._glTFAsset.config.buffers[0],o=a._glTFAsset.config.bufferViews[0],l=a._glTFAsset.config.accessors,c=a._glTFMesh.primitives[0],u=c.attributes,p="number"==typeof t[0],d=p?null:t[0],f=p?t[0]:a._getVertexCountFromBuffer(d,n),_=0,g=n;_<g.length;_++){var m=g[_],v=e.GLTFAsset.getMeshAttributeType(m),y=o.byteLength;o.byteLength+=f*e.GLTFAsset.getAccessorTypeCount(v)*Float32Array.BYTES_PER_ELEMENT,u[m]=l.length,l.push({bufferView:0,byteOffset:y,count:f,componentType:5126,type:v})}if(s.byteLength=o.byteLength,p?a._glTFAsset.buffers[0]=new Float32Array(o.byteLength):a._glTFAsset.buffers[0]=d,t[1]){var w="number"==typeof t[1],b=w?null:t[1],x=w?t[1]:b.length,f=i?t[2]:x,T=a._glTFAsset.config.bufferViews[1]={buffer:1,byteOffset:0,byteLength:x*e.GLTFAsset.getAccessorTypeCount("SCALAR")*Uint16Array.BYTES_PER_ELEMENT,target:34963};c.indices=l.length,l.push({bufferView:1,byteOffset:0,count:f,componentType:5123,type:"SCALAR"}),a._glTFAsset.config.buffers[1]={byteLength:T.byteLength},w?a._glTFAsset.buffers[1]=new Uint16Array(T.byteLength/Uint16Array.BYTES_PER_ELEMENT):a._glTFAsset.buffers[1]=b}}return a.initialize(),a}return __extends(l,h),l.prototype._getDrawMode=function(t){var r=e.WebGLKit.webgl;switch(t){case 1:return r.STATIC_DRAW;case 2:return r.DYNAMIC_DRAW;case 3:return r.STREAM_DRAW}throw new Error},l.prototype._cacheVertexCount=function(){for(var e=this._glTFMesh.primitives,t=!0,r=e[0].attributes.POSITION,a=1;a<e.length;a++){var i=e[a].attributes.POSITION;if(i!==r){t=!1;break}}if(this.vertexCount=0,t)this.vertexCount=this.getVertexCount();else for(var a=0;a<e.length;a++)this.vertexCount+=this.getVertexCount(a)},l.prototype._getVertexCountFromBuffer=function(t,r){for(var a=0,i=0,n=r;i<n.length;i++){var s=n[i];a+=e.GLTFAsset.getAccessorTypeCount(e.GLTFAsset.getMeshAttributeType(s))}return t.length/a},l.prototype.serialize=function(){if(!this._glTFAsset.url)return null;var e=paper.serializeRC(this);return e._glTFMeshIndex=this._glTFMeshIndex,e._glTFAsset=paper.serializeAsset(this._glTFAsset),e},l.prototype.deserialize=function(e){this._glTFMeshIndex=e._glTFMeshIndex,this._glTFAsset=paper.getDeserializedObject(e._glTFAsset),this.initialize()},l.prototype.dispose=function(){var t=e.WebGLKit.webgl;this.vbo&&t.deleteBuffer(this.vbo);for(var r=0,a=this.ibos;r<a.length;r++){var i=a[r];t.deleteBuffer(i)}this.vbo=null,this._glTFAsset=null,this._glTFMesh=null,this._vertexBuffer=null},l.prototype.caclByteLength=function(){return 0},l.prototype.initialize=function(t){if(!this._vertexBuffer){var r=this._glTFAsset.config;if(!r.buffers||!r.bufferViews||!r.accessors||!r.meshes||r.meshes.length<=this._glTFMeshIndex)return void console.error("Error glTF asset.");this._drawMode=t||1,this._glTFMesh=r.meshes[this._glTFMeshIndex];var a=this._glTFAsset.getAccessor(this._glTFMesh.primitives[0].attributes.POSITION);this._vertexBuffer=this._glTFAsset.createTypeArrayFromBufferView(this._glTFAsset.getBufferView(a),5126),this._cacheVertexCount();var i=e.WebGLKit.webgl,n=i.createBuffer();if(n){this.vbo=n,i.bindBuffer(i.ARRAY_BUFFER,this.vbo),i.bufferData(i.ARRAY_BUFFER,this._vertexBuffer.byteLength,this._getDrawMode(this._drawMode));for(var s=0,o=0,h=this._glTFMesh.primitives;o<h.length;o++){var l=h[o],c=[];for(var u in l.attributes)c.push(u);if(this.uploadSubVertexBuffer(c,s),void 0!==l.indices){var p=this._glTFAsset.getAccessor(l.indices),d=i.createBuffer();d?(this.ibos.push(d),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,d),i.bufferData(i.ELEMENT_ARRAY_BUFFER,this._glTFAsset.getBufferLength(p),this._getDrawMode(this._drawMode)),this.uploadSubIndexBuffer(s)):(this.ibos.push(null),console.log("Create webgl element buffer error."))}else this.ibos.push(null);s++}}else console.log("Create webgl buffer error.")}},l.prototype.addSubMesh=function(t,r,a,i){if(void 0===a&&(a=0),void 0===i&&(i=0),i>=0&&i<this._glTFMesh.primitives.length){var n=this._glTFMesh.primitives[i],s=this._glTFAsset.getAccessor(n.indices||0),o=e.WebGLKit.webgl,h={attributes:n.attributes,indices:this._glTFAsset.config.accessors.length,material:a};this._glTFMesh.primitives.push(h),this._glTFAsset.config.accessors.push({bufferView:s.bufferView,byteOffset:t*e.GLTFAsset.getComponentTypeCount(5123)*e.GLTFAsset.getAccessorTypeCount("SCALAR"),count:r,componentType:5123,type:"SCALAR"});var l=this._glTFAsset.getAccessor(h.indices),c=o.createBuffer();return c?(this.ibos.push(c),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,c),o.bufferData(o.ELEMENT_ARRAY_BUFFER,this._glTFAsset.getBufferLength(l),this._getDrawMode(this._drawMode))):(this.ibos.push(null),console.log("Create webgl element buffer error.")),this._glTFMesh.primitives.length-1}return console.warn("Error arguments."),-1},l.prototype.getVertexCount=function(e){if(void 0===e&&(e=0),e>=0&&e<this._glTFMesh.primitives.length){var t=this._glTFAsset.getAccessor(this._glTFMesh.primitives[e].attributes.POSITION);return t.count}return console.warn("Error arguments."),0},l.prototype.getVertexPosition=function(e,t,r){return void 0===t&&(t=0),this.getVertexAttribute(e,"POSITION",t,r)},l.prototype.setVertexPosition=function(e,t,r){void 0===r&&(r=0),this.setVertexAttribute(e,"POSITION",r,t.x,t.y,t.z)},l.prototype.getVertices=function(e){return void 0===e&&(e=0),this.getAttributes("POSITION",e)},l.prototype.getUVs=function(e){return void 0===e&&(e=0),this.getAttributes("TEXCOORD_0",e)},l.prototype.getColors=function(e){return void 0===e&&(e=0),this.getAttributes("COLOR_0",e)},l.prototype.getNormals=function(e){return void 0===e&&(e=0),this.getAttributes("NORMAL",e)},l.prototype.getTangents=function(e){return void 0===e&&(e=0),this.getAttributes("TANGENT",e)},l.prototype.getAttributes=function(e,t){if(void 0===t&&(t=0),t>=0&&t<this._glTFMesh.primitives.length){var r=this._glTFMesh.primitives[t].attributes[e]||0,a=this._glTFAsset.getAccessor(r);return this._glTFAsset.createTypeArrayFromAccessor(a)}return console.warn("Error arguments."),null},l.prototype.getIndices=function(e){if(void 0===e&&(e=0),e>=0&&e<this._glTFMesh.primitives.length){var t=this._glTFMesh.primitives[e].indices||0,r=this._glTFAsset.getAccessor(t);return this._glTFAsset.createTypeArrayFromAccessor(r)}return console.warn("Error arguments."),null},l.prototype.getVertexAttribute=function(t,r,a,i){if(void 0===a&&(a=0),a>=0&&a<this._glTFMesh.primitives.length){var n=this._glTFMesh.primitives[a].attributes[r];if(void 0!==n){var s=this._glTFAsset.getAccessor(n);if(t>=0&&t<s.count){var o=this._glTFAsset.getBufferOffset(s)/e.GLTFAsset.getComponentTypeCount(s.componentType)+t*e.GLTFAsset.getAccessorTypeCount(s.type);switch(s.type){case"VEC2":i||(i=new e.Vector2),i.x=this._vertexBuffer[o],i.y=this._vertexBuffer[o+1];break;case"VEC3":i||(i=new e.Vector3),i.x=this._vertexBuffer[o],i.y=this._vertexBuffer[o+1],i.z=this._vertexBuffer[o+2];break;case"VEC4":i||(i=new e.Vector4),i.x=this._vertexBuffer[o],i.y=this._vertexBuffer[o+1],i.z=this._vertexBuffer[o+2],i.w=this._vertexBuffer[o+3]}return i}}}return console.warn("Error arguments."),i},l.prototype.setVertexAttribute=function(t,r,a){for(var i=[],n=3;n<arguments.length;n++)i[n-3]=arguments[n];if(a>=0&&a<this._glTFMesh.primitives.length){var s=this._glTFMesh.primitives[a].attributes[r];if(void 0!==s){var o=this._glTFAsset.getAccessor(s);if(t>=0&&t<o.count){var h=this._glTFAsset.getBufferOffset(o)/e.GLTFAsset.getComponentTypeCount(o.componentType)+t*e.GLTFAsset.getAccessorTypeCount(o.type);switch(o.type){case"VEC2":this._vertexBuffer[h]=i[0],this._vertexBuffer[h+1]=i[1];break;case"VEC3":this._vertexBuffer[h]=i[0],this._vertexBuffer[h+1]=i[1],this._vertexBuffer[h+2]=i[2];break;case"VEC4":this._vertexBuffer[h]=i[0],this._vertexBuffer[h+1]=i[1],this._vertexBuffer[h+2]=i[2],this._vertexBuffer[h+3]=i[3]}}}}else console.warn("Error arguments.")},l.prototype.uploadSubVertexBuffer=function(t,r){if(void 0===r&&(r=0),r>=0&&r<this._glTFMesh.primitives.length){var a=e.WebGLKit.webgl,i=this._glTFMesh.primitives[r],n=i.attributes;if(a.bindBuffer(a.ARRAY_BUFFER,this.vbo),"string"==typeof t){var s=n[t];if(void 0!==s){var o=this._glTFAsset.getAccessor(s),h=this._glTFAsset.getBufferOffset(o),l=this._glTFAsset.createTypeArrayFromAccessor(o);a.bufferSubData(a.ARRAY_BUFFER,h,l)}else console.warn("Error arguments.")}else for(var c=0,u=t;c<u.length;c++){var p=u[c],s=n[p];if(void 0!==s){var o=this._glTFAsset.getAccessor(s),h=this._glTFAsset.getBufferOffset(o),l=this._glTFAsset.createTypeArrayFromAccessor(o);a.bufferSubData(a.ARRAY_BUFFER,h,l)}else console.warn("Error arguments.")}this._version++}else console.warn("Error arguments.")},l.prototype.uploadSubIndexBuffer=function(t){if(void 0===t&&(t=0),t>=0&&t<this._glTFMesh.primitives.length){var r=e.WebGLKit.webgl,a=this._glTFMesh.primitives[t];if(void 0!==a.indices){var i=this._glTFAsset.getAccessor(a.indices),n=this._glTFAsset.createTypeArrayFromAccessor(i),s=this.ibos[t];s?(r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,s),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,n),this._version++):console.error("Error webgl element buffer.")}else console.warn("Error arguments.")}else console.warn("Error arguments.")},l.prototype.intersects=function(h,l){for(var c=null,u=0,p=0,d=this._glTFMesh.primitives;p<d.length;p++){var f=d[p];if(1===f.mode||2===f.mode||3===f.mode);else if(void 0===f.indices);else for(var _=this.getIndices(u),g=this._glTFAsset.getAccessor(f.indices),m=this._glTFAsset.getBufferOffset(g),v=t,y=r,w=a,b=0;b<g.count;b+=3){var x=this.getVertexPosition(_[b],u,i),T=this.getVertexPosition(_[b+1],u,n),E=this.getVertexPosition(_[b+2],u,s);e.Matrix.transformVector3(x,l,v),e.Matrix.transformVector3(T,l,y),e.Matrix.transformVector3(E,l,w);var A=h.intersectsTriangle(v,y,w);if(A){if(A.distance<0)continue;if(!c||c.distance>A.distance){c=A,c.triangleIndex=(m+b)/3,c.subMeshIndex=b;var D=o;e.Vector3.copy(h.direction,D),e.Vector3.scale(D,A.distance),e.Vector3.add(h.origin,D,c.position)}}}u++}return c},Object.defineProperty(l.prototype,"subMeshCount",{get:function(){return this._glTFMesh.primitives.length},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"glTFAsset",{get:function(){return this._glTFAsset},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"glTFMesh",{get:function(){return this._glTFMesh},enumerable:!0,configurable:!0}),__decorate([paper.serializedField],l.prototype,"_drawMode",void 0),__decorate([paper.serializedField],l.prototype,"_glTFMeshIndex",void 0),__decorate([paper.serializedField],l.prototype,"_glTFAsset",void 0),l}(paper.SerializableObject);e.Mesh=h,__reflect(h.prototype,"egret3d.Mesh")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(){function e(){this.dirty=0,this.layer=0,this.leftWeight=0,this.layerWeight=0,this.blendWeight=0,this.target=null}return e.prototype.update=function(e){var t=e.layer,r=e._globalWeight;if(this.dirty>0){if(this.leftWeight>0){if(e.additive&&this.layer!==t){if(this.layerWeight>=this.leftWeight)return this.leftWeight=0,!1;this.layer=t,this.leftWeight-=this.layerWeight,this.layerWeight=r*this.leftWeight}return r*=this.leftWeight,this.dirty++,this.blendWeight=r,!0}return!1}this.dirty++,this.layer=t,this.leftWeight=1,this.layerWeight=r,this.blendWeight=r},e}();e.BoneBlendLayer=t,__reflect(t.prototype,"egret3d.BoneBlendLayer");var r=function(){function e(){this.update=null}return e}();__reflect(r.prototype,"AnimationChannel");var a=function(){function e(){this.additive=!1,this.layer=0,this.weight=1,this.fadeTime=1,this.parent=null,this._fadeState=-1,this._subFadeState=-1,this._globalWeight=0,this._fadeProgress=0,this._fadeTimeStart=0}return e.prototype._onFadeStateChange=function(){},e.prototype.update=function(e){var t=this._fadeState>0,r=e-this._fadeTimeStart;this._subFadeState<0&&(this._subFadeState=0,this._onFadeStateChange()),r>=this.fadeTime?(this._subFadeState=1,this._fadeProgress=t?0:1):r>0?this._fadeProgress=t?1-r/this.fadeTime:r/this.fadeTime:this._fadeProgress=t?1:0,this._subFadeState>0&&(t||(this._fadeState=0,this._onFadeStateChange())),this._globalWeight=this.weight*this._fadeProgress,this.parent&&(this._globalWeight*=this.parent._globalWeight)},e.prototype.fadeOut=function(e){var t=paper.Time.time,r=t-this._fadeTimeStart;if(this._fadeState>0){if(e>this.fadeTime-r)return}else this._fadeState=1,this._subFadeState=-1,(0>=e||this._fadeProgress<=0)&&(this._fadeProgress=1e-6);this.fadeTime=this._fadeProgress>1e-6?e/this._fadeProgress:0,this._fadeTimeStart=t-this.fadeTime*(1-this._fadeProgress)},e}();e.BlendNode=a,__reflect(a.prototype,"egret3d.BlendNode");var i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._blendNodes=[],t}return __extends(t,e),t}(a);e.BlendTree=i,__reflect(i.prototype,"egret3d.BlendTree");var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.layer=0,t.playTimes=0,t.currentPlayTimes=0,t.timeScale=1,t.animationAsset=null,t.animation=null,t.animationClip=null,t._isPlaying=!0,t._playState=-1,t._frameRate=0,t._frameCount=0,t._playTimeStart=0,t._playTime=0,t._frameProgress=0,t._animationComponent=null,t._channels=[],t._retargetBoneIndices=[],t._delta=[],t._frameBuffer=null,t._frameOffset=-1,t._nextFrameOffset=-1,t._frameOffsets=null,t}return __extends(t,e),t.prototype._onArriveAtFrame=function(){},t.prototype._onUpdateFrame=function(){for(var e=(this._delta,this._animationComponent._skinnedMeshRenderer._skeletonMatrixData),t=this._animationComponent._boneBlendLayers,r=this._frameBuffer,a=0,i=this._retargetBoneIndices.length;i>a;++a){var n=this._retargetBoneIndices[a];if(!(0>n)){var s=7*a,o=8*n,h=this._frameOffset+s,l=t[n];if(l.update(this)){for(var c=0;7>c;++c)e[o+c]=r[h+c];e[o+7]=1}}}},t.prototype._onUpdateTranslation=function(e){var t=!1,r=0,a=e.inputBuffer,i=e.outputBuffer,n=e.component;if(this._playTime<=a[0]);else if(this._playTime>=a[a.length-1])r=a.length-1;else{t="STEP"!==e.glTFSampler.interpolation;for(var s=0,o=a.length;o>s&&!(this._playTime<a[s]);++s)r=s}var h=3*r,l=i[h],c=i[h+1],u=i[h+2];if(t){var p=h+3,d=(this._playTime-a[r])/(a[r+1]-a[r]);n.setLocalPosition(l+(i[p]-l)*d,c+(i[p+1]-c)*d,u+(i[p+2]-u)*d)}else n.setLocalPosition(l,c,u)},t.prototype._onUpdateRotation=function(e){var t=!1,r=0,a=e.inputBuffer,i=e.outputBuffer,n=e.component;if(this._playTime<=a[0]);else if(this._playTime>=a[a.length-1])r=a.length-1;else{t="STEP"!==e.glTFSampler.interpolation;for(var s=0,o=a.length;o>s&&!(this._playTime<a[s]);++s)r=s}var h=4*r,l=i[h],c=i[h+1],u=i[h+2],p=i[h+3];if(t){var d=h+4,f=(this._playTime-a[r])/(a[r+1]-a[r]);n.setLocalRotation(l+(i[d]-l)*f,c+(i[d+1]-c)*f,u+(i[d+2]-u)*f,p+(i[d+3]-p)*f)}else n.setLocalRotation(l,c,u,p)},t.prototype._onUpdateScale=function(e){var t=!1,r=0,a=e.inputBuffer,i=e.outputBuffer,n=e.component;if(this._playTime<=a[0]);else if(this._playTime>=a[a.length-1])r=a.length-1;else{t="STEP"!==e.glTFSampler.interpolation;for(var s=0,o=a.length;o>s&&!(this._playTime<a[s]);++s)r=s}var h=3*r,l=i[h],c=i[h+1],u=i[h+2];if(t){var p=h+3,d=(this._playTime-a[r])/(a[r+1]-a[r]);n.setLocalScale(l+(i[p]-l)*d,c+(i[p+1]-c)*d,u+(i[p+2]-u)*d)}else n.setLocalScale(l,c,u)},t.prototype._onUpdateActive=function(e){var t=0,r=e.inputBuffer,a=e.outputBuffer,i=e.component;if(this._playTime<=r[0]);else if(this._playTime>=r[r.length-1])t=r.length-1;else for(var n=0,s=r.length;s>n&&!(this._playTime<r[n]);++n)t=n;var o=3*t;i.gameObject.activeSelf=0!==a[o]},t.prototype.initialize=function(e,t,a){var i=paper.Time.time,n=t.config;this.animationAsset=t,this.animationClip=a,this.animation=n.animations[0];var s=this.animation.extensions.paper,o=this.animationAsset.getAccessor(s.data);this._frameRate=s.frameRate,this._frameCount=s.frameCount,this._fadeTimeStart=i,this._playTimeStart=i,this._animationComponent=e;var h=this._animationComponent._skinnedMeshRenderer;if(h){var l=h._retargetBoneNames||h.bones.map(function(e){return e.gameObject.name}),c=s.retarget?s.retarget.joints:s.joints;this._delta.length=7*l.length,this._frameBuffer=this.animationAsset.createTypeArrayFromAccessor(o),this._frameOffsets=this.animation.extensions.paper.frames;for(var u=0,p=c;u<p.length;u++){var d=p[u],f=l.indexOf(d);this._retargetBoneIndices.push(f)}}else if(this.animation.channels){var _=this._animationComponent.gameObject,g=_.transform.getAllChildren(),m={};m[_.name]=_;for(var v=0,y=g;v<y.length;v++){var w=y[v].gameObject;m[w.name]=w}for(var b=0,x=this.animation.channels;b<x.length;b++){var T=x[b],E=this.animationAsset.getNode(T.target.node||0),w=m[E.name];if(w){var A=new r;switch(A.glTFChannel=T,A.glTFSampler=this.animation.samplers[T.sampler],A.gameObject=w,A.component=w.transform,A.inputBuffer=this.animationAsset.createTypeArrayFromAccessor(this.animationAsset.getAccessor(A.glTFSampler.input)),A.outputBuffer=this.animationAsset.createTypeArrayFromAccessor(this.animationAsset.getAccessor(A.glTFSampler.output)),A.glTFChannel.target.path){case"translation":A.update=this._onUpdateTranslation.bind(this);break;case"rotation":A.update=this._onUpdateRotation.bind(this);break;case"scale":A.update=this._onUpdateScale.bind(this);break;case"weights":break;case"custom":switch(A.glTFChannel.extensions.paper.type){case"paper.GameObject":switch(A.glTFChannel.extensions.paper.property){case"activeSelf":A.update=this._onUpdateActive.bind(this)}}break;default:console.warn("Unknown animation channel.",A.glTFChannel.target.path)}this._channels.push(A)}}}},t.prototype.update=function(t){e.prototype.update.call(this,t);var r=this.currentPlayTimes,a=this._playState,i=this.timeScale*this._animationComponent.timeScale,n=0===i?0:1/i,s=this.animationClip.position,o=this.animationClip.duration,h=this.playTimes*o,l=(t-this._playTimeStart)*n,c=0;if(this.playTimes>0&&(l>=h||0>=l)?(this._playState<=0&&this._isPlaying&&(this._playState=1),this.currentPlayTimes=this.playTimes,c=l>=h?o+1e-6:0):(0!==this._playState&&this._isPlaying&&(this._playState=0),0>l?(l=-l,this.currentPlayTimes=Math.floor(l/o),c=o-l%o):(this.currentPlayTimes=Math.floor(l/o),c=l%o)),c+=s,this._playTime=c,this._channels.length>0)for(var u=0,p=this._channels;u<p.length;u++){var d=p[u];d.update&&d.update(d)}else if(this._animationComponent._skinnedMeshRenderer)if((0>a&&this._playState!==a||this._playState<=0&&this.currentPlayTimes!==r)&&(this._frameOffset=-1),this._frameCount>0){var f=this._playTime*this._frameRate,_=Math.min(Math.floor(f),this._frameCount-1),g=this._frameOffsets[_];this._frameOffset!==g&&(this._frameOffset=g,this._nextFrameOffset=this._frameOffsets[_+1],this._onArriveAtFrame()),this._frameProgress=f-_,this._onUpdateFrame()}else this._frameOffset<0&&(this._frameOffset=this._frameOffsets[0],this._nextFrameOffset=-1,this._onArriveAtFrame())},t.prototype.fateOut=function(){this._fadeState=1,this._subFadeState=1},t}(a);e.AnimationState=n,__reflect(n.prototype,"egret3d.AnimationState");var s=function(r){function a(){var e=null!==r&&r.apply(this,arguments)||this;return e.autoPlay=!1,e.timeScale=1,e._animations=[],e._boneBlendLayers=[],e._blendNodes=[],e._lastAnimationState=null,e._skinnedMeshRenderer=null,e}return __extends(a,r),a.prototype.initialize=function(){if(r.prototype.initialize.call(this),!this._skinnedMeshRenderer&&(this._skinnedMeshRenderer=this.gameObject.getComponentsInChildren(e.SkinnedMeshRenderer)[0],this._skinnedMeshRenderer))for(var a=0,i=this._skinnedMeshRenderer.bones;a<i.length;a++){var n=(i[a],new t);this._boneBlendLayers.push(n)}},a.prototype.update=function(e){var t=this._blendNodes,r=t.length;if(1===r){var a=t[0];a._fadeState>0&&a._subFadeState>0?(t.length=0,this._lastAnimationState===a&&(this._lastAnimationState=null)):a.update(e)}else if(r>1)for(var i=0,s=0;r>i;++i){var a=t[i];if(a._fadeState>0&&a._subFadeState>0?(s++,this._lastAnimationState===a&&(this._lastAnimationState=null)):(s>0&&(t[i-s]=a),a.update(e)),i===r-1&&s>0&&(t.length-=s,null===this._lastAnimationState&&t.length>0)){var o=t[t.length-1];o instanceof n&&(this._lastAnimationState=o)}}},a.prototype.fadeIn=function(e,t,r,a,i){void 0===e&&(e=null),void 0===r&&(r=-1),void 0===a&&(a=0),void 0===i&&(i=!1);for(var s=null,o=null,h=0,l=this._animations;h<l.length;h++){var c=l[h];if(s=c,!e){o=c.getAnimationClip("");break}if(o=c.getAnimationClip(e),null!==o)break}if(!s||!o)return null;for(var u=0,p=this._blendNodes;u<p.length;u++){var d=p[u];d.parent||d.layer!==a||d.fadeOut(t)}var f=new n;return f.initialize(this,s,o),f.additive=i,f.fadeTime=t,f.playTimes=0>r?o.playTimes||0:r,this._blendNodes.push(f),this._lastAnimationState=f,f},a.prototype.play=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=-1),this.fadeIn(e,0,t)},Object.defineProperty(a.prototype,"lastAnimationnName",{get:function(){return this._lastAnimationState?this._lastAnimationState.animationClip.name:""},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"animations",{get:function(){return this._animations},set:function(e){for(var t=0,r=e.length;r>t;t++)this._animations[t]=e[t]},enumerable:!0,configurable:!0}),__decorate([paper.serializedField],a.prototype,"autoPlay",void 0),__decorate([paper.serializedField],a.prototype,"_animations",void 0),a}(paper.BaseComponent);e.Animation=s,__reflect(s.prototype,"egret3d.Animation");var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._interests=[{componentClass:s,listeners:[{type:"__enabled__",listener:function(e){e.autoPlay&&e.play()}}]}],t}return __extends(t,e),t.prototype._onCreateComponent=function(t){return e.prototype._onCreateComponent.call(this,t)?(t.autoPlay&&t.play(),!0):!1},t.prototype.update=function(){for(var e=paper.Time.time,t=0,r=this._components;t<r.length;t++){var a=r[t];a.update(e)}},t}(paper.BaseSystem);e.AnimationSystem=o,__reflect(o.prototype,"egret3d.AnimationSystem")}(egret3d||(egret3d={}));var egret3d;!function(e){var t;!function(e){e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.BYTE=65535]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT"}(t=e.WEBGL_UNIFORM_TYPE||(e.WEBGL_UNIFORM_TYPE={}));var r=function(){function e(e,t,r){this.gl=e,this.name=r.name,this.type=r.type,this.size=r.size,this.location=e.getUniformLocation(t,this.name)}return e}();e.WebGLUniform=r,__reflect(r.prototype,"egret3d.WebGLUniform")}(egret3d||(egret3d={}));var egret3d;!function(e){var t;!function(e){e[e.Background=1e3]="Background",e[e.Geometry=2e3]="Geometry",e[e.AlphaTest=2450]="AlphaTest",e[e.Transparent=3e3]="Transparent",e[e.Overlay=4e3]="Overlay"}(t=e.RenderQueue||(e.RenderQueue={}));var r=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e.version=0,e._changeShaderMap={},e._renderQueue=-1,e.$uniforms={},e._textureRef=[],e}return __extends(r,t),r.prototype.dispose=function(){delete this.$uniforms,this.version++},r.prototype.caclByteLength=function(){var t=0;
this.shader&&(t+=this.shader.caclByteLength());for(var r in this.$uniforms){var a=this.$uniforms[r].type,i=this.$uniforms[r].value;switch(a){case e.UniformTypeEnum.Float:t+=4;break;case e.UniformTypeEnum.Floatv:t+=i.byteLength;break;case e.UniformTypeEnum.Float4:t+=16;break;case e.UniformTypeEnum.Float4v:t+=i.byteLength;break;case e.UniformTypeEnum.Float4x4:t+=64;break;case e.UniformTypeEnum.Float4x4v:t+=i.byteLength;break;case e.UniformTypeEnum.Texture:i&&(t+=i.caclByteLength())}}return t},r.prototype._setDefaultUniforms=function(e){if(!this.shader)return void console.log("Shader error.",this);for(var t in e.defaultValue){var r=e.defaultValue[t];switch(r.type){case"Texture":this.setTexture(t,r.value);break;case"Vector4":this.setVector4(t,r.value);break;case"Range":this.setFloat(t,r.value)}}},r.prototype.setShader=function(e){this.shader=e,this.$uniforms={},this._setDefaultUniforms(this.shader)},r.prototype.getShader=function(){return this.shader},r.prototype.changeShader=function(e){var t={};for(var r in this.$uniforms)this.$uniforms[r]&&(t[r]=this.$uniforms[r]);this.setShader(e);for(var r in t)this.$uniforms[r]&&(this.$uniforms[r]=t[r])},Object.defineProperty(r.prototype,"renderQueue",{get:function(){return this.shader?-1===this._renderQueue?this.shader.renderQueue:this._renderQueue:(console.log("Shader error.",this),this._renderQueue)},set:function(e){this._renderQueue=e},enumerable:!0,configurable:!0}),r.prototype.setFloat=function(t,r){void 0!==this.$uniforms[t]?this.$uniforms[t].value=r:this.$uniforms[t]={type:e.UniformTypeEnum.Float,value:r},this.version++},r.prototype.setFloatv=function(t,r){void 0!==this.$uniforms[t]?this.$uniforms[t].value=r:this.$uniforms[t]={type:e.UniformTypeEnum.Floatv,value:r},this.version++},r.prototype.setVector4=function(t,r){void 0!==this.$uniforms[t]?this.$uniforms[t].value=r:this.$uniforms[t]={type:e.UniformTypeEnum.Float4,value:r},this.version++},r.prototype.setVector4v=function(t,r){void 0!==this.$uniforms[t]?this.$uniforms[t].value=r:this.$uniforms[t]={type:e.UniformTypeEnum.Float4v,value:r},this.version++},r.prototype.setMatrix=function(t,r){void 0!==this.$uniforms[t]?this.$uniforms[t].value=r:this.$uniforms[t]={type:e.UniformTypeEnum.Float4x4,value:r},this.version++},r.prototype.setMatrixv=function(t,r){void 0!==this.$uniforms[t]?this.$uniforms[t].value=r:this.$uniforms[t]={type:e.UniformTypeEnum.Float4x4v,value:r},this.version++},r.prototype.setTexture=function(t,r){if(void 0!==this.$uniforms[t]){if(this.$uniforms[t].value){var a=this._textureRef.indexOf(this.$uniforms[t].value);a>-1&&this._textureRef.splice(a,1)}this.$uniforms[t].value=r}else this.$uniforms[t]={type:e.UniformTypeEnum.Texture,value:r};this.version++,r&&this._textureRef.push(r)},r.prototype.$parse=function(t){var r=t.shader;this.setShader(paper.Asset.find(r));var a=t.mapUniform;for(var i in a){var n=a[i],s=n.type;switch(s){case e.UniformTypeEnum.Texture:var o=n.value,h=paper.Asset.find(e.utils.combinePath(e.utils.getPathByUrl(this.url)+"/",o));h||(h=e.DefaultTextures.GRID),this.setTexture(i,h);break;case e.UniformTypeEnum.Float:var l=n.value;this.setFloat(i,parseFloat(l));break;case e.UniformTypeEnum.Float4:var c=n.value;try{var u=c.match(e.RegexpUtil.vector4Regexp);if(null!==u){var p=new e.Vector4(parseFloat(u[1]),parseFloat(u[2]),parseFloat(u[3]),parseFloat(u[4]));this.setVector4(i,p)}}catch(d){console.log(d)}break;default:console.log("map uniform type in material json <"+n.type+"> out of range0-2!")}}},r.prototype.clone=function(){var t=new r(this.name);t.setShader(this.shader);for(var a in this.$uniforms){var i=this.$uniforms[a],n=i.type;switch(n){case e.UniformTypeEnum.Texture:t.setTexture(a,i.value);break;case e.UniformTypeEnum.Float:t.setFloat(a,i.value);break;case e.UniformTypeEnum.Float4:t.setVector4(a,i.value)}}return t},__decorate([paper.serializedField],r.prototype,"shader",void 0),__decorate([paper.serializedField,paper.deserializedIgnore],r.prototype,"_textureRef",void 0),r}(paper.Asset);e.Material=r,__reflect(r.prototype,"egret3d.Material")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(){function e(){}return e.caclByteLength=function(){return 36},e}();e.Charinfo=t,__reflect(t.prototype,"egret3d.Charinfo");var r=function(r){function a(){return null!==r&&r.apply(this,arguments)||this}return __extends(a,r),a.prototype.dispose=function(){delete this.cmap},a.prototype.caclByteLength=function(){var r=0;for(var a in this.cmap)r+=e.utils.caclStringByteLength(a),r+=t.caclByteLength();return r},Object.defineProperty(a.prototype,"texture",{get:function(){return this._texture},set:function(e){this._texture=e},enumerable:!0,configurable:!0}),a.prototype.$parse=function(r){var a=((new Date).valueOf(),JSON.parse(r)),i=a.font;this.fontname=i[0];var n=i[1];this.texture=paper.Asset.find(e.utils.getPathByUrl(this.url)+"/"+n),this.pointSize=i[2],this.padding=i[3],this.lineHeight=i[4],this.baseline=i[5],this.atlasWidth=i[6],this.atlasHeight=i[7],this.cmap={};var s=a.map;for(var o in s){var h=new t;this.cmap[o]=h,h.x=(s[o][0]-.5)/this.atlasWidth,h.y=(s[o][1]-.5)/this.atlasHeight,h.w=(s[o][2]+1)/this.atlasWidth,h.h=(s[o][3]+1)/this.atlasHeight,h.xSize=s[o][2],h.ySize=s[o][3],h.xOffset=s[o][4],h.yOffset=s[o][5],h.xAddvance=s[o][6]}s=null,a=null;(new Date).valueOf()},a}(paper.Asset);e.Font=r,__reflect(r.prototype,"egret3d.Font")}(egret3d||(egret3d={}));var egret3d;!function(e){var t;!function(e){e[e.Texture=0]="Texture",e[e.Float=1]="Float",e[e.Floatv=2]="Floatv",e[e.Float4=3]="Float4",e[e.Float4v=4]="Float4v",e[e.Float4x4=5]="Float4x4",e[e.Float4x4v=6]="Float4x4v"}(t=e.UniformTypeEnum||(e.UniformTypeEnum={}));var r;!function(e){e[e.ALL=0]="ALL",e[e.CCW=1]="CCW",e[e.CW=2]="CW"}(r=e.ShowFaceStateEnum||(e.ShowFaceStateEnum={}));var a;!function(e){e[e.VboTri=0]="VboTri",e[e.VboLine=1]="VboLine",e[e.EboTri=2]="EboTri",e[e.EboLine=3]="EboLine"}(a=e.DrawModeEnum||(e.DrawModeEnum={}));var i;!function(e){e[e.Close=0]="Close",e[e.Blend=1]="Blend",e[e.Blend_PreMultiply=2]="Blend_PreMultiply",e[e.Add=3]="Add",e[e.Add_PreMultiply=4]="Add_PreMultiply"}(i=e.BlendModeEnum||(e.BlendModeEnum={}));var n=function(){function t(t,a){this.state_showface=r.CCW,this.state_zwrite=!1,this.state_ztest=!1,this.state_ztest_method=e.WebGLKit.LEQUAL,this.state_blend=!1,this.state_blendEquation=0,this.state_blendSrcRGB=0,this.state_blendDestRGB=0,this.state_blendSrcAlpha=0,this.state_blendDestALpha=0,this.vShaderInfo=t,this.fShaderInfo=a}return t.prototype.setAlphaBlend=function(t){t===i.Add?(this.state_blend=!0,this.state_blendEquation=e.WebGLKit.FUNC_ADD,this.state_blendSrcRGB=e.WebGLKit.SRC_ALPHA,this.state_blendDestRGB=e.WebGLKit.ONE,this.state_blendSrcAlpha=e.WebGLKit.SRC_ALPHA,this.state_blendDestALpha=e.WebGLKit.ONE):t===i.Add_PreMultiply?(this.state_blend=!0,this.state_blendEquation=e.WebGLKit.FUNC_ADD,this.state_blendSrcRGB=e.WebGLKit.ONE,this.state_blendDestRGB=e.WebGLKit.ONE,this.state_blendSrcAlpha=e.WebGLKit.ONE,this.state_blendDestALpha=e.WebGLKit.ONE):t===i.Blend?(this.state_blend=!0,this.state_blendEquation=e.WebGLKit.FUNC_ADD,this.state_blendSrcRGB=e.WebGLKit.SRC_ALPHA,this.state_blendDestRGB=e.WebGLKit.ONE_MINUS_SRC_ALPHA,this.state_blendSrcAlpha=e.WebGLKit.ONE,this.state_blendDestALpha=e.WebGLKit.ONE_MINUS_SRC_ALPHA):t===i.Blend_PreMultiply?(this.state_blend=!0,this.state_blendEquation=e.WebGLKit.FUNC_ADD,this.state_blendSrcRGB=e.WebGLKit.ONE,this.state_blendDestRGB=e.WebGLKit.ONE_MINUS_SRC_ALPHA,this.state_blendSrcAlpha=e.WebGLKit.ONE,this.state_blendDestALpha=e.WebGLKit.ONE_MINUS_SRC_ALPHA):t===i.Close&&(this.state_blend=!1)},t}();e.DrawPass=n,__reflect(n.prototype,"egret3d.DrawPass")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=new e.Vector3,r=(new e.Vector3,new e.Matrix),a=new e.Quaternion,i=new e.Quaternion,n=new e.Vector3,s=new e.Quaternion,o=new e.Vector3(0,1,0),h=new e.Vector3(1,0,0),l=new e.Vector3(0,0,1),c=function(c){function u(){var t=null!==c&&c.apply(this,arguments)||this;return t.children=[],t._dirtyAABB=!0,t._dirtyLocal=!0,t._dirtyWorld=!0,t._worldMatrixDeterminant=0,t.localMatrix=new e.Matrix,t.worldMatrix=new e.Matrix,t.localPosition=new e.Vector3,t.position=new e.Vector3,t.localRotation=new e.Quaternion,t.rotation=new e.Quaternion,t.localEulerAngles=new e.Vector3,t.eulerAngles=new e.Vector3,t.localScale=new e.Vector3(1,1,1),t.scale=new e.Vector3(1,1,1),t._aabb=null,t._parent=null,t}return __extends(u,c),u.prototype._removeFromChildren=function(e){for(var t=0,r=0,a=this.children;r<a.length;r++){var i=a[r];if(i===e){this.children.splice(t,1);break}t++}},u.prototype._buildAABB=function(){var t=new e.Vector3,r=new e.Vector3,a=new e.Vector3,i=this.gameObject.getComponent(e.MeshFilter);if(i&&i.mesh){e.Vector3.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,r),e.Vector3.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,a);for(var n=0,s=0,o=i.mesh.glTFMesh.primitives;s<o.length;s++)for(var h=(o[s],i.mesh.getVertexCount(n)),l=0;h>l;++l)i.mesh.getVertexPosition(l,n,t),e.Vector3.max(t,a,a),e.Vector3.min(t,r,r)}else{var c=this.gameObject.getComponent(e.SkinnedMeshRenderer);if(c){e.Vector3.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,r),e.Vector3.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,a);for(var n=0,u=0,p=c.mesh.glTFMesh.primitives;u<p.length;u++)for(var h=(p[u],c.mesh.getVertexCount(n)),l=0;h>l;++l)c.mesh.getVertexPosition(l,n,t),e.Vector3.max(t,a,a),e.Vector3.min(t,r,r)}else r.x=-1,r.y=-1,r.z=-1,a.x=1,a.y=1,a.z=1}var d=new e.AABB(r,a);return d},u.prototype._sync=function(){this._dirtyLocal&&(e.Matrix.fromRTS(this.localPosition,this.localScale,this.localRotation,this.localMatrix),this._dirtyLocal=!1),this._dirtyWorld&&(this._parent?e.Matrix.multiply(this._parent.worldMatrix,this.localMatrix,this.worldMatrix):e.Matrix.copy(this.localMatrix,this.worldMatrix),this._worldMatrixDeterminant=e.Matrix.determinant(this.worldMatrix),this._dirtyWorld=!1)},u.prototype._dirtify=function(e){if(void 0===e&&(e=!1),!(!e||e&&this._dirtyLocal)||!this._dirtyWorld){if(e&&(this._dirtyLocal=!0),!this._dirtyWorld){this._dirtyWorld=!0;for(var t=this.children.length;t--;)this.children[t]._dirtyWorld||this.children[t]._dirtify()}this._dirtyAABB=!0}},u.prototype.$getGlobalPosition=function(){var e=this.getPosition();return new Float32Array([e.x,e.y,e.z,1])},u.prototype._onParentChange=function(e,t){this.gameObject._activeInHierarchyDirty(),this._dirtify()},u.prototype.deserialize=function(e){if(c.prototype.deserialize.call(this,e),this.localPosition.deserialize(e.localPosition),this.localRotation.deserialize(e.localRotation),this.localScale.deserialize(e.localScale),this.children.length=0,e.children)for(var t=0,r=e.children.length;r>t;t++){var a=paper.getDeserializedObject(e.children[t]);a&&(a._parent=this,this.children.push(a))}},u.prototype.setParent=function(t,r){void 0===r&&(r=!1);var a=this._parent,i=t;a!==i&&(r&&e.Vector3.copy(this.getPosition(),e.helpVector3A),a&&a._removeFromChildren(this),i&&t.children.push(this),this._parent=i,this._onParentChange(i,a),r&&this.setPosition(e.helpVector3A))},u.prototype.getChild=function(e){return e>=0&&e<this.children.length?this.children[e]:null},u.prototype.getLocalMatrix=function(){return this._dirtyLocal&&(e.Matrix.fromRTS(this.localPosition,this.localScale,this.localRotation,this.localMatrix),this._dirtyLocal=!1),this.localMatrix},u.prototype.getWorldMatrix=function(){return this._dirtyLocal||this._dirtyWorld?(this._parent&&this._parent.getWorldMatrix(),this._sync(),this.worldMatrix):this.worldMatrix},u.prototype.getLocalPosition=function(){return this.localPosition},u.prototype.setLocalPosition=function(t,r,a){t.hasOwnProperty("x")?e.Vector3.copy(t,this.localPosition):(this.localPosition.x=t,this.localPosition.y=r||0,this.localPosition.z=a||0),this._dirtyLocal||this._dirtify(!0)},u.prototype.getPosition=function(){return e.Matrix.getTranslation(this.getWorldMatrix(),this.position),this.position},u.prototype.setPosition=function(a,i,n){a.hasOwnProperty("x")?e.Vector3.copy(a,t):(t.x=a,t.y=i||0,t.z=n||0),this._parent?(e.Matrix.inverse(this._parent.getWorldMatrix(),r),e.Matrix.transformVector3(t,r,this.localPosition)):e.Vector3.copy(t,this.localPosition),this._dirtyLocal||this._dirtify(!0)},u.prototype.getLocalRotation=function(){return this.localRotation},u.prototype.setLocalRotation=function(t,r,a,i){t.hasOwnProperty("x")?e.Vector3.copy(t,this.localRotation):(this.localRotation.x=t,this.localRotation.y=r||0,this.localRotation.z=a||0,this.localRotation.w=void 0!==i?i:1),this._dirtyLocal||this._dirtify(!0)},u.prototype.getRotation=function(){return e.Quaternion.fromMatrix(this.getWorldMatrix(),this.rotation),this.rotation},u.prototype.setRotation=function(t,r,n,s){if(t.hasOwnProperty("x")?e.Quaternion.copy(t,a):(a.x=t,a.y=r||0,a.z=n||0,a.w=void 0!==s?s:1),this._parent){var o=this._parent.getRotation();e.Quaternion.copy(o,i),e.Quaternion.inverse(i),e.Quaternion.multiply(i,a,this.localRotation)}else e.Quaternion.copy(a,this.localRotation);this._dirtyLocal||this._dirtify(!0)},u.prototype.getLocalEulerAngles=function(){return e.Quaternion.toEulerAngles(this.localRotation,this.localEulerAngles),this.localEulerAngles},u.prototype.setLocalEulerAngles=function(t,r,a){t.hasOwnProperty("x")?(t=t,e.Quaternion.fromEulerAngles(t.x,t.y,t.z,this.localRotation)):e.Quaternion.fromEulerAngles(t,r,a,this.localRotation),this._dirtyLocal||this._dirtify(!0)},u.prototype.getEulerAngles=function(){return e.Matrix.toEulerAngles(this.getWorldMatrix(),this.eulerAngles),this.eulerAngles},u.prototype.setEulerAngles=function(t,r,n){if(t.hasOwnProperty("x")?(t=t,e.Quaternion.fromEulerAngles(t.x,t.y,t.z,a)):e.Quaternion.fromEulerAngles(t,r||0,n||0,a),this._parent){var s=this._parent.getRotation();e.Quaternion.copy(s,i),e.Quaternion.inverse(i),e.Quaternion.multiply(i,a,this.localRotation)}else e.Quaternion.copy(a,this.localRotation);this._dirtyLocal||this._dirtify(!0)},u.prototype.getLocalScale=function(){return this.localScale},u.prototype.setLocalScale=function(t,r,a){t.hasOwnProperty("x")?e.Vector3.copy(t,this.localScale):(this.localScale.x=t,this.localScale.y=void 0!==r?r:1,this.localScale.z=void 0!==a?a:1),this._dirtyLocal||this._dirtify(!0)},u.prototype.getScale=function(){return e.Matrix.getScale(this.getWorldMatrix(),this.scale),this.scale},u.prototype.setScale=function(a,i,n){a.hasOwnProperty("x")?e.Vector3.copy(a,t):(t.x=a,t.y=void 0!==i?i:1,t.z=void 0!==n?n:1),this._parent?(e.Matrix.inverse(this._parent.getWorldMatrix(),r),e.Matrix.transformVector3(t,r,this.localScale)):e.Vector3.copy(t,this.localScale),this._dirtyLocal||this._dirtify(!0)},u.prototype.lookAt=function(t,r){t instanceof u?e.Vector3.copy(t.getPosition(),n):e.Vector3.copy(t,n),void 0===r?e.Quaternion.lookAt(this.getPosition(),n,s):e.Quaternion.lookAtWithUp(this.getPosition(),n,r,s),this.setRotation(s)},u.prototype.getForward=function(t){return e.Matrix.transformNormal(l,this.getWorldMatrix(),t),e.Vector3.normalize(t),t},u.prototype.getRight=function(t){e.Matrix.transformNormal(h,this.getWorldMatrix(),t),e.Vector3.normalize(t)},u.prototype.getUp=function(t){e.Matrix.transformNormal(o,this.getWorldMatrix(),t),e.Vector3.normalize(t)},u.prototype.find=function(e){for(var t=e.split("/"),r=this,a=null,i=0,n=t;i<n.length;i++){for(var s=n[i],o=0,h=r.children;o<h.length;o++){var l=h[o];if(l.gameObject.name===s){a=l;break}}if(!a)break;r=a}return a},u.prototype.getAllChildren=function(){var e=[];return this._getAllChildren(e),e},u.prototype._getAllChildren=function(e){for(var t=0,r=this.children;t<r.length;t++){var a=r[t];e.push(a),a._getAllChildren(e)}},Object.defineProperty(u.prototype,"childCount",{get:function(){return this.children.length},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"aabb",{get:function(){return this._aabb||(this._aabb=this._buildAABB()),this._dirtyAABB&&(this._aabb.update(this.getWorldMatrix()),this._dirtyAABB=!1),this._aabb},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"parent",{get:function(){return this._parent},set:function(e){this.setParent(e,!1)},enumerable:!0,configurable:!0}),__decorate([paper.serializedField],u.prototype,"children",void 0),__decorate([paper.serializedField,editor.property(editor.EditType.VECTOR3)],u.prototype,"localPosition",void 0),__decorate([paper.serializedField,editor.property(editor.EditType.QUATERNION)],u.prototype,"localRotation",void 0),__decorate([paper.serializedField,editor.property(editor.EditType.VECTOR3)],u.prototype,"localScale",void 0),u}(paper.BaseComponent);e.Transform=c,__reflect(c.prototype,"egret3d.Transform")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.renderQueue=e.RenderQueue.Geometry,r.passes={},r.defaultValue={},r}return __extends(r,t),r.registerVertShader=function(e,t){var r={name:e,src:t};return this._vertShaderInfoMap[e]=r,r},r.registerFragShader=function(e,t){var r={name:e,src:t};return this._fragShaderInfoMap[e]=r,r},r.prototype.$parse=function(t){if(this._parseProperties(t.properties),t.layer){var r=t.layer;"transparent"===r?this.renderQueue=e.RenderQueue.Transparent:"overlay"===r?this.renderQueue=e.RenderQueue.Overlay:"common"===r&&(this.renderQueue=e.RenderQueue.Geometry)}var a=t.passes;for(var i in a){var n=a[i];if("base"===i||"lightmap"===i||"skin"===i||"quad"===i);else if(0!==i.indexOf("base_")&&0!==i.indexOf("lightmap_")&&0!==i.indexOf("skin_"))continue;this.passes[i]=[];for(var s=0;s<n.length;s++)this.passes[i].push(this._parsePass(n[s]))}if(!this.passes.base)throw new Error("do not have base pass group.")},r.prototype._parseProperties=function(t){for(var r in t){var a=t[r],i=a.match(e.RegexpUtil.floatRegexp);if(i||(i=a.match(e.RegexpUtil.rangeRegexp)),i||(i=a.match(e.RegexpUtil.vectorRegexp)),i||(i=a.match(e.RegexpUtil.textureRegexp)),!i)return void console.error("Asset ("+this.url+") property error! info:\n"+a);if(i.length>=4){var n=i[1],s=i[3].toLowerCase();switch(s){case"float":this.defaultValue[n]={type:s,value:parseFloat(i[4])};break;case"range":this.defaultValue[n]={type:s,min:parseFloat(i[4]),max:parseFloat(i[5]),value:parseFloat(i[6])};break;case"vector":case"color":var o=new e.Vector4(parseFloat(i[4]),parseFloat(i[5]),parseFloat(i[6]),parseFloat(i[7]));this.defaultValue[n]={type:s,value:o};break;case"texture":this.defaultValue[n]={type:s,value:paper.Asset.find(i[4])};break;default:console.log("Asset ("+this.url+") property error! unknown type : "+s)}}}},r.prototype._parsePass=function(t){var a=r._vertShaderInfoMap[t.vs],i=r._fragShaderInfoMap[t.fs];a||console.error("vertex shader "+t.vs+" not found!"),i||console.error("fragment shader "+t.fs+" not found!");var n=e.BlendModeEnum.Close,s=new e.DrawPass(a,i);switch(s.state_ztest=!0,t.showface){case"cw":s.state_showface=e.ShowFaceStateEnum.CW;break;case"ccw":s.state_showface=e.ShowFaceStateEnum.CCW;break;default:s.state_showface=e.ShowFaceStateEnum.ALL}switch(t.zwrite){case"off":s.state_zwrite=!1;break;case"on":default:s.state_zwrite=!0}switch(t.ztest){case"greater":s.state_ztest_method=e.WebGLKit.GREATER;break;case"gequal":s.state_ztest_method=e.WebGLKit.GEQUAL;break;case"less":s.state_ztest_method=e.WebGLKit.LESS;break;case"equal":s.state_ztest_method=e.WebGLKit.EQUAL;break;case"notequal":s.state_ztest_method=e.WebGLKit.NOTEQUAL;break;case"always":case"off":s.state_ztest=!1;break;case"never":s.state_ztest_method=e.WebGLKit.NEVER;break;case"lequal":default:s.state_ztest_method=e.WebGLKit.LEQUAL}switch(t.blendmode){case"add":n=e.BlendModeEnum.Add;break;case"addpremult":n=e.BlendModeEnum.Add_PreMultiply;break;case"blend":n=e.BlendModeEnum.Blend;break;case"blendpremult":n=e.BlendModeEnum.Blend_PreMultiply}return s.setAlphaBlend(n),this.renderQueue===e.RenderQueue.Overlay&&(s.state_ztest=!0,s.state_zwrite=!0,s.state_ztest_method=e.WebGLKit.ALWAYS),s},r.prototype.dispose=function(){for(var e in this.passes)delete this.passes[e];for(var e in this.defaultValue)delete this.defaultValue[e]},r.prototype.caclByteLength=function(){return 0},r._vertShaderInfoMap={},r._fragShaderInfoMap={},r}(paper.Asset);e.Shader=t,__reflect(t.prototype,"egret3d.Shader")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.update=function(){},t}(paper.BaseSystem);e.GizmosSystem=t,__reflect(t.prototype,"egret3d.GizmosSystem")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=new e.Vector3,r=new e.Vector3,a=new e.Vector3,i=new e.Vector3,n=new e.Vector3,s=function(){function s(t,r){this.minimum=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.maximum=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),this._dirtyCenter=!0,this._dirtyRadius=!0,this.srcmin=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.srcmax=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),this._center=new e.Vector3,t&&(e.Vector3.copy(t,this.srcmin),e.Vector3.copy(t,this.minimum)),r&&(e.Vector3.copy(r,this.srcmax),e.Vector3.copy(r,this.maximum))}return s.prototype.update=function(a){e.Matrix.getTranslation(a,t),e.Matrix.getTranslation(a,r),a.rawData[0]>0?(t.x+=a.rawData[0]*this.srcmin.x,r.x+=a.rawData[0]*this.srcmax.x):(t.x+=a.rawData[0]*this.srcmax.x,r.x+=a.rawData[0]*this.srcmin.x),a.rawData[1]>0?(t.y+=a.rawData[1]*this.srcmin.y,r.y+=a.rawData[1]*this.srcmax.y):(t.y+=a.rawData[1]*this.srcmax.y,r.y+=a.rawData[1]*this.srcmin.y),a.rawData[2]>0?(t.z+=a.rawData[2]*this.srcmin.z,r.z+=a.rawData[2]*this.srcmax.z):(t.z+=a.rawData[2]*this.srcmax.z,r.z+=a.rawData[2]*this.srcmin.z),a.rawData[4]>0?(t.x+=a.rawData[4]*this.srcmin.x,r.x+=a.rawData[4]*this.srcmax.x):(t.x+=a.rawData[4]*this.srcmax.x,r.x+=a.rawData[4]*this.srcmin.x),a.rawData[5]>0?(t.y+=a.rawData[5]*this.srcmin.y,r.y+=a.rawData[5]*this.srcmax.y):(t.y+=a.rawData[5]*this.srcmax.y,r.y+=a.rawData[5]*this.srcmin.y),a.rawData[6]>0?(t.z+=a.rawData[6]*this.srcmin.z,r.z+=a.rawData[6]*this.srcmax.z):(t.z+=a.rawData[6]*this.srcmax.z,r.z+=a.rawData[6]*this.srcmin.z),a.rawData[8]>0?(t.x+=a.rawData[8]*this.srcmin.x,r.x+=a.rawData[8]*this.srcmax.x):(t.x+=a.rawData[8]*this.srcmax.x,r.x+=a.rawData[8]*this.srcmin.x),a.rawData[9]>0?(t.y+=a.rawData[9]*this.srcmin.y,r.y+=a.rawData[9]*this.srcmax.y):(t.y+=a.rawData[9]*this.srcmax.y,r.y+=a.rawData[9]*this.srcmin.y),a.rawData[10]>0?(t.z+=a.rawData[10]*this.srcmin.z,r.z+=a.rawData[10]*this.srcmax.z):(t.z+=a.rawData[10]*this.srcmax.z,r.z+=a.rawData[10]*this.srcmin.z),e.Vector3.copy(t,this.minimum),e.Vector3.copy(r,this.maximum),this._dirtyCenter=!0,this._dirtyRadius=!0},s.prototype.addVector3=function(t){e.Vector3.max(this.maximum,t,this.maximum),e.Vector3.min(this.minimum,t,this.minimum),this._dirtyCenter=!0,this._dirtyRadius=!0},s.prototype.containsVector3=function(e){return e.x>this.minimum.x&&e.x<this.maximum.x&&e.y>this.minimum.y&&e.x<this.maximum.y&&e.z>this.minimum.z&&e.z<this.maximum.z},s.prototype.intersectAABB=function(e){return this.minimum.x>e.maximum.x?!1:this.maximum.x<e.minimum.x?!1:this.minimum.x>e.maximum.x?!1:this.maximum.x<e.minimum.x?!1:this.minimum.x>e.maximum.x?!1:this.maximum.x<e.minimum.x?!1:!0},s.prototype.intersectPlane=function(s,o,h){var l=t,c=r,u=a,p=i,d=n,f=this.center;e.Vector3.subtract(o,s,l),e.Vector3.subtract(h,o,c),e.Vector3.cross(l,c,u),e.calPlaneLineIntersectPoint(u,s,u,f,p),e.Vector3.subtract(p,f,d);var _=e.Vector3.dot(u,d);if(0>=_)return!0;var g=e.Vector3.getDistance(f,p);return g<this.radius?!0:!1},s.prototype.addAABB=function(t){e.Vector3.max(this.maximum,t.maximum,this.maximum),e.Vector3.min(this.minimum,t.minimum,this.minimum),this._dirtyCenter=!0,this._dirtyRadius=!0},Object.defineProperty(s.prototype,"center",{get:function(){return this._dirtyCenter&&(e.Vector3.add(this.maximum,this.minimum,this._center),e.Vector3.scale(this._center,.5),this._dirtyCenter=!1),this._center},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"radius",{get:function(){return this._dirtyRadius&&(e.Vector3.subtract(this.maximum,this.minimum,t),e.Vector3.scale(t,.5),this._dirtyRadius=!1),e.Vector3.getLength(t)},enumerable:!0,configurable:!0}),s.prototype.clear=function(){e.Vector3.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this.minimum),e.Vector3.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this.maximum),this._dirtyCenter=!0,this._dirtyRadius=!0},s.prototype.clone=function(){var t=new e.AABB(this.minimum,this.maximum);return t},s.prototype.copy=function(t){return e.Vector3.copy(t.minimum,this.minimum),e.Vector3.copy(t.maximum,this.maximum),this._dirtyCenter=!0,this._dirtyRadius=!0,this},s.prototype.getVec3=function(t){t[0]=e.Vector3.copy(this.minimum,new e.Vector3),t[1]=e.Vector3.copy(this.minimum,new e.Vector3),t[1].z=this.maximum.z,t[2]=e.Vector3.copy(this.minimum,new e.Vector3),t[2].x=this.maximum.x,t[3]=e.Vector3.copy(this.maximum,new e.Vector3),t[3].y=this.minimum.y,t[4]=e.Vector3.copy(this.minimum,new e.Vector3),t[4].y=this.maximum.y,t[5]=e.Vector3.copy(this.maximum,new e.Vector3),t[5].x=this.minimum.x,t[6]=e.Vector3.copy(this.maximum,new e.Vector3),t[6].z=this.minimum.z,t[7]=e.Vector3.copy(this.maximum,new e.Vector3)},s}();e.AABB=s,__reflect(s.prototype,"egret3d.AABB")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(){function e(e,t,r,a){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),void 0===a&&(a=0),this.l=e,this.t=t,this.r=r,this.b=a}return e.prototype.serialize=function(){return[this.l,this.t,this.r,this.b]},e.prototype.deserialize=function(e){this.l=e[0],this.t=e[1],this.r=e[2],this.b=e[3]},e}();e.Border=t,__reflect(t.prototype,"egret3d.Border",["paper.ISerializable"])}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(){function e(e,t,r,a){void 0===e&&(e=1),void 0===t&&(t=1),void 0===r&&(r=1),void 0===a&&(a=1),this.r=e,this.g=t,this.b=r,this.a=a}return e.prototype.serialize=function(){return[this.r,this.g,this.b,this.a]},e.prototype.deserialize=function(e){this.r=e[0],this.g=e[1],this.b=e[2],this.a=e[3]},e.set=function(e,t,r,a,i){return void 0===e&&(e=1),void 0===t&&(t=1),void 0===r&&(r=1),void 0===a&&(a=1),i.r=e,i.g=t,i.b=r,i.a=a,i},e.multiply=function(e,t,r){return r.r=e.r*t.r,r.g=e.g*t.g,r.b=e.b*t.b,r.a=e.a*t.a,r},e.scale=function(e,t){return e.r=e.r*t,e.g=e.g*t,e.b=e.b*t,e.a=e.a*t,e},e.copy=function(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t.a=e.a,t},e.lerp=function(e,t,r,a){return a.a=r*(t.a-e.a)+e.a,a.r=r*(t.r-e.r)+e.r,a.g=r*(t.g-e.g)+e.g,a.b=r*(t.b-e.b)+e.b,a},e}();e.Color=t,__reflect(t.prototype,"egret3d.Color",["paper.ISerializable"])}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(){function t(e,t){this._beizerPoints=e,this._bezierPointNum=t}return Object.defineProperty(t.prototype,"beizerPoints",{get:function(){return this._beizerPoints},set:function(e){this._beizerPoints=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bezierPointNum",{get:function(){return this._bezierPointNum},set:function(e){this._bezierPointNum=e},enumerable:!0,configurable:!0}),t.CreateLinearBezier=function(r,a,i){i=i>2?i:3;var n=new Array,s=function(e,t,r){var a=(1-e)*t+e*r;return a};n.push(r);for(var o=1;i>=o;o++)n.push(new e.Vector3(s(o/i,r.x,a.x),s(o/i,r.y,r.y),s(o/i,r.z,r.z)));return new t(n,i)},t.CreateQuadraticBezier=function(r,a,i,n){n=n>2?n:3;for(var s=new Array,o=function(e,t,r,a){var i=(1-e)*(1-e)*t+2*e*(1-e)*r+e*e*a;return i},h=1;n>=h;h++)s.push(new e.Vector3(o(h/n,r.x,a.x,i.x),o(h/n,r.y,a.y,i.y),o(h/n,r.z,a.z,i.z)));return new t(s,n)},t.CreateCubicBezier=function(r,a,i,n,s){s=s>3?s:4;for(var o=new Array,h=function(e,t,r,a,i){var n=(1-e)*(1-e)*(1-e)*t+3*e*(1-e)*(1-e)*r+3*e*e*(1-e)*a+e*e*e*i;return n},l=1;s>=l;l++)o.push(new e.Vector3(h(l/s,r.x,a.x,i.x,n.x),h(l/s,r.y,a.y,i.y,n.y),h(l/s,r.z,a.z,i.z,n.z)));return new t(o,s)},t.prototype.getPoints=function(){return this._beizerPoints},t}();e.Curve3=t,__reflect(t.prototype,"egret3d.Curve3")}(egret3d||(egret3d={}));var egret3d;!function(e){function t(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=1),t>e?t:e>r?r:e}function r(e){return e=+e,0===e||isNaN(e)?e:e>0?1:-1}function a(e,t,r){return e*(1-r)+t*r}function i(e,t,r,a,i){var n=e.x,s=e.y,o=e.z,h=t.x,l=t.y,c=t.z,u=r.x,p=r.y,d=r.z,f=a.x,_=a.y,g=a.z,m=u*n+p*s+d*o;if(0===m)i=null;else{var v=((h-f)*n+(l-_)*s+(c-g)*o)/m;i.x=f+u*v,i.y=_+p*v,i.z=g+d*v}return i}function n(t,r,a,i,n,u,p){void 0===p&&(p=.3);var d=1-n,f=Math.pow(d,3),_=Math.pow(d,2),g=1-p,m=s;e.Vector3.copy(t,m),e.Vector3.scale(m,f*g);var v=o;e.Vector3.copy(r,v),e.Vector3.scale(v,3*_*n*p);var y=h;e.Vector3.copy(i,y),e.Vector3.scale(y,3*d*Math.pow(n,2)*p);var w=l;e.Vector3.copy(a,w),e.Vector3.scale(w,Math.pow(n,3)*g);var b=c;e.Vector3.add(m,v,b),e.Vector3.add(b,y,b),e.Vector3.add(b,w,b),e.Vector3.copy(b,u),e.Vector3.scale(u,1/(f*g+3*_*n*p+3*d*Math.pow(n,2)*p+Math.pow(n,3)*g))}e.RAD_DEG=180/Math.PI,e.DEG_RAD=Math.PI/180,e.floatClamp=t,e.sign=r,e.numberLerp=a,e.calPlaneLineIntersectPoint=i;var s=new e.Vector3,o=new e.Vector3,h=new e.Vector3,l=new e.Vector3,c=new e.Vector3;e.getPointAlongCurve=n}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e.texturewidth=0,e.textureheight=0,e._sprites={},e._texture=null,e}return __extends(r,t),r.prototype.$parse=function(t){var r=JSON.parse(t),a=r.t;this.texturewidth=r.w,this.textureheight=r.h;var i=r.s;this.texture=paper.Asset.find(e.utils.getPathByUrl(this.url)+"/"+a),this.texture||console.log("atlas texture not found");for(var n in i){var s=i[n],o=s[0],h=new e.Sprite(this.name+"_"+o);this.texture&&(h.texture=this.texture),h.rect.x=s[1],h.rect.y=s[1],h.rect.w=s[1],h.rect.h=s[1],h.border.t=0,h.border.b=0,h.border.l=0,h.border.r=0,h.atlas=this.hashCode.toString(),this._sprites[o]=h}},r.prototype.dispose=function(){for(var e in this._sprites)delete this._sprites[e];this._texture=null},r.prototype.caclByteLength=function(){var t=0;for(var r in this._sprites)t+=this._sprites[r].caclByteLength(),t+=e.utils.caclStringByteLength(r);return t},Object.defineProperty(r.prototype,"sprites",{get:function(){return this._sprites},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"texture",{get:function(){return this._texture},set:function(e){this._texture=e},enumerable:!0,configurable:!0}),r}(paper.Asset);e.Atlas=t,__reflect(t.prototype,"egret3d.Atlas")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(){function e(){}return e}();e.Angelref=t,__reflect(t.prototype,"egret3d.Angelref");var r=function(){function t(e){void 0===e&&(e=null),e?this.rawData=e:this.rawData=new Float32Array([1,0,0,0,1,0])}return t.multiply=function(e,t,r){var a=e.rawData[0],i=e.rawData[1],n=e.rawData[2],s=e.rawData[3],o=e.rawData[4],h=e.rawData[5],l=t.rawData[0],c=t.rawData[1],u=0;return r.rawData[0]=l*a+c*n+u*o,r.rawData[1]=l*i+c*s+u*h,l=t.rawData[2],c=t.rawData[3],u=0,r.rawData[2]=l*a+c*n+u*o,r.rawData[3]=l*i+c*s+u*h,l=t.rawData[4],c=t.rawData[5],u=1,r.rawData[4]=l*a+c*n+u*o,r.rawData[5]=l*i+c*s+u*h,r},t.fromRotate=function(e,t){var r=Math.sin(e),a=Math.cos(e);return t.rawData[0]=a,t.rawData[1]=r,t.rawData[2]=-r,t.rawData[3]=a,t.rawData[4]=0,t.rawData[5]=0,t},t.fromScale=function(e,t,r){return r.rawData[0]=e,r.rawData[1]=0,r.rawData[2]=0,r.rawData[3]=t,r.rawData[4]=0,r.rawData[5]=0,r},t.fromTranslate=function(e,t,r){return r.rawData[0]=1,r.rawData[1]=0,r.rawData[2]=0,r.rawData[3]=1,r.rawData[4]=e,r.rawData[5]=t,r},t.fromRTS=function(e,t,r,n){var s=a;this.fromScale(t.x,t.y,s);var o=i;this.fromRotate(r,o),this.multiply(o,s,n),n.rawData[4]=e.x,n.rawData[5]=e.y},t.transformVector2=function(e,t,r){return r.x=t.x*e.rawData[0]+t.y*e.rawData[2]+e.rawData[4],r.y=t.x*e.rawData[1]+t.y*e.rawData[3]+e.rawData[5],r},t.transformNormal=function(e,t,r){return r.x=t.x*e.rawData[0]+t.y*e.rawData[2],r.y=t.x*e.rawData[1]+t.y*e.rawData[3],r},t.inverse=function(e,t){var r=e.rawData[0],a=e.rawData[1],i=e.rawData[2],n=e.rawData[3],s=e.rawData[4],o=e.rawData[5],h=-(i*-o-n*-s),l=1/(r*n+a*-i);return t.rawData[0]=n*l,t.rawData[2]=-i*l,t.rawData[4]=h*l,t.rawData[1]=-a*l,t.rawData[3]=r*l,t.rawData[5]=(r*-o-a*-s)*l,t
},t.identify=function(e){return e.rawData[0]=1,e.rawData[1]=0,e.rawData[2]=0,e.rawData[3]=1,e.rawData[4]=0,e.rawData[5]=0,e},t.copy=function(e,t){for(var r=0;16>r;r++)t.rawData[r]=e.rawData[r];return t},t.decompose=function(t,r,a,i){i.x=t.rawData[4],i.y=t.rawData[5];var n=e.sign(t.rawData[0]*t.rawData[1])<0?-1:1,s=e.sign(t.rawData[2]*t.rawData[3])<0?-1:1;if(r.x=n*Math.sqrt(t.rawData[0]*t.rawData[0]+t.rawData[1]*t.rawData[1]),r.y=s*Math.sqrt(t.rawData[2]*t.rawData[2]+t.rawData[3]*t.rawData[3]),0===r.x||0===r.y)return a.v=0,!1;var o=t.rawData[0]/r.x,h=t.rawData[1]/r.x,l=Math.asin(o);Math.acos(h);return a.v=l,!0},t}();e.Matrix3x2=r,__reflect(r.prototype,"egret3d.Matrix3x2");var a=new r,i=new r}(egret3d||(egret3d={}));var egret3d;!function(e){var t=new e.Vector3,r=new e.Vector3,a=function(a){function i(){var t=null!==a&&a.apply(this,arguments)||this;return t.center=new e.Vector3,t.size=new e.Vector3,t.vectors=[new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3],t._directions=[new e.Vector3,new e.Vector3,new e.Vector3],t}return __extends(i,a),i.prototype._computeBoxExtents=function(t,r,a){var i=e.Vector3.dot(r.center,t),n=Math.abs(e.Vector3.dot(r._directions[0],t))*r.size.x*.5,s=Math.abs(e.Vector3.dot(r._directions[1],t))*r.size.y*.5,o=Math.abs(e.Vector3.dot(r._directions[2],t))*r.size.z*.5,h=n+s+o;return a.x=i-h,a.y=i+h,a},i.prototype._axisOverlap=function(e,a,i){var n=this._computeBoxExtents(e,a,t),s=this._computeBoxExtents(e,i,r);return!(n.x>n.y||s.x>s.y)},i.prototype.clone=function(){var t=new i;e.Vector3.copy(this.center,t.center),e.Vector3.copy(this.center,t.size);for(var r in this._directions)e.Vector3.copy(this._directions[r],t._directions[r]);return t},i.prototype.setByMaxMin=function(t,r){e.Vector3.copy(t,this.vectors[0]),e.Vector3.copy(t,this.vectors[1]),e.Vector3.copy(t,this.vectors[2]),e.Vector3.copy(r,this.vectors[3]),e.Vector3.copy(t,this.vectors[4]),e.Vector3.copy(r,this.vectors[5]),e.Vector3.copy(r,this.vectors[6]),e.Vector3.copy(r,this.vectors[7]),this.vectors[1].z=r.z,this.vectors[2].x=r.x,this.vectors[3].y=t.y,this.vectors[4].y=r.y,this.vectors[5].x=t.x,this.vectors[6].z=t.z,e.Vector3.add(r,t,this.center),e.Vector3.scale(this.center,.5),e.Vector3.subtract(r,t,this.size)},i.prototype.setByCenterSize=function(t,r){e.Vector3.copy(t,this.center),e.Vector3.copy(r,this.size);var a=.5*this.size.x,i=.5*this.size.y,n=.5*this.size.z,s=this.center.x,o=this.center.y,h=this.center.z;e.Vector3.set(s-a,o-i,h-n,this.vectors[0]),e.Vector3.set(s-a,o-i,h+n,this.vectors[1]),e.Vector3.set(s+a,o-i,h-n,this.vectors[2]),e.Vector3.set(s+a,o-i,h+n,this.vectors[3]),e.Vector3.set(s-a,o+i,h-n,this.vectors[4]),e.Vector3.set(s-a,o+i,h+n,this.vectors[5]),e.Vector3.set(s+a,o+i,h-n,this.vectors[6]),e.Vector3.set(s+a,o+i,h+n,this.vectors[7])},i.prototype.update=function(t){e.Matrix.getTranslation(t,this.center),e.Matrix.getVector3ByOffset(t,0,this._directions[0]),e.Matrix.getVector3ByOffset(t,4,this._directions[1]),e.Matrix.getVector3ByOffset(t,8,this._directions[2])},i.prototype.intersects=function(r){var a=this,i=r;if(!this._axisOverlap(a._directions[0],a,i))return!1;if(!this._axisOverlap(a._directions[1],a,i))return!1;if(!this._axisOverlap(a._directions[2],a,i))return!1;if(!this._axisOverlap(i._directions[0],a,i))return!1;if(!this._axisOverlap(i._directions[1],a,i))return!1;if(!this._axisOverlap(i._directions[2],a,i))return!1;var n=t;return e.Vector3.cross(a._directions[0],i._directions[0],n),this._axisOverlap(n,a,i)?(e.Vector3.cross(a._directions[0],i._directions[1],n),this._axisOverlap(n,a,i)?(e.Vector3.cross(a._directions[0],i._directions[2],n),this._axisOverlap(n,a,i)?(e.Vector3.cross(a._directions[1],i._directions[0],n),this._axisOverlap(n,a,i)?(e.Vector3.cross(a._directions[1],i._directions[1],n),this._axisOverlap(n,a,i)?(e.Vector3.cross(a._directions[1],i._directions[2],n),this._axisOverlap(n,a,i)?(e.Vector3.cross(a._directions[2],i._directions[0],n),this._axisOverlap(n,a,i)?(e.Vector3.cross(a._directions[2],i._directions[1],n),this._axisOverlap(n,a,i)?(e.Vector3.cross(a._directions[2],i._directions[2],n),this._axisOverlap(n,a,i)?!0:!1):!1):!1):!1):!1):!1):!1):!1):!1},i.prototype.caclWorldVectors=function(t,r){for(var a=0;8>a;++a)e.Matrix.transformVector3(this.vectors[a],r,t[a])},i.prototype.deserialize=function(e){this.center.deserialize(e.center),this.size.deserialize(e.size)},__decorate([paper.serializedField],i.prototype,"center",void 0),__decorate([paper.serializedField],i.prototype,"size",void 0),i}(paper.SerializableObject);e.OBB=a,__reflect(a.prototype,"egret3d.OBB")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.assets=[],t}return __extends(t,e),t.prototype.dispose=function(){this.assets.length=0},t.prototype.caclByteLength=function(){return 0},t.prototype.$parse=function(e){if(this.assets.length=0,e.assets&&0!==e.assets.length)for(var t=0,r=e.assets;t<r.length;t++){var a=r[t];this.assets.push(a)}},t}(paper.Asset);e.AssetBundle=t,__reflect(t.prototype,"egret3d.AssetBundle")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=new e.Vector3,r=new e.Vector3,a=new e.Vector3,i=new e.Vector3,n=new e.Vector3,s=new e.Vector3,o=new e.Vector3,h=new e.Vector3,l=[t,r,a,i,n,s,o,h],c=new e.Vector3,u=new e.Vector3,p=new e.Vector3,d=new e.Vector3,f=new e.Vector3,_=[0,1,2,3,4,5,6,7,1,3,5,7,0,2,4,6,6,2,7,3,0,4,1,5],g=function(){function t(t,r){this.origin=e.Vector3.copy(t,new e.Vector3),this.direction=e.Vector3.copy(r,new e.Vector3)}return t.prototype.intersectAABB=function(e){return this.intersectBoxMinMax(e.minimum,e.maximum)},t.prototype.intersectPlaneTransform=function(t){var r=null,a=t.getPosition(),i=c;t.getForward(i);var n=this.intersectPlane(a,i);return n&&(r=new e.PickInfo,r.hitposition=n,r.distance=e.Vector3.getDistance(r.hitposition,this.origin)),r},t.prototype.intersectPlane=function(t,r){var a=r.x,i=r.y,n=r.z,s=t.x,o=t.y,h=t.z,l=this.direction.x,c=this.direction.y,u=this.direction.z,p=this.origin.x,d=this.origin.y,f=this.origin.z,_=l*a+c*i+u*n;if(0===_)return null;var g=((s-p)*a+(o-d)*i+(h-f)*n)/_;return new e.Vector3(p+l*g,d+c*g,f+u*g)},t.prototype.intersectCollider=function(t){var r=t.gameObject.getComponent(e.BaseCollider),a=null;if(r instanceof e.BoxCollider){var i=r.bounds;i.caclWorldVectors(l,r.gameObject.transform.getWorldMatrix());for(var n=0;n<_.length;n+=3){var s=_[n],o=_[n+1],h=_[n+2],u=l[s],p=l[o],d=l[h],f=this.intersectsTriangle(u,p,d);if(f){if(f.distance<0)continue;if(!a||a.distance>f.distance){a=f;var g=c;e.Vector3.copy(this.direction,g),e.Vector3.scale(g,f.distance),e.Vector3.add(this.origin,g,a.hitposition)}}}}return a},t.prototype.intersectBoxMinMax=function(e,t){var r,a,i,n,s=0,o=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<e.x||this.origin.x>t.x)return!1}else if(r=1/this.direction.x,a=(e.x-this.origin.x)*r,i=(t.x-this.origin.x)*r,i===-(1/0)&&(i=1/0),a>i&&(n=a,a=i,i=n),s=Math.max(a,s),o=Math.min(i,o),s>o)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<e.y||this.origin.y>t.y)return!1}else if(r=1/this.direction.y,a=(e.y-this.origin.y)*r,i=(t.y-this.origin.y)*r,i===-(1/0)&&(i=1/0),a>i&&(n=a,a=i,i=n),s=Math.max(a,s),o=Math.min(i,o),s>o)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<e.z||this.origin.z>t.z)return!1}else if(r=1/this.direction.z,a=(e.z-this.origin.z)*r,i=(t.z-this.origin.z)*r,i===-(1/0)&&(i=1/0),a>i&&(n=a,a=i,i=n),s=Math.max(a,s),o=Math.min(i,o),s>o)return!1;return!0},t.prototype.intersectsSphere=function(t,r){var a=c;e.Vector3.subtract(t,this.origin,a);var i=e.Vector3.dot(this.direction,a);if(0>i)return!1;var n=e.Vector3.getSqrLength(a),s=r*r;if(s>n)return!0;var o=s-(n-i*i);return 0>o?!1:!0},t.prototype.intersectsTriangle=function(t,r,a){var i=c,n=u,s=p,o=d,h=f;e.Vector3.subtract(r,t,i),e.Vector3.subtract(a,t,n),e.Vector3.cross(this.direction,n,s);var l=e.Vector3.dot(i,s);if(0===l)return null;var _=1/l;e.Vector3.subtract(this.origin,t,o);var g=e.Vector3.dot(o,s)*_;if(0>g||g>1)return null;e.Vector3.cross(o,i,h);var m=e.Vector3.dot(this.direction,h)*_;if(0>m||g+m>1)return null;var v=new e.PickInfo;return v.distance=e.Vector3.dot(n,h)*_,v.textureCoordA.x=g,v.textureCoordA.y=m,v},t}();e.Ray=g,__reflect(g.prototype,"egret3d.Ray")}(egret3d||(egret3d={}));var egret3d;!function(e){var t;!function(e){e.boneeff_vert="attribute vec4 _glesVertex;   \nattribute vec4 _glesBlendIndex4;\nattribute vec4 _glesBlendWeight4;\nattribute vec4 _glesMultiTexCoord0;\nuniform highp mat4 glstate_matrix_mvp;\nuniform highp vec4 glstate_vec4_bones[110];\nuniform highp vec4 _MainTex_ST; \nvarying highp vec2 xlv_TEXCOORD0;\nmat4 buildMat4(int index)\n{\n	vec4 quat = glstate_vec4_bones[index * 2 + 0];\n	vec4 translation = glstate_vec4_bones[index * 2 + 1];\n	float xy2 = 2.0 * quat.x * quat.y;\n	float xz2 = 2.0 * quat.x * quat.z;\n	float xw2 = 2.0 * quat.x * quat.w;\n	float yz2 = 2.0 * quat.y * quat.z;\n	float yw2 = 2.0 * quat.y * quat.w;\n	float zw2 = 2.0 * quat.z * quat.w;\n	float xx = quat.x * quat.x;\n	float yy = quat.y * quat.y;\n	float zz = quat.z * quat.z;\n	float ww = quat.w * quat.w;\n	mat4 matrix = mat4(\n	xx - yy - zz + ww, xy2 + zw2, xz2 - yw2, 0,\n	xy2 - zw2, -xx + yy - zz + ww, yz2 + xw2, 0,\n	xz2 + yw2, yz2 - xw2, -xx - yy + zz + ww, 0,\n	translation.x, translation.y, translation.z, 1);\n	return matrix;\n}\nhighp vec4 calcVertex(highp vec4 srcVertex,highp vec4 blendIndex,highp vec4 blendWeight)\n{\n	int i = int(blendIndex.x);  \n    int i2 =int(blendIndex.y);\n	int i3 =int(blendIndex.z);\n	int i4 =int(blendIndex.w);\n	\n    mat4 mat = buildMat4(i)*blendWeight.x \n			 + buildMat4(i2)*blendWeight.y \n			 + buildMat4(i3)*blendWeight.z \n			 + buildMat4(i4)*blendWeight.w;\n	return mat* srcVertex;\n}\nvoid main()\n{                                               \n    highp vec4 tmpvar_1;                        \n    tmpvar_1.w = 1.0;                           \n    tmpvar_1.xyz = calcVertex(_glesVertex,_glesBlendIndex4,_glesBlendWeight4).xyz;  \n			 \n    gl_Position = glstate_matrix_mvp *  tmpvar_1;\n	xlv_TEXCOORD0 = _glesMultiTexCoord0.xy * _MainTex_ST.xy + _MainTex_ST.zw;  \n}",e.bone_vert="attribute vec4 _glesVertex;   \nattribute vec4 _glesBlendIndex4;\nattribute vec4 _glesBlendWeight4;\nattribute vec4 _glesMultiTexCoord0;\nuniform highp mat4 glstate_matrix_mvp;\nuniform highp mat4 glstate_matrix_bones[24];\nuniform highp vec4 _MainTex_ST; \nvarying highp vec2 xlv_TEXCOORD0;\nvoid main()                                     \n{                                               \n    highp vec4 tmpvar_1;                        \n    tmpvar_1.w = 1.0;                           \n    tmpvar_1.xyz = _glesVertex.xyz;  \n	\n    int i = int(_glesBlendIndex4.x);  \n    int i2 =int(_glesBlendIndex4.y);\n	int i3 =int(_glesBlendIndex4.z);\n	int i4 =int(_glesBlendIndex4.w);\n	\n    mat4 mat = glstate_matrix_bones[i]*_glesBlendWeight4.x \n			 + glstate_matrix_bones[i2]*_glesBlendWeight4.y \n			 + glstate_matrix_bones[i3]*_glesBlendWeight4.z \n			 + glstate_matrix_bones[i4]*_glesBlendWeight4.w;\n			 \n    gl_Position = (glstate_matrix_mvp * mat)* tmpvar_1;\n	xlv_TEXCOORD0 = _glesMultiTexCoord0.xy * _MainTex_ST.xy + _MainTex_ST.zw;\n}",e.code2_frag="void main() {\n    gl_FragData[0] = vec4(1.0, 1.0, 1.0, 1.0);\n}",e.code_frag="uniform sampler2D _MainTex;                                                 \nvarying lowp vec4 xlv_COLOR;                                                 \nvarying highp vec2 xlv_TEXCOORD0;   \nvoid main() {\n    lowp vec4 col_1;    \n    mediump vec4 prev_2;\n    lowp vec4 tmpvar_3;\n    tmpvar_3 = (xlv_COLOR * texture2D(_MainTex, xlv_TEXCOORD0));\n    prev_2 = tmpvar_3;\n    mediump vec4 tmpvar_4;\n    tmpvar_4 = mix(vec4(1.0, 1.0, 1.0, 1.0), prev_2, prev_2.wwww);\n    col_1 = tmpvar_4;\n    col_1.x =xlv_TEXCOORD0.x;\n    col_1.y =xlv_TEXCOORD0.y;\n    gl_FragData[0] = col_1;\n}",e.code_vert="attribute vec4 _glesVertex;\nattribute vec4 _glesColor;             \nattribute vec4 _glesMultiTexCoord0;    \nuniform highp mat4 glstate_matrix_mvp; \nvarying lowp vec4 xlv_COLOR;           \nvarying highp vec2 xlv_TEXCOORD0;      \nvoid main() {                                          \n    highp vec4 tmpvar_1;                   \n    tmpvar_1.w = 1.0;                      \n    tmpvar_1.xyz = _glesVertex.xyz;        \n    xlv_COLOR = _glesColor;                \n    xlv_TEXCOORD0 = _glesMultiTexCoord0.xy;\n    gl_Position = (glstate_matrix_mvp * tmpvar_1);\n}",e.depthpackage_frag="#include <packing>\nvoid main() {\n	gl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n}",e.depthpackage_vert="attribute vec3 _glesVertex;\nuniform mat4 glstate_matrix_mvp;\nvoid main() { \n    gl_Position = glstate_matrix_mvp * vec4(_glesVertex, 1.0);\n}",e.diffuselightmap_frag="uniform sampler2D _MainTex;\nuniform sampler2D _LightmapTex;\nuniform lowp float _AlphaCut;\nvarying highp vec2 xlv_TEXCOORD0;\nvarying highp vec2 xlv_TEXCOORD1;\nlowp vec3 decode_hdr(lowp vec4 data)\n{\n    highp float power =pow( 2.0 ,data.a * 255.0 - 128.0);\n    return data.rgb * power * 1.0 ;\n}\nvoid main() \n{\n    lowp vec4 outColor = texture2D(_MainTex, xlv_TEXCOORD0);\n    if(outColor.a < _AlphaCut)\n        discard;\n    lowp vec4 lightmap = texture2D(_LightmapTex, xlv_TEXCOORD1);\n    outColor.xyz *= decode_hdr(lightmap);\n    gl_FragData[0] = outColor;\n}",e.diffuselightmap_vert="attribute vec4 _glesVertex;\nattribute vec4 _glesMultiTexCoord0;\nattribute vec4 _glesMultiTexCoord1;\nuniform highp mat4 glstate_matrix_mvp;\nuniform highp vec4 glstate_lightmapOffset;\nuniform lowp float glstate_lightmapUV;\nuniform highp vec4 _MainTex_ST; \nvarying highp vec2 xlv_TEXCOORD0;\nvarying highp vec2 xlv_TEXCOORD1;\nvoid main()\n{\n    highp vec4 tmpvar_1;\n    tmpvar_1.w = 1.0;\n    tmpvar_1.xyz = _glesVertex.xyz;\n    xlv_TEXCOORD0 = _glesMultiTexCoord0.xy * _MainTex_ST.xy + _MainTex_ST.zw;  \n    highp vec2 beforelightUV = _glesMultiTexCoord1.xy;\n    if(glstate_lightmapUV == 0.0)\n    {\n        beforelightUV = _glesMultiTexCoord0.xy;\n    }\n    highp float u = beforelightUV.x * glstate_lightmapOffset.x + glstate_lightmapOffset.z;\n    highp float v = 1.0 - ((1.0 - beforelightUV.y) * glstate_lightmapOffset.y + glstate_lightmapOffset.w);\n    xlv_TEXCOORD1 = vec2(u,v);\n    gl_Position = (glstate_matrix_mvp * tmpvar_1);\n}",e.diffuse_frag="uniform sampler2D _MainTex;\nuniform lowp float _AlphaCut;\nvarying highp vec2 xlv_TEXCOORD0;\nvoid main() {\n    lowp vec4 tmpvar_3 = texture2D(_MainTex, xlv_TEXCOORD0);\n    if(tmpvar_3.a < _AlphaCut)\n        discard;\n    gl_FragData[0] = tmpvar_3;\n}",e.diffuse_vert="attribute vec4 _glesVertex;\nattribute vec4 _glesMultiTexCoord0;\nuniform highp mat4 glstate_matrix_mvp;\nuniform highp vec4 _MainTex_ST;  \nvarying highp vec2 xlv_TEXCOORD0;\nvoid main() {\n    highp vec4 tmpvar_1;\n    tmpvar_1.w = 1.0;\n    tmpvar_1.xyz = _glesVertex.xyz;\n    xlv_TEXCOORD0 = _glesMultiTexCoord0.xy * _MainTex_ST.xy + _MainTex_ST.zw;  \n    gl_Position = (glstate_matrix_mvp * tmpvar_1);\n}",e.distancepackage_frag="#include <packing>\nvarying vec3 xlv_POS;\nuniform vec4 glstate_referencePosition;\nuniform float glstate_nearDistance;\nuniform float glstate_farDistance;\nvoid main() {\n    float dist = length( xlv_POS - glstate_referencePosition.xyz );\n	dist = ( dist - glstate_nearDistance ) / ( glstate_farDistance - glstate_nearDistance );\n	dist = saturate( dist );\n	gl_FragColor = packDepthToRGBA( dist );\n}",e.distancepackage_vert="attribute vec3 _glesVertex;\nuniform mat4 glstate_matrix_mvp;\nuniform mat4 glstate_matrix_model;\nvarying vec3 xlv_POS;\nvoid main() {   \n    xlv_POS = (glstate_matrix_model * vec4(_glesVertex, 1.0)).xyz;\n    gl_Position = glstate_matrix_mvp * vec4(_glesVertex, 1.0);\n}",e.lambert_frag="#extension GL_OES_standard_derivatives : enable\nuniform sampler2D _MainTex;\nuniform vec4 _Color;         \n#include <bsdfs>\n#include <light_pars_frag>\n#include <shadowMap_pars_frag>\nvarying vec3 xlv_POS;\nvarying vec3 xlv_NORMAL;                \nvarying vec2 xlv_TEXCOORD0;\n#ifdef USE_NORMAL_MAP\n    #include <tbn>\n    #include <tsn>\n    uniform sampler2D _NormalTex;\n#endif\n#include <bumpMap_pars_frag>\nvoid main() {\n    vec4 outColor = vec4(0., 0., 0., 1.);\n    vec4 diffuseColor = _Color * texture2D(_MainTex, xlv_TEXCOORD0);\n    #include <normal_frag>\n    #include <light_frag>\n    outColor.a = diffuseColor.a;\n    gl_FragColor = outColor;\n}",e.lambert_vert="attribute vec3 _glesVertex;   \nattribute vec3 _glesNormal;               \nattribute vec4 _glesMultiTexCoord0;    \nuniform mat4 glstate_matrix_mvp;      \nuniform mat4 glstate_matrix_model;\n#include <shadowMap_pars_vert>\nvarying vec3 xlv_POS;\nvarying vec3 xlv_NORMAL;                \nvarying vec2 xlv_TEXCOORD0;\n#include <transpose>\n#include <inverse>\nvoid main() {   \n    vec4 tmpvar_1 = vec4(_glesVertex.xyz, 1.0);                            \n    vec3 normal = (transpose(inverse(glstate_matrix_model)) * vec4(_glesNormal, 1.0)).xyz;\n    xlv_NORMAL = normal;\n    #ifdef FLIP_SIDED\n    	xlv_NORMAL = - xlv_NORMAL;\n    #endif\n    vec3 worldpos = (glstate_matrix_model * tmpvar_1).xyz;\n    xlv_POS = worldpos; \n    xlv_TEXCOORD0 = _glesMultiTexCoord0.xy;\n    #include <shadowMap_vert>\n     \n    gl_Position = (glstate_matrix_mvp * tmpvar_1);\n}",e.line_frag="varying lowp vec4 xlv_COLOR;\nvoid main() {\n    gl_FragData[0] = xlv_COLOR;\n}",e.line_vert="attribute vec4 _glesVertex;\nattribute vec4 _glesColor;\nuniform highp mat4 glstate_matrix_mvp;\nvarying lowp vec4 xlv_COLOR;\nvoid main() {\n    highp vec4 tmpvar_1;\n    tmpvar_1.w = 1.0;\n    tmpvar_1.xyz = _glesVertex.xyz;\n    xlv_COLOR = _glesColor;\n    gl_Position = (glstate_matrix_mvp * tmpvar_1);\n}",e.materialcolor_vert="attribute vec4 _glesVertex;\nuniform vec4 _Color;\nuniform highp mat4 glstate_matrix_mvp;\nvarying lowp vec4 xlv_COLOR;\nvoid main() {\n    highp vec4 tmpvar_1;\n    tmpvar_1.w = 1.0;\n    tmpvar_1.xyz = _glesVertex.xyz;\n    xlv_COLOR = _Color;\n    gl_Position = (glstate_matrix_mvp * tmpvar_1);\n}",e.postdepth_frag="precision highp float;\nconst float PackUpscale = 256. / 255.; \nconst float UnpackDownscale = 255. / 256.; \nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) \n{\n    vec4 r = vec4( fract( v * PackFactors ), v );\n	r.yzw -= r.xyz * ShiftRight8;\n    return r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) \n{\n    return dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( const in float v ) \n{\n    vec2 r = vec2( fract( v * PackFactors.z ), v );\n	r.y -= r.x * ShiftRight8;\n    return r * PackUpscale;\n}\nfloat unpackRGToDepth( const in vec2 v ) \n{\n    return dot( v.xy, UnpackFactors.zw );\n}\nvec3 packDepthToRGB( const in float v ) \n{\n    vec3 r = vec3( fract( v * PackFactors.yz ), v );\n	r.yz -= r.xy * ShiftRight8;\n    return r * PackUpscale;\n}\nfloat unpackRGBToDepth( const in vec3 v ) \n{\n    return dot( v.xyz, UnpackFactors.yzw );\n}\nvoid main() \n{\n    float z = gl_FragCoord.z;    gl_FragColor=packDepthToRGBA(z);\n}",e.postdepth_vert="precision highp float;\nattribute vec4 _glesVertex;    \nuniform highp mat4 glstate_matrix_mvp;      \n            \nvoid main()                                     \n{        \n    gl_Position = (glstate_matrix_mvp * _glesVertex);  \n}",e.postquaddepth_frag="precision mediump float;\nvarying highp vec2 xlv_TEXCOORD0;       \nuniform sampler2D _DepthTex;   \nuniform sampler2D _MainTex;  \nconst float PackUpscale = 256. / 255.; \nconst float UnpackDownscale = 255. / 256.; \nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) \n{\n    vec4 r = vec4( fract( v * PackFactors ), v );\n	r.yzw -= r.xyz * ShiftRight8;\n    return r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) \n{\n    return dot( v, UnpackFactors );\n}\nfloat planeDistance(const in vec3 positionA, const in vec3 normalA, \n                    const in vec3 positionB, const in vec3 normalB) \n{\n  vec3 positionDelta = positionB-positionA;\n  float planeDistanceDelta = max(abs(dot(positionDelta, normalA)), abs(dot(positionDelta, normalB)));\n  return planeDistanceDelta;\n}\nvoid main()         \n{\n    lowp vec4 c1=texture2D(_DepthTex, xlv_TEXCOORD0+vec2(0.001,0));\n    lowp vec4 c2=texture2D(_DepthTex, xlv_TEXCOORD0+vec2(-0.001,0));\n    lowp vec4 c3=texture2D(_DepthTex, xlv_TEXCOORD0+vec2(0,0.001));\n    lowp vec4 c4=texture2D(_DepthTex, xlv_TEXCOORD0+vec2(0,-0.001));\n    highp float z1 = unpackRGBAToDepth(c1);\n    highp float z2 = unpackRGBAToDepth(c2);\n    highp float z3 = unpackRGBAToDepth(c3);\n    highp float z4 = unpackRGBAToDepth(c4);\n    highp float d = clamp(  (abs(z2-z1)+abs(z4-z3))*10.0,0.0,1.0);\n    lowp vec4 c=texture2D(_MainTex, xlv_TEXCOORD0);\n    lowp float g = c.r*0.3+c.g*0.6+c.b*0.1;\n    gl_FragColor =mix(vec4(g,g,g,1.),vec4(1.0,1.0,0.0,1.0),d);}",e.postquad_vert="attribute vec4 _glesVertex;\nattribute vec4 _glesMultiTexCoord0; \nuniform highp vec4 _MainTex_ST; \nvarying highp vec2 xlv_TEXCOORD0;   \nvoid main()                     \n{ \n    gl_Position = _glesVertex;\n    xlv_TEXCOORD0 = _glesMultiTexCoord0.xy * _MainTex_ST.xy + _MainTex_ST.zw; \n}   ",e.tintcolor_frag="uniform sampler2D _MainTex;\nuniform lowp float _AlphaCut;\nuniform lowp vec4 _TintColor;\nvarying highp vec2 xlv_TEXCOORD0;\nvoid main() \n{\n    lowp vec4 tmpvar_3 = _TintColor*texture2D(_MainTex, xlv_TEXCOORD0);\n    if(tmpvar_3.a < _AlphaCut)\n        discard;\n    gl_FragData[0] = tmpvar_3;\n}",e.transparentdiffuse_vert="",e.uifont_frag="precision mediump float;\nuniform sampler2D _MainTex;\nvarying lowp vec4 xlv_COLOR;\nvarying lowp vec4 xlv_COLOREx;\nvarying highp vec2 xlv_TEXCOORD0;  \nvoid main() {\n    float scale = 10.0;\n    float d = (texture2D(_MainTex, xlv_TEXCOORD0).r - 0.5) * scale;    float bd = (texture2D(_MainTex, xlv_TEXCOORD0).r - 0.34) * scale;\n    float c=xlv_COLOR.a * clamp ( d,0.0,1.0);\n    float bc=xlv_COLOREx.a * clamp ( bd,0.0,1.0);\n    bc =min(1.0-c,bc);\n    gl_FragData[0] =xlv_COLOR*c + xlv_COLOREx*bc;\n}",e.uifont_vert="attribute vec4 _glesVertex;   \nattribute vec4 _glesColor;                  \nattribute vec4 _glesColorEx;                  \nattribute vec4 _glesMultiTexCoord0;         \nuniform highp mat4 glstate_matrix_mvp;      \nvarying lowp vec4 xlv_COLOR;                \nvarying lowp vec4 xlv_COLOREx;                                                 \nvarying highp vec2 xlv_TEXCOORD0;           \nvoid main() {                                               \n    highp vec4 tmpvar_1;                        \n    tmpvar_1.w = 1.0;                           \n    tmpvar_1.xyz = _glesVertex.xyz;             \n    xlv_COLOR = _glesColor;                     \n    xlv_COLOREx = _glesColorEx;                     \n    xlv_TEXCOORD0 = _glesMultiTexCoord0.xy;     \n    gl_Position = (glstate_matrix_mvp * tmpvar_1);  \n}",e.ui_frag="uniform sampler2D _MainTex;\nvarying lowp vec4 xlv_COLOR;\nvarying highp vec2 xlv_TEXCOORD0;\nvoid main() {\n    lowp vec4 tmpvar_3;\n    tmpvar_3 = (xlv_COLOR * texture2D(_MainTex, xlv_TEXCOORD0));\n    gl_FragData[0] = tmpvar_3;\n}",e.vertcolor_frag="uniform sampler2D _MainTex;                                                 \nvarying lowp vec4 xlv_COLOR;                                                 \nvarying highp vec2 xlv_TEXCOORD0;   \nvoid main() \n{\n    lowp vec4 col_1;    \n    mediump vec4 prev_2;\n    lowp vec4 tmpvar_3;\n    tmpvar_3 = (texture2D(_MainTex, xlv_TEXCOORD0));\n    gl_FragData[0] = tmpvar_3;\n}",e.vertcolor_vert="attribute vec4 _glesVertex;   \nattribute vec4 _glesNormal;   \nattribute vec4 _glesColor;                  \nattribute vec4 _glesMultiTexCoord0;        \nuniform highp mat4 glstate_matrix_mvp;   \nvarying lowp vec4 xlv_COLOR;                \nvarying highp vec2 xlv_TEXCOORD0;   \nuniform highp vec4 _MainTex_ST;       \nvoid main()                                     \n{                                               \n    highp vec4 tmpvar_1;                        \n    tmpvar_1.w = 1.0;                           \n    tmpvar_1.xyz = _glesVertex.xyz;             \n    xlv_COLOR = _glesColor;                     \n    xlv_TEXCOORD0 = _glesMultiTexCoord0.xy * _MainTex_ST.xy + _MainTex_ST.zw;   \n    gl_Position = (glstate_matrix_mvp * tmpvar_1);  \n}\n"}(t=e.ShaderLib||(e.ShaderLib={}))}(egret3d||(egret3d={}));var egret3d;!function(e){var t;!function(e){e.begin_vert="vec3 transformed = vec3(_glesVertex);\n    vec3 objectNormal = vec3(_glesNormal);\n// #endif",e.bsdfs="\nvec3 BRDF_Diffuse_Lambert(vec3 diffuseColor) {\n    return RECIPROCAL_PI * diffuseColor;\n}\nvec4 F_Schlick( const in vec4 specularColor, const in float dotLH ) {\n	float fresnel = pow( 1.0 - dotLH, 5.0 );\n	return ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nfloat G_BlinnPhong_Implicit( ) {\n	return 0.25;\n}\nvec4 BRDF_Specular_BlinnPhong(vec4 specularColor, vec3 N, vec3 L, vec3 V, float shininess) {\n    vec3 H = normalize(L + V);\n    float dotNH = saturate(dot(N, H));\n    float dotLH = saturate(dot(L, H));\n    vec4 F = F_Schlick(specularColor, dotLH);\n    float G = G_BlinnPhong_Implicit( );\n    float D = D_BlinnPhong(shininess, dotNH);\n    return F * G * D;\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n	float a2 = pow2( alpha );\n	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n	return RECIPROCAL_PI * a2 / pow2( denom );\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n	float a2 = pow2( alpha );\n	float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n	float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n	return 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n	float a2 = pow2( alpha );\n	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n	return 0.5 / max( gv + gl, EPSILON );\n}\nvec4 BRDF_Specular_GGX(vec4 specularColor, vec3 N, vec3 L, vec3 V, float roughness) {\n	float alpha = pow2( roughness );\n	vec3 H = normalize(L + V);\n	float dotNL = saturate( dot(N, L) );\n	float dotNV = saturate( dot(N, V) );\n	float dotNH = saturate( dot(N, H) );\n	float dotLH = saturate( dot(L, H) );\n	vec4 F = F_Schlick( specularColor, dotLH );\n	float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n	float D = D_GGX( alpha, dotNH );\n	return F * G * D;\n}\nvec4 BRDF_Specular_GGX_Environment( const in vec3 N, const in vec3 V, const in vec4 specularColor, const in float roughness ) {\n	float dotNV = saturate( dot( N, V ) );\n	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n	vec4 r = roughness * c0 + c1;\n	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n	vec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n	return specularColor * AB.x + AB.y;\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n	return ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n	return sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}",e.bumpMap_pars_frag="#ifdef USE_BUMPMAP\n	uniform sampler2D bumpMap;\n	uniform float bumpScale;\n	vec2 dHdxy_fwd(vec2 uv) {\n		vec2 dSTdx = dFdx( uv );\n		vec2 dSTdy = dFdy( uv );\n		float Hll = bumpScale * texture2D( bumpMap, uv ).x;\n		float dBx = bumpScale * texture2D( bumpMap, uv + dSTdx ).x - Hll;\n		float dBy = bumpScale * texture2D( bumpMap, uv + dSTdy ).x - Hll;\n		return vec2( dBx, dBy );\n	}\n	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy) {\n		vec3 vSigmaX = dFdx( surf_pos );\n		vec3 vSigmaY = dFdy( surf_pos );\n		vec3 vN = surf_norm;\n		vec3 R1 = cross( vSigmaY, vN );\n		vec3 R2 = cross( vN, vSigmaX );\n		float fDet = dot( vSigmaX, R1 );\n		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n		return normalize( abs( fDet ) * surf_norm - vGrad );\n	}\n#endif\n",e.inverse="mat4 inverse(mat4 m) {\n    float\n    a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n    a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n    a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n    a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n    b00 = a00 * a11 - a01 * a10,\n    b01 = a00 * a12 - a02 * a10,\n    b02 = a00 * a13 - a03 * a10,\n    b03 = a01 * a12 - a02 * a11,\n    b04 = a01 * a13 - a03 * a11,\n    b05 = a02 * a13 - a03 * a12,\n    b06 = a20 * a31 - a21 * a30,\n    b07 = a20 * a32 - a22 * a30,\n    b08 = a20 * a33 - a23 * a30,\n    b09 = a21 * a32 - a22 * a31,\n    b10 = a21 * a33 - a23 * a31,\n    b11 = a22 * a33 - a23 * a32,\n    det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n    return mat4(\n        a11 * b11 - a12 * b10 + a13 * b09,\n        a02 * b10 - a01 * b11 - a03 * b09,\n        a31 * b05 - a32 * b04 + a33 * b03,\n        a22 * b04 - a21 * b05 - a23 * b03,\n        a12 * b08 - a10 * b11 - a13 * b07,\n        a00 * b11 - a02 * b08 + a03 * b07,\n        a32 * b02 - a30 * b05 - a33 * b01,\n        a20 * b05 - a22 * b02 + a23 * b01,\n        a10 * b10 - a11 * b08 + a13 * b06,\n        a01 * b08 - a00 * b10 - a03 * b06,\n        a30 * b04 - a31 * b02 + a33 * b00,\n        a21 * b02 - a20 * b04 - a23 * b00,\n        a11 * b07 - a10 * b09 - a12 * b06,\n        a00 * b09 - a01 * b07 + a02 * b06,\n        a31 * b01 - a30 * b03 - a32 * b00,\n        a20 * b03 - a21 * b01 + a22 * b00) / det;\n}",e.light_frag="#ifdef USE_LIGHT    \n    vec3 L;\n    vec3 light;\n    vec3 totalReflect = vec3(0., 0., 0.);\n    #ifdef USE_DIRECT_LIGHT\n        for(int i = 0; i < USE_DIRECT_LIGHT; i++) {\n            light = vec3(glstate_directLights[i * 15 + 6], glstate_directLights[i * 15 + 7], glstate_directLights[i * 15 + 8]) * glstate_directLights[i * 15 + 9];\n            L.x = glstate_directLights[i * 15 + 3];\n            L.y = glstate_directLights[i * 15 + 4];\n            L.z = glstate_directLights[i * 15 + 5];\n            L = normalize(-L);\n            float dotNL = saturate( dot(N, L) );\n            vec3 irradiance = light * dotNL;\n            #ifdef USE_PBR\n                irradiance *= PI;\n            #endif\n            #ifdef USE_SHADOW\n                irradiance *= bool( glstate_directLights[i * 15 + 10] ) ? getShadow( glstate_directionalShadowMap[ i ], vDirectionalShadowCoord[ i ], glstate_directLights[i * 15 + 11], glstate_directLights[i * 15 + 12], vec2(glstate_directLights[i * 15 + 13], glstate_directLights[i * 15 + 14]) ) : 1.0;\n            #endif\n            vec3 reflectLight = irradiance * BRDF_Diffuse_Lambert(diffuseColor.xyz);\n            totalReflect += reflectLight;\n        }\n    #endif\n    #ifdef USE_POINT_LIGHT\n        for(int i = 0; i < USE_POINT_LIGHT; i++) {\n            L = vec3(glstate_pointLights[i * 19 + 0], glstate_pointLights[i * 19 + 1], glstate_pointLights[i * 19 + 2]) - xlv_POS;\n            float dist = pow(clamp(1. - length(L) / glstate_pointLights[i * 19 + 10], 0.0, 1.0), glstate_pointLights[i * 19 + 11]);\n            light = vec3(glstate_pointLights[i * 19 + 6], glstate_pointLights[i * 19 + 7], glstate_pointLights[i * 19 + 8]) * glstate_pointLights[i * 19 + 9] * dist;\n            L = normalize(L);\n            float dotNL = saturate( dot(N, L) );\n            vec3 irradiance = light * dotNL;\n            #ifdef USE_PBR\n                irradiance *= PI;\n            #endif\n            #ifdef USE_SHADOW\n                vec3 worldV = xlv_POS - vec3(glstate_pointLights[i * 19 + 0], glstate_pointLights[i * 19 + 1], glstate_pointLights[i * 19 + 2]);\n                irradiance *= bool( glstate_pointLights[i * 19 + 12] ) ? getPointShadow( glstate_pointShadowMap[ i ], worldV, glstate_pointLights[i * 19 + 13], glstate_pointLights[i * 19 + 14], vec2(glstate_pointLights[i * 19 + 17], glstate_pointLights[i * 19 + 18]), glstate_pointLights[i * 19 + 15], glstate_pointLights[i * 19 + 16]) : 1.0;\n            #endif\n            vec3 reflectLight = irradiance * BRDF_Diffuse_Lambert(diffuseColor.xyz);\n            totalReflect += reflectLight;\n        }\n    #endif\n    #ifdef USE_SPOT_LIGHT\n        for(int i = 0; i < USE_SPOT_LIGHT; i++) {\n            L = vec3(glstate_spotLights[i * 19 + 0], glstate_spotLights[i * 19 + 1], glstate_spotLights[i * 19 + 2]) - xlv_POS;\n            float lightDistance = length(L);\n            L = normalize(L);\n            float angleCos = dot( L, -normalize(vec3(glstate_spotLights[i * 19 + 3], glstate_spotLights[i * 19 + 4], glstate_spotLights[i * 19 + 5])) );\n            if( all( bvec2(angleCos > glstate_spotLights[i * 19 + 12], lightDistance < glstate_spotLights[i * 19 + 10]) ) ) {\n                float spotEffect = smoothstep( glstate_spotLights[i * 19 + 12], glstate_spotLights[i * 19 + 13], angleCos );\n                float dist = pow(clamp(1. - lightDistance / glstate_spotLights[i * 19 + 10], 0.0, 1.0), glstate_spotLights[i * 19 + 11]);\n                light = vec3(glstate_spotLights[i * 19 + 6], glstate_spotLights[i * 19 + 7], glstate_spotLights[i * 19 + 8]) * glstate_spotLights[i * 19 + 9] * dist * spotEffect;\n                float dotNL = saturate( dot(N, L) );\n                vec3 irradiance = light * dotNL;\n                #ifdef USE_PBR\n                    irradiance *= PI;\n                #endif\n                #ifdef USE_SHADOW\n                    irradiance *= bool( glstate_spotLights[i * 17 + 14] ) ? getShadow( glstate_spotShadowMap[ i ], vSpotShadowCoord[ i ], glstate_spotLights[i * 17 + 15], glstate_spotLights[i * 17 + 16], vec2(glstate_spotLights[i * 17 + 17], glstate_spotLights[i * 17 + 18])) : 1.0;\n                #endif\n                vec3 reflectLight = irradiance * BRDF_Diffuse_Lambert(diffuseColor.xyz);\n                totalReflect += reflectLight;\n            }\n        }\n    #endif\n    outColor.xyz = totalReflect;\n#endif",e.light_pars_frag="#ifdef USE_DIRECT_LIGHT\n    uniform float glstate_directLights[USE_DIRECT_LIGHT * 15];\n#endif\n#ifdef USE_POINT_LIGHT\n    uniform float glstate_pointLights[USE_POINT_LIGHT * 19];\n#endif\n#ifdef USE_SPOT_LIGHT\n    uniform float glstate_spotLights[USE_SPOT_LIGHT * 19];\n#endif",e.normal_frag="#ifdef DOUBLE_SIDED\n    float flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n#else\n    float flipNormal = 1.0;\n#endif\n#ifdef FLAT_SHADED\n    vec3 fdx = vec3( dFdx( xlv_POS.x ), dFdx( xlv_POS.y ), dFdx( xlv_POS.z ) );\n    vec3 fdy = vec3( dFdy( xlv_POS.x ), dFdy( xlv_POS.y ), dFdy( xlv_POS.z ) );\n    vec3 N = normalize( cross( fdx, fdy ) );\n#else\n    vec3 N = normalize(xlv_NORMAL) * flipNormal;\n#endif\n#ifdef USE_NORMAL_MAP\n    vec3 normalMapColor = texture2D(_NormalTex, xlv_TEXCOORD0).rgb;\n    mat3 tspace = tsn(N, -xlv_POS, vec2(xlv_TEXCOORD0.x, 1.0 - xlv_TEXCOORD0.y));\n    N = normalize(tspace * (normalMapColor * 2.0 - 1.0));\n#elif defined(USE_BUMPMAP)\n    N = perturbNormalArb(-xlv_POS, N, dHdxy_fwd(xlv_TEXCOORD0));\n#endif",e.packing="const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n    vec4 r = vec4( fract( v * PackFactors ), v );\n    r.yzw -= r.xyz * ShiftRight8;    return r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n    return dot( v, UnpackFactors );\n}",e.shadowMap_frag="#ifdef USE_SHADOW\n#endif",e.shadowMap_pars_frag="#ifdef USE_SHADOW\n    #include <packing>\n    #ifdef USE_DIRECT_LIGHT\n        uniform sampler2D glstate_directionalShadowMap[ USE_DIRECT_LIGHT ];\n        varying vec4 vDirectionalShadowCoord[ USE_DIRECT_LIGHT ];\n    #endif\n    #ifdef USE_POINT_LIGHT\n        uniform samplerCube glstate_pointShadowMap[ USE_POINT_LIGHT ];\n    #endif\n    #ifdef USE_SPOT_LIGHT\n        uniform sampler2D glstate_spotShadowMap[ USE_SPOT_LIGHT ];\n        varying vec4 vSpotShadowCoord[ USE_SPOT_LIGHT ];\n    #endif\n    float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n        return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n    }\n    float textureCubeCompare( samplerCube depths, vec3 uv, float compare ) {\n        return step( compare, unpackRGBAToDepth( textureCube( depths, uv ) ) );\n    }\n    float getShadow( sampler2D shadowMap, vec4 shadowCoord, float shadowBias, float shadowRadius, vec2 shadowMapSize ) {\n        shadowCoord.xyz /= shadowCoord.w;\n        float depth = shadowCoord.z + shadowBias;\n        bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n        bool inFrustum = all( inFrustumVec );\n        bvec2 frustumTestVec = bvec2( inFrustum, depth <= 1.0 );\n        bool frustumTest = all( frustumTestVec );\n        if ( frustumTest ) {\n            #ifdef USE_PCF_SOFT_SHADOW\n                float texelSize = shadowRadius / shadowMapSize.x;\n                vec2 poissonDisk[4];\n                poissonDisk[0] = vec2(-0.94201624, -0.39906216);\n                poissonDisk[1] = vec2(0.94558609, -0.76890725);\n                poissonDisk[2] = vec2(-0.094184101, -0.92938870);\n                poissonDisk[3] = vec2(0.34495938, 0.29387760);\n                return texture2DCompare( shadowMap, shadowCoord.xy + poissonDisk[0] * texelSize, depth ) * 0.25 +\n                    texture2DCompare( shadowMap, shadowCoord.xy + poissonDisk[1] * texelSize, depth ) * 0.25 +\n                    texture2DCompare( shadowMap, shadowCoord.xy + poissonDisk[2] * texelSize, depth ) * 0.25 +\n                    texture2DCompare( shadowMap, shadowCoord.xy + poissonDisk[3] * texelSize, depth ) * 0.25;\n            #else\n                return texture2DCompare( shadowMap, shadowCoord.xy, depth );\n            #endif\n        }\n        return 1.0;\n    }\n    float getPointShadow( samplerCube shadowMap, vec3 V, float shadowBias, float shadowRadius, vec2 shadowMapSize, float shadowCameraNear, float shadowCameraFar ) {\n		float depth = ( length( V ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		depth += shadowBias;\n        V.x = -V.x;\n        #ifdef USE_PCF_SOFT_SHADOW\n            float texelSize = shadowRadius / shadowMapSize.x;\n            vec3 poissonDisk[4];\n    		poissonDisk[0] = vec3(-1.0, 1.0, -1.0);\n    		poissonDisk[1] = vec3(1.0, -1.0, -1.0);\n    		poissonDisk[2] = vec3(-1.0, -1.0, -1.0);\n    		poissonDisk[3] = vec3(1.0, -1.0, 1.0);\n            return textureCubeCompare( shadowMap, normalize(V) + poissonDisk[0] * texelSize, depth ) * 0.25 +\n                textureCubeCompare( shadowMap, normalize(V) + poissonDisk[1] * texelSize, depth ) * 0.25 +\n                textureCubeCompare( shadowMap, normalize(V) + poissonDisk[2] * texelSize, depth ) * 0.25 +\n                textureCubeCompare( shadowMap, normalize(V) + poissonDisk[3] * texelSize, depth ) * 0.25;\n        #else\n            return textureCubeCompare( shadowMap, normalize(V), depth);\n        #endif\n    }\n#endif",e.shadowMap_pars_vert="#ifdef USE_SHADOW\n    #ifdef USE_DIRECT_LIGHT\n        uniform mat4 glstate_directionalShadowMatrix[ USE_DIRECT_LIGHT ];\n        varying vec4 vDirectionalShadowCoord[ USE_DIRECT_LIGHT ];\n    #endif\n    #ifdef USE_POINT_LIGHT\n    #endif\n    #ifdef USE_SPOT_LIGHT\n        uniform mat4 glstate_spotShadowMatrix[ USE_SPOT_LIGHT ];\n        varying vec4 vSpotShadowCoord[ USE_SPOT_LIGHT ];\n    #endif\n#endif",e.shadowMap_vert="#ifdef USE_SHADOW\n    vec4 worldPosition = glstate_matrix_model * tmpvar_1;\n    #ifdef USE_DIRECT_LIGHT\n        for ( int i = 0; i < USE_DIRECT_LIGHT; i ++ ) {\n            vDirectionalShadowCoord[ i ] = glstate_directionalShadowMatrix[ i ] * worldPosition;\n        }\n    #endif\n    #ifdef USE_POINT_LIGHT\n    #endif\n    #ifdef USE_SPOT_LIGHT\n        for ( int i = 0; i < USE_SPOT_LIGHT; i ++ ) {\n            vSpotShadowCoord[ i ] = glstate_spotShadowMatrix[ i ] * worldPosition;\n        }\n    #endif\n#endif",e.tbn="mat3 tbn(vec3 N, vec3 p, vec2 uv) {\n    vec3 dp1 = dFdx(p.xyz);\n    vec3 dp2 = dFdy(p.xyz);\n    vec2 duv1 = dFdx(uv.st);\n    vec2 duv2 = dFdy(uv.st);\n    vec3 dp2perp = cross(dp2, N);\n    vec3 dp1perp = cross(N, dp1);\n    vec3 T = dp2perp * duv1.x + dp1perp * duv2.x;\n    vec3 B = dp2perp * duv1.y + dp1perp * duv2.y;\n    float invmax = 1.0 / sqrt(max(dot(T,T), dot(B,B)));\n    return mat3(T * invmax, B * invmax, N);\n}",e.transpose="mat4 transpose(mat4 inMatrix) {\n    vec4 i0 = inMatrix[0];\n    vec4 i1 = inMatrix[1];\n    vec4 i2 = inMatrix[2];\n    vec4 i3 = inMatrix[3];\n    mat4 outMatrix = mat4(\n        vec4(i0.x, i1.x, i2.x, i3.x),\n        vec4(i0.y, i1.y, i2.y, i3.y),\n        vec4(i0.z, i1.z, i2.z, i3.z),\n        vec4(i0.w, i1.w, i2.w, i3.w)\n    );\n    return outMatrix;\n}",e.tsn="mat3 tsn(vec3 N, vec3 V, vec2 uv) {\n    vec3 q0 = dFdx( V.xyz );\n    vec3 q1 = dFdy( V.xyz );\n    vec2 st0 = dFdx( uv.st );\n    vec2 st1 = dFdy( uv.st );\n    vec3 S = normalize( q0 * st1.t - q1 * st0.t );\n    vec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n    mat3 tsn = mat3( S, T, N );\n    return tsn;\n}"
}(t=e.ShaderChunk||(e.ShaderChunk={}))}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(){function t(){}return t.init=function(){if(!this._inited){this._inited=!0;var t=e.WebGLKit.webgl,r=new e.Texture("white");r.glTexture=e.GlTexture2D.staticTexture(t,"white"),r.url="white",this.WHITE=r;var a=new e.Texture("gray");a.glTexture=e.GlTexture2D.staticTexture(t,"gray"),a.url="gray",this.GRAY=a;var i=new e.Texture("grid");i.glTexture=e.GlTexture2D.staticTexture(t,"grid"),i.url="grid",this.GRID=i,paper.Asset.register(this.WHITE),paper.Asset.register(this.GRAY),paper.Asset.register(this.GRID)}},t._inited=!1,t}();e.DefaultTextures=t,__reflect(t.prototype,"egret3d.DefaultTextures")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(){function t(){}return t.Raycast=function(e,t,r,a){return void 0===t&&(t=!1),void 0===r&&(r=Number.MAX_VALUE),void 0===a&&(a=6),this._doPick(e,r,a,!1,t)},t.RaycastAll=function(e,t,r,a){return void 0===t&&(t=!1),void 0===r&&(r=Number.MAX_VALUE),void 0===a&&(a=6),this._doPick(e,r,a,!0,t)},t._doPick=function(e,t,r,a,i){void 0===t&&(t=Number.MAX_VALUE),void 0===a&&(a=!1),void 0===i&&(i=!1);for(var n=[],s=0,o=paper.Application.sceneManager.getActiveScene().getRootGameObjects();s<o.length;s++){var h=o[s];h.layer&r&&(i?this._pickMesh(e,h.transform,n):this._pickCollider(e,h.transform,n))}if(0===n.length)return null;if(a)return n;for(var l=0,c=1;c<n.length;c++)n[c].distance<n[l].distance&&(l=c);return n[l]},t._pickMesh=function(t,r,a){if(r.gameObject.activeInHierarchy){var i=r.gameObject.getComponent(e.MeshFilter);if(i){var n=i.mesh,s=n.intersects(t,r.getWorldMatrix());s&&(a.push(s),s.transform=r)}else{var o=r.gameObject.getComponent(e.SkinnedMeshRenderer);if(o){var s=o.intersects(t);s&&(a.push(s),s.pickedtran=r)}}}for(var h=0,l=r.children;h<l.length;h++){var c=l[h];this._pickMesh(t,c,a)}},t._pickCollider=function(e,t,r){if(t.gameObject.activeInHierarchy){var a=e.intersectCollider(t);a&&(r.push(a),a.transform=t)}for(var i=0,n=t.children;i<n.length;i++){var s=n[i];this._pickCollider(e,s,r)}},t}();e.Physics=t,__reflect(t.prototype,"egret3d.Physics")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(){function t(){this.subMeshIndex=-1,this.triangleIndex=-1,this.distance=0,this.position=new e.Vector3,this.textureCoordA=new e.Vector2,this.textureCoordB=new e.Vector2,this.transform=null,this.collider=null}return t}();e.PickInfo=t,__reflect(t.prototype,"egret3d.PickInfo")}(egret3d||(egret3d={}));var RES;!function(e){var t;!function(t){function r(e){for(var t=e.lastIndexOf("/"),r=e.substr(t+1),a=r.indexOf(".",0),i=null;a>=0;){if(i=r.substr(a),void 0!=c[i])return c[i];a=r.indexOf(".",a+1)}return l.Unknown}function a(e,t){void 0===t&&(t=!1);var r=e.lastIndexOf("/"),a=e.substr(r+1);return t&&(a=a.substring(0,a.indexOf("."))),a}function i(e){return e.substring(0,e.lastIndexOf("/"))}function n(t){return t.root?t.root+t.url:e.resourceRoot+t.url}function s(e,t,a){void 0===a&&(a="url");var i=[];return i=e.map(function(e){return{url:egret3d.utils.combinePath(t+"/",e[a]),type:r(e[a])}}),i.sort(function(e,t){return e.type-t.type}),i}function o(t,r){return __awaiter(this,void 0,void 0,function(){var a=this;return __generator(this,function(i){return[2,new Promise(function(i,n){var s=function(){var e=t.data?t.data:t.response;i(e)},o=function(){var t=new e.ResourceManagerError(1001,r.url);n(t)};t.addEventListener(egret.Event.COMPLETE,s,a),t.addEventListener(egret.IOErrorEvent.IO_ERROR,o,a)})]})})}function h(t,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){return[2,new Promise(function(a,i){var n=function(e){a(e)},s=function(){var t=new e.ResourceManagerError(1001,r.url);i(t)};egret3d.sound.WebAudio.instance.decodeAudioData(t,n,s)})]})})}var l;!function(e){e[e.Unknown=0]="Unknown",e[e.Auto=1]="Auto",e[e.Bundle=2]="Bundle",e[e.CompressBundle=3]="CompressBundle",e[e.GLVertexShader=4]="GLVertexShader",e[e.GLFragmentShader=5]="GLFragmentShader",e[e.Shader=6]="Shader",e[e.Texture=7]="Texture",e[e.TextureDesc=8]="TextureDesc",e[e.Material=9]="Material",e[e.GLTF=10]="GLTF",e[e.GLTFBinary=11]="GLTFBinary",e[e.Prefab=12]="Prefab",e[e.Scene=13]="Scene",e[e.TextAsset=14]="TextAsset",e[e.Atlas=15]="Atlas",e[e.Font=16]="Font",e[e.PackBin=17]="PackBin",e[e.PackTxt=18]="PackTxt",e[e.pathAsset=19]="pathAsset",e[e.PVR=20]="PVR",e[e.Sound=21]="Sound"}(l=t.AssetTypeEnum||(t.AssetTypeEnum={}));var c={".vs.glsl":l.GLVertexShader,".assetbundle.json":l.Bundle,".fs.glsl":l.GLFragmentShader,".shader.json":l.Shader,".png":l.Texture,".jpg":l.Texture,".pvr.bin":l.PVR,".pvr":l.PVR,".imgdesc.json":l.TextureDesc,".mat.json":l.Material,".gltf.json":l.GLTF,".gltf.bin":l.GLTFBinary,".prefab.json":l.Prefab,".scene.json":l.Scene,".atlas.json":l.Atlas,".font.json":l.Font,".json":l.TextAsset,".txt":l.TextAsset,".effect.json":l.TextAsset,".packs.bin":l.PackBin,".packs.txt":l.PackTxt,".path.json":l.pathAsset,".mp3":l.Sound,".ogg":l.Sound};t.BundleProcessor={onLoadStart:function(t,r){return __awaiter(this,void 0,void 0,function(){var o,h,l,c,u,p,d,f,_;return __generator(this,function(g){switch(g.label){case 0:return[4,t.load(r,e.processor.TextProcessor)];case 1:o=g.sent(),h=egret3d.WebGLKit.webgl,l=n(r),c=a(l),u=new egret3d.AssetBundle(c),u.url=l,u.$parse(JSON.parse(o)),p=s(u.assets,i(r.url)),d=0,g.label=2;case 2:return d<p.length?(f=e.host.resourceConfig.getResource(p[d].url),f?[4,t.load(f)]:[3,4]):[3,5];case 3:_=g.sent(),g.label=4;case 4:return d++,[3,2];case 5:return[2,u]}})})},onRemoveStart:function(e,t){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(a){return r=e.get(t),r.dispose(),[2]})})}},t.GLVertexShaderProcessor={onLoadStart:function(t,r){return __awaiter(this,void 0,void 0,function(){var i,s,o,h,l;return __generator(this,function(c){switch(c.label){case 0:return[4,t.load(r,e.processor.TextProcessor)];case 1:return i=c.sent(),s=egret3d.WebGLKit.webgl,o=n(r),h=a(o),l=h.substring(0,h.indexOf(".")),[2,egret3d.Shader.registerVertShader(l,i)]}})})},onRemoveStart:function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})}},t.GLFragmentShaderProcessor={onLoadStart:function(t,r){return __awaiter(this,void 0,void 0,function(){var i,s,o,h,l;return __generator(this,function(c){switch(c.label){case 0:return[4,t.load(r,e.processor.TextProcessor)];case 1:return i=c.sent(),s=egret3d.WebGLKit.webgl,o=n(r),h=a(o),l=h.substring(0,h.indexOf(".")),[2,egret3d.Shader.registerFragShader(l,i)]}})})},onRemoveStart:function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})}},t.ShaderProcessor={onLoadStart:function(t,r){return __awaiter(this,void 0,void 0,function(){var i,s,o,h,l,c;return __generator(this,function(u){switch(u.label){case 0:return[4,t.load(r,e.processor.TextProcessor)];case 1:return i=u.sent(),s=egret3d.WebGLKit.webgl,o=n(r),h=a(o),l=h.substring(0,h.indexOf(".")),c=new egret3d.Shader(h,o),c.$parse(JSON.parse(i)),paper.Asset.register(c),[2,c]}})})},onRemoveStart:function(e,t){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(a){return r=e.get(t),r.dispose(),paper.Asset.unregister(r),[2]})})}},t.D3PVRProcessor={onLoadStart:function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},onRemoveStart:function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})}},t.TextureDescProcessor={onLoadStart:function(t,r){return __awaiter(this,void 0,void 0,function(){var i,s,h,l,c,u,p,d,f,_,g,m,v,y,w,b,x,T,E;return __generator(this,function(A){switch(A.label){case 0:return[4,t.load(r,e.processor.TextProcessor)];case 1:return i=A.sent(),s=egret3d.WebGLKit.webgl,h=n(r),l=a(h),c=l.substring(0,l.indexOf(".")),u=JSON.parse(i),p=u.name,d=u.filterMode,f=u.format,_=u.mipmap,g=u.wrap,p.indexOf("LightmapFar")>=0&&console.log(""),m=1,"RGB"==f?m=2:"Gray"==f&&(m=3),v=!0,d.indexOf("linear")<0&&(v=!1),y=!1,g.indexOf("Repeat")>=0&&(y=!0),w=h.replace(l,p),b=new egret.ImageLoader,b.load(w),[4,o(b,r)];case 2:return x=A.sent(),T=new egret3d.Texture(l,h),T.realName=p,E=new egret3d.GlTexture2D(s,m),E.uploadImage(x.source,_,v,!0,y),T.glTexture=E,paper.Asset.register(T),[2,T]}})})},onRemoveStart:function(e,t){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(a){return r=e.get(t),r.dispose(),paper.Asset.unregister(r),[2]})})}},t.TextureProcessor={onLoadStart:function(e,t){return __awaiter(this,void 0,void 0,function(){var e,r,i,s,h,l,c,u,p;return __generator(this,function(d){switch(d.label){case 0:return e=egret3d.WebGLKit.webgl,r=n(t),i=a(r),s=i.substring(0,i.indexOf(".")),h=new egret.ImageLoader,h.load(r),[4,o(h,t)];case 1:return l=d.sent(),c=new egret3d.Texture(i,r),u=1,p=new egret3d.GlTexture2D(e,u),p.uploadImage(l.source,!0,!0,!0,!0),c.glTexture=p,paper.Asset.register(c),[2,c]}})})},onRemoveStart:function(e,t){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(a){return r=e.get(t),r.dispose(),paper.Asset.unregister(r),[2]})})}},t.MaterialProcessor={onLoadStart:function(t,r){return __awaiter(this,void 0,void 0,function(){var i,s,o,h,l,c;return __generator(this,function(u){switch(u.label){case 0:return[4,t.load(r,e.processor.TextProcessor)];case 1:return i=u.sent(),s=egret3d.WebGLKit.webgl,o=n(r),h=a(o),l=h.substring(0,h.indexOf(".")),c=new egret3d.Material(h,o),c.$parse(JSON.parse(i)),paper.Asset.register(c),[2,c]}})})},onRemoveStart:function(e,t){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(a){return r=e.get(t),r.dispose(),paper.Asset.unregister(r),[2]})})}},t.GLTFProcessor={onLoadStart:function(t,r){return __awaiter(this,void 0,void 0,function(){var s,o,h,l,c,u,p,d,f,_,g,m,v;return __generator(this,function(y){switch(y.label){case 0:return[4,t.load(r,"GLTF"===r.type?e.processor.JsonProcessor:e.processor.BinaryProcessor)];case 1:if(s=y.sent(),o=n(r),h=a(o,!0),l=new egret3d.GLTFAsset(h,o),"GLTF"!==r.type)return[3,6];if(c=s.buffers,u=[],!c)return[3,5];p=i(r.url),d=0,f=c,y.label=2;case 2:return d<f.length?(_=f[d],g=egret3d.utils.combinePath(p+"/",_.uri),m=e.host.resourceConfig.getResource(g),m?[4,t.load(m,e.processor.BinaryProcessor)]:[3,4]):[3,5];case 3:v=y.sent(),v?u.push(v):console.error("Load glTF resource error.",g),y.label=4;case 4:return d++,[3,2];case 5:return l.parse(s,u),[3,7];case 6:l.parseFromBinary(s),y.label=7;case 7:return paper.Asset.register(l),[2,l]}})})},onRemoveStart:function(e,t){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(a){return r=e.get(t),r.dispose(),paper.Asset.unregister(r),[2]})})}},t.AtlasProcessor={onLoadStart:function(t,r){return __awaiter(this,void 0,void 0,function(){var i,s,o,h,l,c;return __generator(this,function(u){switch(u.label){case 0:return[4,t.load(r,e.processor.TextProcessor)];case 1:return i=u.sent(),s=egret3d.WebGLKit.webgl,o=n(r),h=a(o),l=h.substring(0,h.indexOf(".")),c=new egret3d.Atlas(h,o),c.$parse(i),paper.Asset.register(c),[2,c]}})})},onRemoveStart:function(e,t){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(a){return r=e.get(t),r.dispose(),paper.Asset.unregister(r),[2]})})}},t.NewPrefabProcessor={onLoadStart:function(t,r){return __awaiter(this,void 0,void 0,function(){var o,h,c,u,p,d,f,_,g,m,v;return __generator(this,function(y){switch(y.label){case 0:return[4,t.load(r,e.processor.TextProcessor)];case 1:o=y.sent(),h=egret3d.WebGLKit.webgl,c=n(r),u=a(c),p=u.substring(0,u.indexOf(".")),d=JSON.parse(o).assets,f=s(d,i(r.url)),_=0,y.label=2;case 2:return _<f.length?f[_].type==l.Shader?[3,4]:(g=e.host.resourceConfig.getResource(f[_].url),g?[4,t.load(g)]:[3,4]):[3,5];case 3:m=y.sent(),y.label=4;case 4:return _++,[3,2];case 5:return v=new egret3d.Prefab(u,c),v.$parse(o),paper.Asset.register(v),[2,v]}})})},onRemoveStart:function(e,t){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(a){return r=e.get(t),r.dispose(),paper.Asset.unregister(r),[2]})})}},t.NewSceneProcessor={onLoadStart:function(t,r){return __awaiter(this,void 0,void 0,function(){var o,h,c,u,p,d,f,_,g,m,v;return __generator(this,function(y){switch(y.label){case 0:return[4,t.load(r,e.processor.TextProcessor)];case 1:o=y.sent(),h=egret3d.WebGLKit.webgl,c=n(r),u=a(c),p=u.substring(0,u.indexOf(".")),d=JSON.parse(o).assets,f=s(d,i(r.url)),_=0,y.label=2;case 2:return _<f.length?f[_].type==l.Shader?[3,4]:(g=e.host.resourceConfig.getResource(f[_].url),g?[4,t.load(g)]:[3,4]):[3,5];case 3:m=y.sent(),y.label=4;case 4:return _++,[3,2];case 5:return v=new egret3d.RawScene(u,c),v.$parse(o),paper.Asset.register(v),[2,v]}})})},onRemoveStart:function(e,t){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(a){return r=e.get(t),r.dispose(),paper.Asset.unregister(r),[2]})})}},t.D3FontProcessor={onLoadStart:function(t,r){return __awaiter(this,void 0,void 0,function(){var i,s,o,h,l,c;return __generator(this,function(u){switch(u.label){case 0:return[4,t.load(r,e.processor.TextProcessor)];case 1:return i=u.sent(),s=egret3d.WebGLKit.webgl,o=n(r),h=a(o),l=h.substring(0,h.indexOf(".")),c=new egret3d.Font(h,o),c.$parse(i),paper.Asset.register(c),[2,c]}})})},onRemoveStart:function(e,t){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(a){return r=e.get(t),r.dispose(),paper.Asset.unregister(r),[2]})})}},t.Sound3DProcessor={onLoadStart:function(t,r){return __awaiter(this,void 0,void 0,function(){var i,s,o,l,c,u,p;return __generator(this,function(d){switch(d.label){case 0:return[4,t.load(r,e.processor.BinaryProcessor)];case 1:return i=d.sent(),s=egret3d.WebGLKit.webgl,o=n(r),l=a(o),c=l.substring(0,l.indexOf(".")),[4,h(i,r)];case 2:return u=d.sent(),p=new egret3d.Sound(l,o),p.buffer=u,paper.Asset.register(p),[2,p]}})})},onRemoveStart:function(e,t){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(a){return r=e.get(t),r.dispose(),paper.Asset.unregister(r),[2]})})}},t.TextAssetProcessor={onLoadStart:function(t,r){return __awaiter(this,void 0,void 0,function(){var i,s,o,h,l,c;return __generator(this,function(u){switch(u.label){case 0:return[4,t.load(r,e.processor.TextProcessor)];case 1:return i=u.sent(),s=egret3d.WebGLKit.webgl,o=n(r),h=a(o),l=h.substring(0,h.indexOf(".")),c=new egret3d.TextAsset(h,o),c.content=i,paper.Asset.register(c),[2,c]}})})},onRemoveStart:function(e,t){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(a){return r=e.get(t),r.dispose(),paper.Asset.unregister(r),[2]})})}},t.PathAssetProcessor={onLoadStart:function(t,r){return __awaiter(this,void 0,void 0,function(){var i,s,o,h,l,c;return __generator(this,function(u){switch(u.label){case 0:return[4,t.load(r,e.processor.TextProcessor)];case 1:return i=u.sent(),s=egret3d.WebGLKit.webgl,o=n(r),h=a(o),l=h.substring(0,h.indexOf(".")),c=new egret3d.PathAsset(h,o),c.$parse(JSON.parse(i)),paper.Asset.register(c),[2,c]}})})},onRemoveStart:function(e,t){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(a){return r=e.get(t),r.dispose(),paper.Asset.unregister(r),[2]})})}},e.processor.map("GLVertexShader",t.GLVertexShaderProcessor),e.processor.map("GLFragmentShader",t.GLFragmentShaderProcessor),e.processor.map("Shader",t.ShaderProcessor),e.processor.map("Bundle",t.BundleProcessor),e.processor.map("Texture",t.TextureProcessor),e.processor.map("TextureDesc",t.TextureDescProcessor),e.processor.map("PVR",t.D3PVRProcessor),e.processor.map("Material",t.MaterialProcessor),e.processor.map("GLTF",t.GLTFProcessor),e.processor.map("GLTFBinary",t.GLTFProcessor),e.processor.map("Prefab",t.NewPrefabProcessor),e.processor.map("Scene",t.NewSceneProcessor),e.processor.map("Atlas",t.AtlasProcessor),e.processor.map("Font",t.D3FontProcessor),e.processor.map("TextAsset",t.TextAssetProcessor),e.processor.map("pathAsset",t.PathAssetProcessor),e.processor.map("Sound",t.Sound3DProcessor)}(t=e.processor||(e.processor={}))}(RES||(RES={}));var egret3d;!function(e){var t=function(){function t(){}return t.init=function(){if(!this._inited){this._inited=!0;var t=e.Shader.registerVertShader("def_code",e.ShaderLib.code_vert),r=(e.Shader.registerFragShader("def_code",e.ShaderLib.code_frag),e.Shader.registerFragShader("def_code2",e.ShaderLib.code2_frag),e.Shader.registerFragShader("def_ui",e.ShaderLib.ui_frag)),a=e.Shader.registerVertShader("def_uifont",e.ShaderLib.uifont_vert),i=e.Shader.registerFragShader("def_uifont",e.ShaderLib.uifont_frag),n=e.Shader.registerVertShader("def_diffuse",e.ShaderLib.diffuse_vert),s=e.Shader.registerFragShader("def_diffuse",e.ShaderLib.diffuse_frag),o=e.Shader.registerVertShader("def_boneeff",e.ShaderLib.boneeff_vert),h=e.Shader.registerVertShader("def_diffuselightmap",e.ShaderLib.diffuselightmap_vert),l=e.Shader.registerFragShader("def_diffuselightmap",e.ShaderLib.diffuselightmap_frag),c=e.Shader.registerVertShader("def_postquad",e.ShaderLib.postquad_vert),u=e.Shader.registerFragShader("def_postquaddepth",e.ShaderLib.postquaddepth_frag),p=e.Shader.registerVertShader("def_postdepth",e.ShaderLib.postdepth_vert),d=e.Shader.registerFragShader("def_postdepth",e.ShaderLib.postdepth_frag),f=e.Shader.registerVertShader("def_line",e.ShaderLib.line_vert),_=e.Shader.registerFragShader("def_line",e.ShaderLib.line_frag),g=e.Shader.registerVertShader("def_materialcolor",e.ShaderLib.materialcolor_vert),m=e.Shader.registerFragShader("def_diffusetintcolor",e.ShaderLib.tintcolor_frag),v=e.Shader.registerVertShader("def_diffusevertcolor",e.ShaderLib.vertcolor_vert),y=e.Shader.registerFragShader("def_diffusevertcolor",e.ShaderLib.vertcolor_frag),w=e.Shader.registerVertShader("def_lambert",e.ShaderLib.lambert_vert),b=e.Shader.registerFragShader("def_lambert",e.ShaderLib.lambert_frag),x=e.Shader.registerVertShader("def_lambertnormal","#define USE_NORMAL_MAP \n"+e.ShaderLib.lambert_vert),T=e.Shader.registerFragShader("def_lambertnormal","#define USE_NORMAL_MAP \n"+e.ShaderLib.lambert_frag),E=e.Shader.registerVertShader("def_depthpackage",e.ShaderLib.depthpackage_vert),A=e.Shader.registerFragShader("def_depthpackage",e.ShaderLib.depthpackage_frag),D=e.Shader.registerVertShader("def_depthpackage",e.ShaderLib.distancepackage_vert),S=e.Shader.registerFragShader("def_depthpackage",e.ShaderLib.distancepackage_frag),C=new e.Shader("shader/lambert");C.url="shader/lambert",C.renderQueue=e.RenderQueue.Geometry,C.defaultValue._MainTex={type:"Texture",value:paper.Asset.find("gray")},C.defaultValue._Color={type:"Vector4",value:new e.Vector4(1,1,1,1)},C.passes.base=[];var M=new e.DrawPass(w,b);M.state_ztest=!0,M.state_ztest_method=e.WebGLKit.LEQUAL,M.state_zwrite=!0,M.state_showface=e.ShowFaceStateEnum.CCW,M.setAlphaBlend(e.BlendModeEnum.Close),C.passes.base.push(M),C.passes.base_depth_package=[];var R=new e.DrawPass(E,A);R.state_ztest=!0,R.state_ztest_method=e.WebGLKit.LEQUAL,R.state_zwrite=!0,R.state_showface=e.ShowFaceStateEnum.CCW,R.setAlphaBlend(e.BlendModeEnum.Close),C.passes.base_depth_package.push(R),C.passes.base_distance_package=[];var L=new e.DrawPass(D,S);L.state_ztest=!0,L.state_ztest_method=e.WebGLKit.LEQUAL,L.state_zwrite=!0,L.state_showface=e.ShowFaceStateEnum.CCW,L.setAlphaBlend(e.BlendModeEnum.Close),C.passes.base_distance_package.push(L),this.LAMBERT=C,paper.Asset.register(C);var C=new e.Shader("shader/lambertnormal");C.url="shader/lambertnormal",C.renderQueue=e.RenderQueue.Geometry,C.defaultValue._MainTex={type:"Texture",value:paper.Asset.find("gray")},C.defaultValue._Color={type:"Vector4",value:new e.Vector4(1,1,1,1)},C.passes.base=[];var M=new e.DrawPass(x,T);M.state_ztest=!0,M.state_ztest_method=e.WebGLKit.LEQUAL,M.state_zwrite=!0,M.state_showface=e.ShowFaceStateEnum.CCW,M.setAlphaBlend(e.BlendModeEnum.Close),C.passes.base.push(M),C.passes.base_depth_package=[];var R=new e.DrawPass(E,A);R.state_ztest=!0,R.state_ztest_method=e.WebGLKit.LEQUAL,R.state_zwrite=!0,R.state_showface=e.ShowFaceStateEnum.CCW,R.setAlphaBlend(e.BlendModeEnum.Close),C.passes.base_depth_package.push(R),C.passes.base_distance_package=[];var L=new e.DrawPass(D,S);L.state_ztest=!0,L.state_ztest_method=e.WebGLKit.LEQUAL,L.state_zwrite=!0,L.state_showface=e.ShowFaceStateEnum.CCW,L.setAlphaBlend(e.BlendModeEnum.Close),C.passes.base_distance_package.push(L),this.LAMBERT_NORMAL=C,paper.Asset.register(C);var O=new e.Shader("shader/def");O.url="shader/def",O.renderQueue=e.RenderQueue.Geometry,O.passes.base=[],O.defaultValue._MainTex={type:"Texture",value:paper.Asset.find("grid")},O.defaultValue._MainTex_ST={type:"Vector4",value:new e.Vector4(1,1,0,0)},O.defaultValue._AlphaCut={type:"Range",value:.1,min:0,max:1};var P=new e.DrawPass(n,s);O.passes.base.push(P),P.state_ztest=!0,P.state_ztest_method=e.WebGLKit.LEQUAL,P.state_zwrite=!0,P.state_showface=e.ShowFaceStateEnum.CCW,P.setAlphaBlend(e.BlendModeEnum.Close),paper.Asset.register(O);var O=new e.Shader("transparent.shader.json");O.url="transparent.shader.json",O.renderQueue=e.RenderQueue.Transparent,O.passes.base=[],O.defaultValue._MainTex={type:"Texture",value:paper.Asset.find("grid")},O.defaultValue._MainTex_ST={type:"Vector4",value:new e.Vector4(1,1,0,0)},O.defaultValue._AlphaCut={type:"Range",value:.1,min:0,max:1};var P=new e.DrawPass(n,s);O.passes.base.push(P),P.state_ztest=!0,P.state_ztest_method=e.WebGLKit.LEQUAL,P.state_zwrite=!0,P.state_showface=e.ShowFaceStateEnum.CCW,P.setAlphaBlend(e.BlendModeEnum.Blend),this.TRANSPARENT=O,paper.Asset.register(O);var O=new e.Shader("transparent_additive.shader.json");O.url="transparent_additive.shader.json",O.renderQueue=e.RenderQueue.Transparent,O.passes.base=[],O.defaultValue._MainTex={type:"Texture",value:paper.Asset.find("grid")},O.defaultValue._MainTex_ST={type:"Vector4",value:new e.Vector4(1,1,0,0)},O.defaultValue._AlphaCut={type:"Range",value:.1,min:0,max:1};var P=new e.DrawPass(n,s);O.passes.base.push(P),P.state_ztest=!0,P.state_ztest_method=e.WebGLKit.LEQUAL,P.state_zwrite=!0,P.state_showface=e.ShowFaceStateEnum.CCW,P.setAlphaBlend(e.BlendModeEnum.Add),this.TRANSPARENT_ADDITIVE=O,paper.Asset.register(O);var O=new e.Shader("transparent_additive_bothside.shader.json");O.url="transparent_additive_bothside.shader.json",O.renderQueue=e.RenderQueue.Transparent,O.passes.base=[],O.defaultValue._MainTex={type:"Texture",value:paper.Asset.find("grid")},O.defaultValue._MainTex_ST={type:"Vector4",value:new e.Vector4(1,1,0,0)},O.defaultValue._AlphaCut={type:"Range",value:.1,min:0,max:1};var P=new e.DrawPass(n,s);O.passes.base.push(P),P.state_ztest=!0,P.state_ztest_method=e.WebGLKit.LEQUAL,P.state_zwrite=!0,P.state_showface=e.ShowFaceStateEnum.ALL,P.setAlphaBlend(e.BlendModeEnum.Add),this.TRANSPARENT_ADDITIVE_BOTH_SIDE=O,paper.Asset.register(O);var O=new e.Shader("transparent_bothside.shader.json");O.url="transparent_bothside.shader.json",O.renderQueue=e.RenderQueue.Transparent,O.passes.base=[],O.defaultValue._MainTex={type:"Texture",value:paper.Asset.find("grid")},O.defaultValue._MainTex_ST={type:"Vector4",value:new e.Vector4(1,1,0,0)},O.defaultValue._AlphaCut={type:"Range",value:.1,min:0,max:1};var P=new e.DrawPass(n,s);O.passes.base.push(P),P.state_ztest=!0,P.state_ztest_method=e.WebGLKit.LEQUAL,P.state_zwrite=!0,P.state_showface=e.ShowFaceStateEnum.ALL,P.setAlphaBlend(e.BlendModeEnum.Blend),this.TRANSPARENT_BOTH_SIDE=O,paper.Asset.register(O);var O=new e.Shader("diffuse.shader.json");O.url="diffuse.shader.json",O.renderQueue=e.RenderQueue.Geometry,O.defaultValue._MainTex={type:"Texture",value:paper.Asset.find("gray")},O.defaultValue._MainTex_ST={type:"Vector4",value:new e.Vector4(1,1,0,0)},O.defaultValue._AlphaCut={type:"Range",value:.1,min:0,max:1};var P=new e.DrawPass(n,s);O.passes.base=[],O.passes.base.push(P),P.state_ztest=!0,P.state_ztest_method=e.WebGLKit.LEQUAL,P.state_zwrite=!0,P.state_showface=e.ShowFaceStateEnum.CCW,P.setAlphaBlend(e.BlendModeEnum.Close);var z=new e.DrawPass(o,s);O.passes.skin=[],O.passes.skin.push(z),z.state_ztest=!0,z.state_ztest_method=e.WebGLKit.LEQUAL,z.state_zwrite=!0,z.state_showface=e.ShowFaceStateEnum.CCW,z.setAlphaBlend(e.BlendModeEnum.Close);var V=new e.DrawPass(h,l);O.passes.lightmap=[],O.passes.lightmap.push(V),V.state_ztest=!0,V.state_ztest_method=e.WebGLKit.LEQUAL,V.state_zwrite=!0,V.state_showface=e.ShowFaceStateEnum.CCW,V.setAlphaBlend(e.BlendModeEnum.Close);var F=new e.DrawPass(c,u);O.passes.quad=[],O.passes.quad.push(F),F.state_ztest=!0,F.state_ztest_method=e.WebGLKit.LEQUAL,F.state_zwrite=!0,F.state_showface=e.ShowFaceStateEnum.CCW,F.setAlphaBlend(e.BlendModeEnum.Close);var B=new e.DrawPass(p,d);O.passes.base_depth=[],O.passes.base_depth.push(B),B.state_ztest=!0,B.state_ztest_method=e.WebGLKit.LEQUAL,B.state_zwrite=!0,B.state_showface=e.ShowFaceStateEnum.CCW,B.setAlphaBlend(e.BlendModeEnum.Close);var I=new e.DrawPass(E,A);O.passes.base_depth_package=[],O.passes.base_depth_package.push(I),I.state_ztest=!1,I.state_ztest_method=e.WebGLKit.LEQUAL,I.state_zwrite=!1,I.state_showface=e.ShowFaceStateEnum.CCW,I.setAlphaBlend(e.BlendModeEnum.Close),this.DIFFUSE=O,paper.Asset.register(O);var O=new e.Shader("shader/diffuse_tintcolor");O.url="shader/diffuse_tintcolor",O.renderQueue=e.RenderQueue.Geometry,O.passes.base=[],O.defaultValue._MainTex={type:"Texture",value:paper.Asset.find("grid")},O.defaultValue._MainTex_ST={type:"Vector4",value:new e.Vector4(1,1,0,0)},O.defaultValue._AlphaCut={type:"Range",value:.1,min:0,max:1},O.defaultValue._TintColor={type:"Vector4",value:new e.Vector4(1,1,1,1)};var P=new e.DrawPass(n,m);O.passes.base.push(P),P.state_ztest=!0,P.state_ztest_method=e.WebGLKit.LEQUAL,P.state_zwrite=!0,P.state_showface=e.ShowFaceStateEnum.CCW,P.setAlphaBlend(e.BlendModeEnum.Close),this.DIFFUSE_TINT_COLOR=O,paper.Asset.register(O);var O=new e.Shader("shader/diffuse_vertcolor");O.url="shader/diffuse_vertcolor",O.renderQueue=e.RenderQueue.Geometry,O.passes.base=[],O.defaultValue._MainTex={type:"Texture",value:paper.Asset.find("grid")},O.defaultValue._MainTex_ST={type:"Vector4",value:new e.Vector4(1,1,0,0)},O.defaultValue._AlphaCut={type:"Range",value:.1,min:0,max:1};var P=new e.DrawPass(v,y);O.passes.base.push(P),P.state_ztest=!0,P.state_ztest_method=e.WebGLKit.LEQUAL,P.state_zwrite=!0,P.state_showface=e.ShowFaceStateEnum.CCW,P.setAlphaBlend(e.BlendModeEnum.Close),this.DIFFUSE_VERT_COLOR=O,paper.Asset.register(O);var O=new e.Shader("diffuse_bothside.shader.json");O.url="diffuse_bothside.shader.json",O.renderQueue=e.RenderQueue.Geometry,O.defaultValue._MainTex={type:"Texture",value:paper.Asset.find("grid")},O.defaultValue._MainTex_ST={type:"Vector4",value:new e.Vector4(1,1,0,0)},O.defaultValue._AlphaCut={type:"Range",value:.1,min:0,max:1};var P=new e.DrawPass(n,s);O.passes.base=[],O.passes.base.push(P),P.state_ztest=!0,P.state_ztest_method=e.WebGLKit.LEQUAL,P.state_zwrite=!0,P.state_showface=e.ShowFaceStateEnum.ALL,P.setAlphaBlend(e.BlendModeEnum.Close);var z=new e.DrawPass(o,s);O.passes.skin=[],O.passes.skin.push(z),z.state_ztest=!0,z.state_ztest_method=e.WebGLKit.LEQUAL,z.state_zwrite=!0,z.state_showface=e.ShowFaceStateEnum.CCW,z.setAlphaBlend(e.BlendModeEnum.Close);var V=new e.DrawPass(h,l);O.passes.lightmap=[],O.passes.lightmap.push(V),V.state_ztest=!0,V.state_ztest_method=e.WebGLKit.LEQUAL,V.state_zwrite=!0,V.state_showface=e.ShowFaceStateEnum.CCW,V.setAlphaBlend(e.BlendModeEnum.Close);var F=new e.DrawPass(c,u);O.passes.quad=[],O.passes.quad.push(F),F.state_ztest=!0,F.state_ztest_method=e.WebGLKit.LEQUAL,F.state_zwrite=!0,F.state_showface=e.ShowFaceStateEnum.CCW,F.setAlphaBlend(e.BlendModeEnum.Close);var B=new e.DrawPass(p,d);O.passes.base_depth=[],O.passes.base_depth.push(B),B.state_ztest=!0,B.state_ztest_method=e.WebGLKit.LEQUAL,B.state_zwrite=!0,B.state_showface=e.ShowFaceStateEnum.CCW,B.setAlphaBlend(e.BlendModeEnum.Close),this.DIFFUSE_BOTH_SIDE=O,paper.Asset.register(O);var O=new e.Shader("shader/defui");O.url="shader/defui",O.passes.base=[];var P=new e.DrawPass(t,r);O.passes.base.push(P),P.state_showface=e.ShowFaceStateEnum.CW,P.state_ztest=!1,P.state_zwrite=!1,P.state_ztest_method=e.WebGLKit.LEQUAL,P.setAlphaBlend(e.BlendModeEnum.Blend_PreMultiply);var z=new e.DrawPass(t,r);O.passes.base.push(z),z.state_showface=e.ShowFaceStateEnum.ALL,z.state_ztest=!0,z.state_zwrite=!1,z.state_ztest_method=e.WebGLKit.LEQUAL,z.setAlphaBlend(e.BlendModeEnum.Blend_PreMultiply),this.UI=O,paper.Asset.register(O);var O=new e.Shader("shader/defuifont");O.url="shader/defuifont",O.passes.base=[];var P=new e.DrawPass(a,i);O.passes.base.push(P),P.state_showface=e.ShowFaceStateEnum.CW,P.state_ztest=!1,P.state_zwrite=!1,P.state_ztest_method=e.WebGLKit.LEQUAL,P.setAlphaBlend(e.BlendModeEnum.Blend_PreMultiply);var z=new e.DrawPass(a,i);O.passes.base.push(z),z.state_showface=e.ShowFaceStateEnum.ALL,z.state_ztest=!0,z.state_zwrite=!1,z.state_ztest_method=e.WebGLKit.LEQUAL,z.setAlphaBlend(e.BlendModeEnum.Blend_PreMultiply),this.UI_FONT=O,paper.Asset.register(O);var O=new e.Shader("line.shader.json");O.url="line.shader.json",O.renderQueue=e.RenderQueue.Geometry,O.passes.base=[];var P=new e.DrawPass(f,_);O.passes.base.push(P),P.state_ztest=!0,P.state_ztest_method=e.WebGLKit.LEQUAL,P.state_zwrite=!0,P.state_showface=e.ShowFaceStateEnum.ALL,P.setAlphaBlend(e.BlendModeEnum.Close),this.LINE=O,paper.Asset.register(O);var O=new e.Shader("materialcolor.shader.json");O.url="materialcolor.shader.json",O.renderQueue=e.RenderQueue.Geometry,O.defaultValue._Color={type:"Vector4",value:new e.Vector4(1,1,1,1)},O.passes.base=[];var P=new e.DrawPass(g,_);O.passes.base.push(P),P.state_ztest=!0,P.state_ztest_method=e.WebGLKit.LEQUAL,P.state_zwrite=!0,P.state_showface=e.ShowFaceStateEnum.ALL,P.setAlphaBlend(e.BlendModeEnum.Close),O.renderQueue=e.RenderQueue.Overlay,this.MATERIAL_COLOR=O,paper.Asset.register(O);var O=new e.Shader("gizmos.shader.json");O.url="gizmos.shader.json",O.renderQueue=e.RenderQueue.Overlay,O.defaultValue._Color={type:"Vector4",value:new e.Vector4(1,1,1,1)},O.passes.base=[];var P=new e.DrawPass(g,_);O.passes.base.push(P),P.state_ztest=!1,P.state_ztest_method=e.WebGLKit.LEQUAL,P.state_zwrite=!1,P.state_showface=e.ShowFaceStateEnum.CCW,P.setAlphaBlend(e.BlendModeEnum.Blend),O.renderQueue=e.RenderQueue.Overlay,this.GIZMOS_COLOR=O,paper.Asset.register(O)}},t._inited=!1,t}();e.DefaultShaders=t,__reflect(t.prototype,"egret3d.DefaultShaders")}(egret3d||(egret3d={}));var egret3d;!function(e){var t={vbo:new Float32Array([-5,0,5,-5,0,-5,5,0,5,5,0,-5,0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,0,1,1]),ibo:new Uint16Array([0,1,2,2,1,3])},r={vbo:new Float32Array([-.5,-.5,-.5,-.5,-.5,.5,.5,-.5,-.5,.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5,.5,.5,.5,.5,.5,-.5,-.5,-.5,.5,-.5,.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,.5,.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,.5,.5,-.5,.5,.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,.5,-.5,.5,-.5,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,-1,0,0,1,-1,0,0,1,-1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,-1,0,0,1,-1,0,0,1,-1,0,0,1,-1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,-1,1,0,0,-1,1,0,0,-1,1,0,0,-1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,0,1,1,0,0,0,1,1,0,1,1,1,1,1,0,0,1,0,0,0,0,0,1,1,0,1,1,0,1,1,1,0,0,1,0,0,1,1,1,0,0,1,0]),ibo:new Uint16Array([0,1,2,2,1,3,4,5,6,6,5,7,8,9,10,10,9,11,12,13,14,14,13,15,16,17,18,18,17,19,20,21,22,22,21,23])},a={vbo:new Float32Array([-.5,.5,0,-.5,-.5,0,.5,.5,0,.5,-.5,0,0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,0,1,1]),ibo:new Uint16Array([0,1,2,2,1,3])},i={vbo:new Float32Array([0,.5,0,0,-.5,0,1,.5,0,1,-.5,0,0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,0,1,1]),ibo:new Uint16Array([0,1,2,2,1,3])},n={vbo:new Float32Array([-.5,.5,0,-.5,-.5,0,.5,.5,0,.5,-.5,0,0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,0,1,1]),ibo:new Uint16Array([0,1,2,2,1,3])},s={vbo:new Float32Array([-.5,-1,-.5,0,1,0,.5,-1,-.5,.5,-1,-.5,0,1,0,.5,-1,.5,.5,-1,.5,0,1,0,-.5,-1,.5,-.5,-1,.5,0,1,0,-.5,-1,-.5,-.5,-1,-.5,.5,-1,-.5,.5,-1,.5,-.5,-1,.5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,.5,.5,0,1,0,1,.5,.5,1,1,1,1,.5,.5,1,0,1,0,.5,.5,0,0,0,0,1,0,1,1,0,1]),ibo:new Uint16Array([0,2,1,3,5,4,6,8,7,9,11,10,12,14,13,15,14,12])},o={ibo:new Uint16Array([0,1,2,2,1,3,4,5,6,6,5,7,1,3,5,5,3,7,0,2,4,4,2,6,6,2,7,7,2,3,0,4,1,1,4,5])},h=["POSITION","NORMAL","TANGENT","COLOR_0","TEXCOORD_0"],l=["POSITION","NORMAL","TEXCOORD_0"],c=["POSITION"],u=function(){function u(){}return u.init=function(){this._inited||(this._inited=!0,this.QUAD=this._createDefaultMeshA(n),this.QUAD_PARTICLE=this._createDefaultMeshA(i),this.PLANE=this._createDefaultMeshA(t),this.CIRCLE_LINE=this._createDefaultMeshA(a),this.CUBE=this._createDefaultMeshA(r),this.PYRAMID=this._createDefaultMeshA(s),this.CYLINDER=this.createCylinderCCW(2,.5),this.SPHERE=this.createSphereCCW())
},u._createDefaultMeshA=function(t){var r=new e.Mesh(t.vbo,t.ibo,h);return r},u.genBoxByArray=function(t){for(var r=8,a=new e.Mesh(r,o.ibo,c),i=0;r>i;++i){var n=t[i];a.setVertexAttribute(i,"POSITION",0,n.x,n.y,n.z)}return a.uploadSubVertexBuffer(c),a},u.createCylinderCCW=function(t,r,a){void 0===a&&(a=20);for(var i=0,n=new e.Mesh(4*a+2,12*a,l),s=new e.Vector3(0,1,0),o=n.getIndices(),h=0;4>h;h++){var c=(2>h?.5:-.5)*t;3===h&&(s.x=0,s.y=-1,s.z=0);for(var u=0;a>u;u++){var p=u/a*Math.PI*2,d=Math.sin(p),f=Math.cos(p);(1===h||2===h)&&(s.x=d,s.y=0,s.z=f),n.setVertexAttribute(i,"POSITION",0,d*r,c,f*r),0===h||3===h?n.setVertexAttribute(i,"TEXCOORD_0",0,.5*d+.5,.5*f+.5):n.setVertexAttribute(i,"TEXCOORD_0",0,u/a,0>c?0:1),i++}}n.setVertexAttribute(i,"POSITION",0,0,.5*t,0),n.setVertexAttribute(i,"TEXCOORD_0",0,.5,.5),i++,n.setVertexAttribute(i,"POSITION",0,0,-.5*t,0),n.setVertexAttribute(i,"TEXCOORD_0",0,.5,.5),i++,i=0;for(var _=4*a,g=4*a+1,u=0;a>u;u++){o[i++]=_,o[i++]=u===a-1?0*a+0:0*a+u+1,o[i++]=0*a+u+0,o[i++]=g,o[i++]=3*a+u+0,o[i++]=u===a-1?3*a+0:3*a+u+1;var m=1*a+u,v=u===a-1?1*a+0:1*a+u+1,y=2*a+u,w=u===a-1?2*a+0:2*a+u+1;o[i++]=m,o[i++]=v,o[i++]=y,o[i++]=v,o[i++]=w,o[i++]=y}return n.uploadSubVertexBuffer(l),n.uploadSubIndexBuffer(),n},u.createSphereCCW=function(t,r,a){void 0===t&&(t=1),void 0===r&&(r=24),void 0===a&&(a=12),r=Math.max(3,Math.floor(r)),a=Math.max(2,Math.floor(a));for(var i=new e.Mesh((r+1)*(a+1),r*a*6-6,l),n=0,s=0,o=new e.Vector3,h=new e.Vector3,c=new Array,u=0;a>=u;u++){for(var p=new Array,d=u/a,f=0;r>=f;f++){var _=f/r;o.x=-t*Math.cos(_*Math.PI*2)*Math.sin(d*Math.PI),o.y=t*Math.cos(d*Math.PI),o.z=t*Math.sin(_*Math.PI*2)*Math.sin(d*Math.PI),i.setVertexAttribute(s,"POSITION",0,o.x,o.y,o.z),h.x=o.x,h.y=o.y,h.z=o.z;var g=Math.sqrt(h.x*h.x+h.y*h.y+h.z*h.z);g>Number.MIN_VALUE?i.setVertexAttribute(s,"NORMAL",0,h.x/g,h.y/g,h.z/g):i.setVertexAttribute(s,"NORMAL",0,0,0,0),i.setVertexAttribute(s,"TEXCOORD_0",0,1-_,d),s++,p.push(n++)}c.push(p)}for(var m=new Array,u=0;a>u;u++)for(var f=0;r>f;f++){var v=c[u][f+1],y=c[u][f],w=c[u+1][f],b=c[u+1][f+1];0!==u&&m.push(v,b,y),u!==a-1&&m.push(y,b,w)}for(var x=i.getIndices(),T=0,E=m.length;E>T;T++)x[T]=m[T];return i.uploadSubVertexBuffer(l),i.uploadSubIndexBuffer(),i},u._inited=!1,u}();e.DefaultMeshes=u,__reflect(u.prototype,"egret3d.DefaultMeshes")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(){function e(){}return e.textureRegexp=/([_0-9a-zA-Z]+)[ ]*\([ ]*'(.+)'[ ]*,[ ]*([0-9a-zA-Z]+)[ ]*\)[ ]*=[ ]*'(.+)'[ ]*\{[ ]*([a-zA-Z]*)[ ]*([a-zA-Z]*)[ ]*\}/,e.vectorRegexp=/([_0-9a-zA-Z]+)[ ]*\([ ]*'(.+)'[ ]*,[ ]*([0-9a-zA-Z]+)[ ]*\)[ ]*=[ ]*\([ ]*([0-9.-]+)[ ]*,[ ]*([0-9.-]+)[ ]*,[ ]*([0-9.-]+)[ ]*,[ ]*([0-9.-]+)[ ]*\)/,e.floatRegexp=/([_0-9a-zA-Z]+)[ ]*\([ ]*'(.+)'[ ]*,[ ]*([0-9a-zA-Z]+)[ ]*\)[ ]*=[ ]*([0-9.-]+)/,e.rangeRegexp=/([_0-9a-zA-Z]+)[ ]*\([ ]*'(.+)'[ ]*,[ ]*([0-9a-zA-Z]+)[ ]*\([ ]*([0-9.-]+)[ ]*,[ ]*([0-9.-]+)[ ]*\)[ ]*\)[ ]*=[ ]*([0-9.-]+)/,e.vector4Regexp=/\([ ]*([0-9.-]+)[ ]*,[ ]*([0-9.-]+)[ ]*,[ ]*([0-9.-]+)[ ]*,[ ]*([0-9.-]+)[ ]*\)/,e.vector3FloatOrRangeRegexp=/([0-9.-]+|\[[0-9.-]+,[0-9.-]+\]),([0-9.-]+|\[[0-9.-]+,[0-9.-]+\]),([0-9.-]+|\[[0-9.-]+,[0-9.-]+\])/,e}();e.RegexpUtil=t,__reflect(t.prototype,"egret3d.RegexpUtil")}(egret3d||(egret3d={}));var egret3d;!function(e){var t;!function(e){var t=function(){function e(e,t){void 0===t&&(t=0),this._seek=t,this._data=new DataView(e,t)}return e.prototype.seek=function(e){this._seek=e},e.prototype.peek=function(){return this._seek},e.prototype.length=function(){return this._data.byteLength},e.prototype.canread=function(){return this._data.byteLength-this._seek},e.prototype.readStringAnsi=function(){var e=this._data.getUint8(this._seek);this._seek++;for(var t="",r=0;e>r;r++)t+=String.fromCharCode(this._data.getUint8(this._seek)),this._seek++;return t},e.utf8ArrayToString=function(e){for(var t=[],r=0;r<e.length;r++){var a=e[r];if(0==a)break;var i=0;if(a>224)i=(15&a)<<12,a=e[++r],i|=(63&a)<<6,a=e[++r],i|=63&a,t.push(String.fromCharCode(i));else if(a>192)i=(31&a)<<6,a=e[++r],i|=(63&a)<<6,t.push(String.fromCharCode(i));else{if(a>128)throw new Error("InvalidCharacterError");t.push(String.fromCharCode(e[r]))}}return t.join("")},e.prototype.readStringUtf8=function(){var t=this._data.getInt8(this._seek);this._seek++;var r=new Uint8Array(t);return this.readUint8Array(r),e.utf8ArrayToString(r)},e.prototype.readStringUtf8FixLength=function(t){var r=new Uint8Array(t);return this.readUint8Array(r),e.utf8ArrayToString(r)},e.prototype.readSingle=function(){var e=this._data.getFloat32(this._seek,!0);return this._seek+=4,e},e.prototype.readDouble=function(){var e=this._data.getFloat64(this._seek,!0);return this._seek+=8,e},e.prototype.readInt8=function(){var e=this._data.getInt8(this._seek);return this._seek+=1,e},e.prototype.readUInt8=function(){var e=this._data.getUint8(this._seek);return this._seek+=1,e},e.prototype.readInt16=function(){var e=this._data.getInt16(this._seek,!0);return this._seek+=2,e},e.prototype.readUInt16=function(){var e=this._data.getUint16(this._seek,!0);return this._seek+=2,e},e.prototype.readInt32=function(){var e=this._data.getInt32(this._seek,!0);return this._seek+=4,e},e.prototype.readUInt32=function(){var e=this._data.getUint32(this._seek,!0);return this._seek+=4,e},e.prototype.readUint8Array=function(e,t,r){void 0===e&&(e=null),void 0===t&&(t=0),void 0===r&&(r=-1),0>r&&(r=e.length);for(var a=0;r>a;a++)e[a]=this._data.getUint8(this._seek),this._seek++;return e},e.prototype.readUint8ArrayByOffset=function(e,t,r){void 0===r&&(r=0),0>r&&(r=e.length);for(var a=0;r>a;a++)e[a]=this._data.getUint8(t),t++;return e},e.prototype.readUint16Array=function(e,t,r){void 0===e&&(e=null),void 0===t&&(t=0),void 0===r&&(r=-1),0>r&&(r=e.length);for(var a=0;r>a;a++)e[a]=this.readUInt16();return e},e.prototype.readSingleArray=function(e,t,r){void 0===e&&(e=null),void 0===t&&(t=0),void 0===r&&(r=-1),0>r&&(r=e.length);for(var a=0;r>a;a++)e[a]=this.readSingle();return e},Object.defineProperty(e.prototype,"position",{get:function(){return this.peek()},set:function(e){this.seek(e)},enumerable:!0,configurable:!0}),e.prototype.readBoolean=function(){return this.readUInt8()>0},e.prototype.readByte=function(){return this.readUInt8()},e.prototype.readBytes=function(e,t,r){return void 0===e&&(e=null),void 0===t&&(t=0),void 0===r&&(r=-1),this.readUint8Array(e,t,r)},e.prototype.readUnsignedShort=function(){return this.readUInt16()},e.prototype.readUnsignedInt=function(){return this.readUInt32()},e.prototype.readFloat=function(){return this.readSingle()},e.prototype.readUTFBytes=function(t){var r=new Uint8Array(t);return e.utf8ArrayToString(this.readUint8Array(r))},e.prototype.readSymbolByte=function(){return this.readInt8()},e.prototype.readShort=function(){return this.readInt16()},e.prototype.readInt=function(){return this.readInt32()},e}();e.BinReader=t,__reflect(t.prototype,"egret3d.io.BinReader");var r=function(){function e(){var e=new ArrayBuffer(1024);this._length=0,this._buf=new Uint8Array(e),this._data=new DataView(this._buf.buffer),this._seek=0}return e.prototype.sureData=function(e){for(var t=this._buf.byteLength;t<this._length+e;)t+=1024;if(t!=this._buf.byteLength){for(var r=new Uint8Array(t),a=0;a<this._length;a++)r[a]=this._buf[a];this._buf=r,this._data=new DataView(this._buf.buffer)}this._length+=e},e.prototype.getLength=function(){return length},e.prototype.getBuffer=function(){return this._buf.buffer.slice(0,this._length)},e.prototype.seek=function(e){this._seek=e},e.prototype.peek=function(){return this._seek},e.prototype.writeInt8=function(e){this.sureData(1),this._data.setInt8(this._seek,e),this._seek++},e.prototype.writeUInt8=function(e){this.sureData(1),this._data.setUint8(this._seek,e),this._seek++},e.prototype.writeInt16=function(e){this.sureData(2),this._data.setInt16(this._seek,e,!0),this._seek+=2},e.prototype.writeUInt16=function(e){this.sureData(2),this._data.setUint16(this._seek,e,!0),this._seek+=2},e.prototype.writeInt32=function(e){this.sureData(4),this._data.setInt32(this._seek,e,!0),this._seek+=4},e.prototype.writeUInt32=function(e){this.sureData(4),this._data.setUint32(this._seek,e,!0),this._seek+=4},e.prototype.writeSingle=function(e){this.sureData(4),this._data.setFloat32(this._seek,e,!0),this._seek+=4},e.prototype.writeDouble=function(e){this.sureData(8),this._data.setFloat64(this._seek,e,!0),this._seek+=8},e.prototype.writeStringAnsi=function(e){var t=e.length;this.sureData(t+1),this._data.setUint8(this._seek,t),this._seek++;for(var r=0;t>r;r++)this._data.setUint8(this._seek,e.charCodeAt(r)),this._seek++},e.prototype.writeStringUtf8=function(t){var r=e.stringToUtf8Array(t);this.writeUInt8(r.length),this.writeUint8Array(r)},e.stringToUtf8Array=function(e){for(var t=[],r=0;r<e.length;r++){var a=e.charAt(r),i=a.charCodeAt(0);if(i>65535)throw new Error("InvalidCharacterError");if(i>128)if(2047>i){var n=i>>>6|192,s=63&i|128;t.push(n,s)}else{var n=i>>>12|224,s=i>>>6&63|128,o=63&i|128;t.push(n,s,o)}else t.push(i)}return t},e.prototype.writeStringUtf8DataOnly=function(t){var r=e.stringToUtf8Array(t);this.writeUint8Array(r)},e.prototype.writeUint8Array=function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=-1),0>r&&(r=e.length),this.sureData(r);for(var a=t;t+r>a;a++)this._data.setUint8(this._seek,e[a]),this._seek++},Object.defineProperty(e.prototype,"length",{get:function(){return this._seek},enumerable:!0,configurable:!0}),e.prototype.writeByte=function(e){this.writeUInt8(e)},e.prototype.writeBytes=function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=0),this.writeUint8Array(e,t,r)},e.prototype.writeUnsignedShort=function(e){this.writeUInt16(e)},e.prototype.writeUnsignedInt=function(e){this.writeUInt32(e)},e.prototype.writeFloat=function(e){this.writeSingle(e)},e.prototype.writeUTFBytes=function(t){var r=e.stringToUtf8Array(t);this.writeUint8Array(r)},e.prototype.writeSymbolByte=function(e){this.writeInt8(e)},e.prototype.writeShort=function(e){this.writeInt16(e)},e.prototype.writeInt=function(e){this.writeInt32(e)},e}();e.BinWriter=r,__reflect(r.prototype,"egret3d.io.BinWriter")}(t=e.io||(e.io={}))}(egret3d||(egret3d={}));var egret3d;!function(e){var t;!function(e){function t(e){return e.substring(0,e.lastIndexOf("/"))}function r(e,t){var r=e.split("/"),a=t.split("/");r.pop();for(var i=0;i<a.length;i++)"."!=a[i]&&(".."==a[i]?r.pop():r.push(a[i]));return r.join("/")}function a(e,t){var r="";e=e.replace("\\","/"),t=t.replace("\\","/");for(var a=e.split("/"),i=t.split("/"),n=a.length,s=i.length,o=0;a[o]==i[o]&&n>o&&s>o;)o++;for(var h=0;s-o-1>h;h++)r+="../";return a=a.slice(o,a.length),r+=a.join("/"),r=r.replace(" ","_")}function i(e){var t=e.substr(0,1).toLowerCase(),r=e.substr(1);return t+r}function n(e,t,r){return e.replace(new RegExp(t,"gm"),r)}function s(e){e+="";var t=e.replace(/(^\s+)|(\s+$)/g,"");return t=t.replace(/\s/g,"")}function o(e){var t=new Uint8Array(h(e)),r=new Blob([t]);return r}function h(e){for(var t=[],r=0;r<e.length;r++){var a=e.charAt(r),i=a.charCodeAt(0);if(i>65535)throw new Error("InvalidCharacterError");if(i>128)if(2047>i){var n=i>>>6|192,s=63&i|128;t.push(n,s)}else{var n=i>>>12|224,s=i>>>6&63|128,o=63&i|128;t.push(n,s,o)}else t.push(i)}return t}function l(e){for(var t=0,r=0;r<e.length;r++){var a=e.charCodeAt(r);t+=127>=a?1:2047>=a?2:65535>=a?3:4}return t}function c(e){return e.shiftKey?e.keyCode-32:e.keyCode}e.getPathByUrl=t,e.combinePath=r,e.getRelativePath=a,e.firstCharToLowerCase=i,e.replaceAll=n,e.trimAll=s,e.stringToBlob=o,e.stringToUtf8Array=h,e.caclStringByteLength=l,e.getKeyCodeByAscii=c}(t=e.utils||(e.utils={}))}(egret3d||(egret3d={}));var egret3d;!function(e){var t;!function(e){var t=function(){function t(){var e=window,t=e.AudioContext||e.webkitAudioContext||e.mozAudioContext||e.msAudioContext;t?(this._audioContext=new t,console.log("AudioContext inited --> "),console.log(this._audioContext)):console.warn("!Your browser does not support AudioContext")}return Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"audioContext",{get:function(){return this._audioContext},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isSupported",{get:function(){return!!this._audioContext},enumerable:!0,configurable:!0}),t.prototype.active=function(){if(this.isSupported){var e=this._audioContext.createBuffer(1,1,22050),t=this._audioContext.createBufferSource();t.buffer=e,t.connect(this._audioContext.destination),t.start()}},t.prototype.decodeAudioData=function(e,t,r){this._audioContext.decodeAudioData(e,function(e){return t(e)},function(){return r()})},t.prototype.getAudioListener=function(){return this.audioListener||(this.audioListener=new e.WebAudioListener),this.audioListener},t}();e.WebAudio=t,__reflect(t.prototype,"egret3d.sound.WebAudio")}(t=e.sound||(e.sound={}))}(egret3d||(egret3d={}));var Stats;!function(e){function t(e,t){void 0===t&&(t=500),null==a?(a=new n,a.container.style.position="absolute",a.container.style.left="0px",a.container.style.top="0px",e.appendChild(a.container)):e.appendChild(a.container),i&&r(),i=setInterval(function(){a.update()},t),egret3d.Performance.enable=!0}function r(){i&&clearInterval(i),null!=a&&a.container.parentNode&&a.container.parentNode.removeChild(a.container),egret3d.Performance.enable=!1}var a,i;e.show=t,e.hide=r;var n=function(){function e(){var e=this;this.mode=0,this.container=document.createElement("div"),this.container.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.7;z-index:1",this.container.addEventListener("click",function(t){t.preventDefault(),e.showPanel(++e.mode%e.container.children.length)},!1),this.fpsPanel=this.addPanel(new s("FPS","#0ff","#002")),this.msPanel=this.addPanel(new s("MS","#0f0","#020")),this.renderPanel=this.addPanel(new s("R%","#0f0","#020")),self.performance&&self.performance.memory&&(this.memPanel=this.addPanel(new s("MB","#f08","#201"))),this.showPanel(0)}return e.prototype.update=function(){var e=egret3d.Performance.getFPS(),t=egret3d.Performance.getEntity("fps"),r=egret3d.Performance.getEntity("all"),a=egret3d.Performance.getEntity("render");if(this.fpsPanel.update(e,100),this.msPanel.update(r.delta,200),this.renderPanel.update(Math.floor(a.delta/t.delta*100),100),this.memPanel){var i=performance.memory;this.memPanel.update(i.usedJSHeapSize/1048576,i.jsHeapSizeLimit/1048576)}},e.prototype.showPanel=function(e){for(var t=0;t<this.container.children.length;t++)this.container.children[t].style.display=t===e?"block":"none";this.mode=e},e.prototype.addPanel=function(e){return this.container.appendChild(e.canvas),e},e}();__reflect(n.prototype,"Stats");var s=function(){function e(e,t,r){this.name=e,this.fg=t,this.bg=r,this.min=1/0,this.max=0,this.PR=Math.round(window.devicePixelRatio||1),this.WIDTH=80*this.PR,this.HEIGHT=48*this.PR,this.TEXT_X=3*this.PR,this.TEXT_Y=2*this.PR,this.GRAPH_X=3*this.PR,this.GRAPH_Y=15*this.PR,this.GRAPH_WIDTH=74*this.PR,this.GRAPH_HEIGHT=30*this.PR,this.canvas=document.createElement("canvas"),this.canvas.width=this.WIDTH,this.canvas.height=this.HEIGHT,this.canvas.style.cssText="width:80px;height:48px",this.context=this.canvas.getContext("2d"),this.context.font="bold "+9*this.PR+"px Helvetica,Arial,sans-serif",this.context.textBaseline="top",this.context.fillStyle=r,this.context.fillRect(0,0,this.WIDTH,this.HEIGHT),this.context.fillStyle=t,this.context.fillText(e,this.TEXT_X,this.TEXT_Y),this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT),this.context.fillStyle=r,this.context.globalAlpha=.9,this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT)}return e.prototype.update=function(e,t){this.min=Math.min(this.min,e),this.max=Math.max(this.max,e),this.context.fillStyle=this.bg,this.context.globalAlpha=1,this.context.fillRect(0,0,this.WIDTH,this.GRAPH_Y),this.context.fillStyle=this.fg,this.context.fillText(Math.round(e)+" "+this.name+" ("+Math.round(this.min)+"-"+Math.round(this.max)+")",this.TEXT_X,this.TEXT_Y),this.context.drawImage(this.canvas,this.GRAPH_X+this.PR,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT,this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT),this.context.fillRect(this.GRAPH_X+this.GRAPH_WIDTH-this.PR,this.GRAPH_Y,this.PR,this.GRAPH_HEIGHT),this.context.fillStyle=this.bg,this.context.globalAlpha=.9,this.context.fillRect(this.GRAPH_X+this.GRAPH_WIDTH-this.PR,this.GRAPH_Y,this.PR,Math.round((1-e/t)*this.GRAPH_HEIGHT))},e}();__reflect(s.prototype,"Panel")}(Stats||(Stats={}));var egret3d;!function(e){var t;!function(t){var r=function(r){function a(){var t=null!==r&&r.apply(this,arguments)||this;return t.position=new e.Vector3,t.velocity=new e.Vector3,t}return __extends(a,r),a.prototype._init=function(){var e=t.WebAudio.instance.audioContext;this.source=e.createBufferSource(),this.panner=e.createPanner(),this.gain=e.createGain(),this.source.connect(this.panner),this.panner.connect(this.gain),this.gain.connect(e.destination)},Object.defineProperty(a.prototype,"maxDistance",{get:function(){return this.panner.maxDistance},set:function(e){this.panner.maxDistance=e},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"minDistance",{get:function(){return this.panner.refDistance},set:function(e){this.panner.refDistance=e},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"rollOffFactor",{get:function(){return this.panner.rolloffFactor},set:function(e){this.panner.rolloffFactor=e},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"distanceModel",{get:function(){return this.panner.distanceModel},set:function(e){"linear"===e||"inverse"===e||"exponential"===e?this.panner.distanceModel=e:console.warn("distanceModel: "+e+" Is not a valid parameter")},enumerable:!0,configurable:!0}),a.prototype.setPosition=function(e,t,r){this.position.x=e,this.position.y=t,this.position.z=r,this.panner.setPosition(e,t,r)},a.prototype.getPosition=function(){return this.position},a.prototype.setVelocity=function(e,t,r){this.position.x=e,this.position.y=t,this.position.z=r,this.panner.setVelocity(e,t,r)},a.prototype.getVelocity=function(){return this.velocity},a}(t.WebAudioChannel2D);t.WebAudioChannel3D=r,__reflect(r.prototype,"egret3d.sound.WebAudioChannel3D")}(t=e.sound||(e.sound={}))}(egret3d||(egret3d={}));var egret3d;!function(e){var t;!function(t){var r=function(){function r(){this.position=new e.Vector3,this.velocity=new e.Vector3,this.orientation=new e.Matrix,this.listener=t.WebAudio.instance.audioContext.listener}return r.prototype.setPosition=function(e,t,r){this.position.x=e,this.position.y=t,this.position.z=r,this.listener.setPosition(e,t,r)},r.prototype.getPosition=function(){return this.position},r.prototype.setVelocity=function(e,t,r){this.velocity.x=e,this.velocity.y=t,this.velocity.z=r,this.listener.setVelocity(e,t,r)},r.prototype.getVelocity=function(){return this.velocity},r.prototype.setOrientation=function(t){e.Matrix.copy(t,this.orientation),this.listener.setOrientation(-t.rawData[8],-t.rawData[9],-t.rawData[10],t.rawData[4],t.rawData[5],t.rawData[6])},r.prototype.getOrientation=function(){return this.orientation},r}();t.WebAudioListener=r,__reflect(r.prototype,"egret3d.sound.WebAudioListener")}(t=e.sound||(e.sound={}))}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(){function t(){}return t.init=function(t){this._isInit||(this._isInit=!0,this.keyboard=new e.KeyboardDevice(window),this.mouse=new e.MouseDevice(t),this.touch=new e.TouchDevice(t))},t.update=function(e){this.keyboard.update(),this.mouse.update(),this.touch.update()},t.isPressed=function(){if(this.mouse.isPressed(0))return!0;var t=this.touch.getTouch(0);return!t||1!=this.touch.touchCount||t.phase!=e.TouchPhase.MOVED&&t.phase!=e.TouchPhase.STATIONARY?!1:!0},t.wasPressed=function(){if(this.mouse.wasPressed(0))return!0;var t=this.touch.getTouch(0);return t&&1==this.touch.touchCount&&t.phase==e.TouchPhase.BEGAN?!0:!1},t.wasReleased=function(){if(this.mouse.wasReleased(0))return!0;var t=this.touch.getTouch(0);return!t||1!=this.touch.touchCount||t.phase!=e.TouchPhase.ENDED&&t.phase!=e.TouchPhase.CANCELED?!1:!0},t.getTouchPoint=function(){var e=this.touch.getTouch(0);return e?(this._touchPoint.x=e.position.x,this._touchPoint.y=e.position.y):(this._touchPoint.x=this.mouse.position.x,this._touchPoint.y=this.mouse.position.y),this._touchPoint},t._isInit=!1,t._touchPoint=new e.Vector2,t}();e.InputManager=t,__reflect(t.prototype,"egret3d.InputManager")}(egret3d||(egret3d={}));var egret3d;!function(e){var t={TAB:9,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,ESCAPE:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46,WIN:91},r=function(){function e(e,t){void 0===t&&(t={preventDefault:!1,stopPropagation:!1}),this._element=null,this._keymap={},this._lastmap={},this._keyDownHandler=this._handleKeyDown.bind(this),this._keyUpHandler=this._handleKeyUp.bind(this),this._keyPressHandler=this._handleKeyPress.bind(this),this._cacheKeyCodeMap={},this.attach(e),this.preventDefault=t.preventDefault,this.stopPropagation=t.stopPropagation}return e.prototype.attach=function(e){this._element&&this.detach(),this._element=e,this._element.addEventListener("keydown",this._keyDownHandler,!1),this._element.addEventListener("keypress",this._keyPressHandler,!1),this._element.addEventListener("keyup",this._keyUpHandler,!1)},e.prototype.detach=function(){this._element&&(this._element.removeEventListener("keydown",this._keyDownHandler,!1),this._element.removeEventListener("keypress",this._keyPressHandler,!1),this._element.removeEventListener("keyup",this._keyUpHandler,!1),this._element=null)},e.prototype._handleKeyDown=function(e){var t=e.keyCode||e.charCode,r=this._toKeyIdentifier(t);this._keymap[r]=!0,this.preventDefault&&e.preventDefault(),this.stopPropagation&&e.stopPropagation()},e.prototype._handleKeyPress=function(e){var t=e.keyCode||e.charCode;this._toKeyIdentifier(t);this.preventDefault&&e.preventDefault(),this.stopPropagation&&e.stopPropagation()},e.prototype._handleKeyUp=function(e){var t=e.keyCode||e.charCode,r=this._toKeyIdentifier(t);delete this._keymap[r],this.preventDefault&&e.preventDefault(),this.stopPropagation&&e.stopPropagation()},e.prototype._toKeyIdentifier=function(e){var r;if("string"==typeof e){var a=e.toUpperCase();if(!this._cacheKeyCodeMap[e]){var i=t[a]||a.charCodeAt(0);this._cacheKeyCodeMap[a]=i}r=this._cacheKeyCodeMap[a]}else r=e;for(var n=r.toString(16).toUpperCase(),s=n.length,o=0;4-s>o;o++)n="0"+n;return"U+"+n},e.prototype.update=function(){var e;for(e in this._lastmap)delete this._lastmap[e];for(e in this._keymap)this._keymap.hasOwnProperty(e)&&(this._lastmap[e]=this._keymap[e])},e.prototype.isPressed=function(e){var t=this._toKeyIdentifier(e);return this._keymap[t]},e.prototype.wasPressed=function(e){var t=this._toKeyIdentifier(e);return this._keymap[t]&&!this._lastmap[t]},e.prototype.wasReleased=function(e){var t=this._toKeyIdentifier(e);return!this._keymap[t]&&this._lastmap[t]},e}();e.KeyboardDevice=r,__reflect(r.prototype,"egret3d.KeyboardDevice")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(t){function r(r){var a=t.call(this)||this;return a._offsetX=0,a._offsetY=0,a._scaler=1,a.position=new e.Vector2,a.wheel=0,a._buttons=[!1,!1,!1],a._lastbuttons=[!1,!1,!1],a._element=null,a._upHandler=a._handleUp.bind(a),a._moveHandler=a._handleMove.bind(a),a._downHandler=a._handleDown.bind(a),a._wheelHandler=a._handleWheel.bind(a),a._contextMenuHandler=function(e){e.preventDefault()},a.attach(r),a}return __extends(r,t),r.prototype.updateOffsetAndScale=function(e,t,r){this._offsetX=e,this._offsetY=t,this._scaler=r},r.prototype.convertPosition=function(e,t){t.x=(e.clientX-this._offsetX)*this._scaler,t.y=(e.clientY-this._offsetY)*this._scaler},r.prototype.disableContextMenu=function(){this._element&&this._element.addEventListener("contextmenu",this._contextMenuHandler)},r.prototype.enableContextMenu=function(){this._element&&this._element.removeEventListener("contextmenu",this._contextMenuHandler)},r.prototype.attach=function(e){this._element&&this.detach(),this._element=e,this._element.addEventListener("mouseup",this._upHandler,!1),this._element.addEventListener("mousemove",this._moveHandler,!1),this._element.addEventListener("mousedown",this._downHandler,!1),this._element.addEventListener("mousewheel",this._wheelHandler,!1),this._element.addEventListener("DOMMouseScroll",this._wheelHandler,!1)},r.prototype.detach=function(){this._element&&(this._element.removeEventListener("mouseup",this._upHandler,!1),this._element.removeEventListener("mousemove",this._moveHandler,!1),this._element.removeEventListener("mousedown",this._downHandler,!1),this._element.removeEventListener("mousewheel",this._wheelHandler,!1),this._element.removeEventListener("DOMMouseScroll",this._wheelHandler,!1),this._element=null)},r.prototype.update=function(){this._lastbuttons[0]=this._buttons[0],this._lastbuttons[1]=this._buttons[1],this._lastbuttons[2]=this._buttons[2],this.wheel=0},r.prototype.isPressed=function(e){return this._buttons[e]},r.prototype.wasPressed=function(e){return this._buttons[e]&&!this._lastbuttons[e]},r.prototype.wasReleased=function(e){return!this._buttons[e]&&this._lastbuttons[e]},r.prototype._handleUp=function(e){this._buttons[e.button]=!1,this.convertPosition(e,this.position),this.dispatchEvent({type:"mouseup",x:this.position.x,y:this.position.y,identifier:e.button})},r.prototype._handleMove=function(e){this.convertPosition(e,this.position),this._buttons[e.button]&&this.dispatchEvent({type:"mousemove",x:this.position.x,y:this.position.y,identifier:e.button})},r.prototype._handleDown=function(e){this._buttons[e.button]=!0,this.convertPosition(e,this.position),this.dispatchEvent({type:"mousedown",x:this.position.x,y:this.position.y,identifier:e.button})},r.prototype._handleWheel=function(e){e.detail?this.wheel=-1*e.detail:e.wheelDelta?this.wheel=e.wheelDelta/120:this.wheel=0},r}(e.EventDispatcher);e.MouseDevice=t,__reflect(t.prototype,"egret3d.MouseDevice")}(egret3d||(egret3d={}));var egret3d;!function(e){var t;!function(e){e[e.BEGAN=0]="BEGAN",e[e.MOVED=1]="MOVED",e[e.STATIONARY=2]="STATIONARY",e[e.ENDED=3]="ENDED",e[e.CANCELED=4]="CANCELED"}(t=e.TouchPhase||(e.TouchPhase={}));var r=function(){function r(){this.altitudeAngle=Math.PI/2,this.azimuthAngle=0,this.deltaPosition=new e.Vector2,this.fingerId=0,this.maximumPossiblePressure=1,this.position=new e.Vector2,this.pressure=1,this.radius=new e.Vector2,this.type="Direct"}return r.prototype.set=function(r,a,i){this.altitudeAngle=r.rotationAngle,this.azimuthAngle=r.rotationAngle,a==t.BEGAN||a==t.STATIONARY?(this.deltaPosition.x=0,this.deltaPosition.y=0):(i.convertPosition(r,this.deltaPosition),e.Vector2.subtract(this.deltaPosition,this.position,this.deltaPosition)),this.fingerId=r.identifier,this.phase=a,i.convertPosition(r,this.position),this.pressure=r.force,this.radius.x=r.radiusX,this.radius.y=r.radiusY},r.create=function(){return this._pointPool.pop()||new r},r.release=function(e){this._pointPool.push(e)},r._pointPool=[],r}();e.TouchPoint=r,__reflect(r.prototype,"egret3d.TouchPoint");var a=function(e){function a(t,r){void 0===r&&(r={preventDefault:!0,stopPropagation:!0});var a=e.call(this)||this;return a._offsetX=0,a._offsetY=0,a._scaler=1,a._touchesMap={},a._touches=[],a.touchCount=0,a._startHandler=a._handleTouchStart.bind(a),a._endHandler=a._handleTouchEnd.bind(a),a._moveHandler=a._handleTouchMove.bind(a),a._cancelHandler=a._handleTouchCancel.bind(a),a._element=null,a.attach(t),a.preventDefault=r.preventDefault,a.stopPropagation=r.stopPropagation,a}return __extends(a,e),a.prototype.updateOffsetAndScale=function(e,t,r){this._offsetX=e,this._offsetY=t,this._scaler=r},a.prototype.convertPosition=function(e,t){t.x=(e.clientX-this._offsetX)*this._scaler,t.y=(e.clientY-this._offsetY)*this._scaler},a.prototype.attach=function(e){this._element&&this.detach(),this._element=e,this._element.addEventListener("touchstart",this._startHandler,!1),this._element.addEventListener("touchend",this._endHandler,!1),this._element.addEventListener("touchmove",this._moveHandler,!1),this._element.addEventListener("touchcancel",this._cancelHandler,!1)},a.prototype.detach=function(){this._element&&(this._element.removeEventListener("touchstart",this._startHandler,!1),this._element.removeEventListener("touchend",this._endHandler,!1),this._element.removeEventListener("touchmove",this._moveHandler,!1),this._element.removeEventListener("touchcancel",this._cancelHandler,!1),this._element=null)},a.prototype.update=function(){for(var e in this._touchesMap){var r=this._touchesMap[e];if(r.phase===t.BEGAN&&(r.phase=t.STATIONARY),r.phase===t.MOVED&&(r.phase=t.STATIONARY),r.phase===t.ENDED||r.phase===t.CANCELED){delete this._touchesMap[e];var a=this._touches.indexOf(r);a>-1&&this._touches.splice(a,1),this.touchCount--}}},a.prototype.getTouch=function(e){return this._touches[e]},a.prototype._getTouch=function(e){var t=this._touchesMap[e];return t||(t=r.create(),this._touchesMap[e]=t,this._touches.push(t),this.touchCount++),t},a.prototype._handleTouchStart=function(e){1==e.isScroll||this._element.userTyping||e.preventDefault();for(var r=0;r<e.changedTouches.length;r++){var a=e.changedTouches[r],i=a.identifier,n=this._getTouch(i);n.set(a,t.BEGAN,this),this.dispatchEvent({type:"touchstart",x:n.position.x,y:n.position.y,identifier:i})}this.preventDefault&&e.preventDefault(),this.stopPropagation&&e.stopPropagation()},a.prototype._handleTouchEnd=function(e){for(var r=0;r<e.changedTouches.length;r++){var a=e.changedTouches[r],i=a.identifier,n=this._getTouch(i);n.set(a,t.ENDED,this),this.dispatchEvent({type:"touchend",x:n.position.x,y:n.position.y,identifier:i})}this.preventDefault&&e.preventDefault(),this.stopPropagation&&e.stopPropagation()},a.prototype._handleTouchMove=function(e){1==e.isScroll||this._element.userTyping||e.preventDefault();for(var r=0;r<e.changedTouches.length;r++){var a=e.changedTouches[r],i=a.identifier,n=this._getTouch(i);n.set(a,t.MOVED,this),this.dispatchEvent({type:"touchmove",x:n.position.x,y:n.position.y,identifier:i})}this.preventDefault&&e.preventDefault(),this.stopPropagation&&e.stopPropagation()},a.prototype._handleTouchCancel=function(e){for(var r=0;r<e.changedTouches.length;r++){var a=e.changedTouches[r],i=a.identifier,n=this._getTouch(i);n.set(a,t.CANCELED,this),this.dispatchEvent({type:"touchend",x:n.position.x,y:n.position.y,identifier:i})}this.preventDefault&&e.preventDefault(),this.stopPropagation&&e.stopPropagation()},a}(e.EventDispatcher);e.TouchDevice=a,__reflect(a.prototype,"egret3d.TouchDevice")}(egret3d||(egret3d={}));var paper;!function(e){function t(t,r){n={};for(var i in r)n[i]=r[i];for(var s=null,o=0,h=t.objects;o<h.length;o++){var l=h[o],c=null;if(l.hashCode in n)c=n[l.hashCode];else{var u=e.serializeClassMap[l["class"]]||l["class"],p=egret.getDefinitionByName(u);p?(c=new p,n[l.hashCode]=c):console.error("Class "+l["class"]+" not defined.")}s=s||c}for(var d=0,f=t.objects;d<f.length;d++){var l=f[d];if(!(l.hashCode in r)){var c=n[l.hashCode];if(c){if(a(l,c),c instanceof e.GameObject)for(var _=0,g=c.components;_<g.length;_++){var m=g[_];m.gameObject=c}}else console.warn("Deserialize error.",l.hashCode)}}for(var v=0,y=t.objects;v<y.length;v++){var w=y[v],b=n[w.hashCode];if(b instanceof e.GameObject)for(var x=0,T=b.components;x<T.length;x++){var m=T[x];m.initialize(),e.EventPool.dispatchEvent("__create__",m)}}return n=null,s}function r(e){return n[e.hashCode]}function a(e,t){if(t.constructor.prototype.hasOwnProperty("deserialize"))t.deserialize(e);else for(var r in e)"hashCode"!==r&&"class"!==r&&("__deserializedIgnore"in t&&t.__deserializedIgnore.indexOf(r)>=0||(t[r]=i(e[r],t[r])))}function i(t,r){if(null===t||void 0===t)return t;switch(typeof t){case"function":return;case"object":if(r&&r.constructor.prototype.hasOwnProperty("deserialize"))return r.deserialize(t),r;if(Array.isArray(t)){r=[];for(var s=0,o=t.length;o>s;++s)r[s]=i(t[s]);return r}var h=t.hashCode,l=t["class"];
if(h){if(h in n)return n[h];if(l)if(l===e.findClassCodeFrom(e.Scene));else if(l===e.findClassCodeFrom(e.GameObject))for(var c=0,u=e.Application.sceneManager.getActiveScene().gameObjects;c<u.length;c++){var p=u[c];if(p.hashCode===h)return p}else for(var d=0,f=e.Application.sceneManager.getActiveScene().gameObjects;d<f.length;d++)for(var p=f[d],_=0,g=p.components;_<g.length;_++){var m=g[_];if(m.hashCode===h)return m}}else{if(!l){r={};for(var v in t)r[v]=i(t[v]);return r}l=e.serializeClassMap[l]||l;var y=egret.getDefinitionByName(l);if(y)return r=new y,a(t,r),r}return console.warn("Deserialize error.",t),null;default:return t}}var n;e.deserialize=t,e.getDeserializedObject=r}(paper||(paper={}));var egret3d;!function(e){var t=function(){function t(){}return t.SetMaxVertexAttribArray=function(e,r){for(var a=r;a<t._maxVertexAttribArray;a++)e.disableVertexAttribArray(a);t._maxVertexAttribArray=r},t.allocTexUnit=function(){var e=this._usedTextureUnits;return e>=this.capabilities.maxTextures&&console.warn("trying to use "+e+" texture units while this GPU supports only "+this.capabilities.maxTextures),this._usedTextureUnits+=1,e},t.resetTexUnit=function(){this._usedTextureUnits=0},t.activeTexture=function(e){this._activeTextureIndex!=e&&(this.webgl.activeTexture(t._texNumber[e]),this._activeTextureIndex=e)},t.showFace=function(t,r){if(void 0===r&&(r=!1),this._showFace!=t||this._frontFaceCW!=r){var a=this.webgl;if(t==e.ShowFaceStateEnum.ALL)a.disable(a.CULL_FACE);else{var i=t==e.ShowFaceStateEnum.CCW;r&&(i=!i),i?a.frontFace(a.CCW):a.frontFace(a.CW),a.cullFace(a.BACK),a.enable(a.CULL_FACE)}this._showFace=t,this._frontFaceCW=r}},t.zWrite=function(e){this._zWrite!==e&&(this.webgl.depthMask(e),this._zWrite=e)},t.zTest=function(e){if(this._zTest!==e){var t=this.webgl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this._zTest=e}},t.zTestMethod=function(e){this._zTestMethod!==e&&(this.webgl.depthFunc(e),this._zTestMethod=e)},t.blend=function(e,t,r,a,i,n){var s=this.webgl;this._blend!==e&&(e?s.enable(s.BLEND):s.disable(s.BLEND),this._blend=e),e&&(s.blendEquation(t),s.blendFuncSeparate(r,a,i,n))},t.useProgram=function(e){return this._program!=e?(this._program=e,this.webgl.useProgram(e),!0):!1},t.drawArrayTris=function(e,t){var r=this.webgl;r.drawArrays(r.TRIANGLES,e,t)},t.drawArrayLines=function(e,t){var r=this.webgl;r.drawArrays(r.LINES,e,t)},t.drawElementTris=function(e,t){var r=this.webgl;r.drawElements(r.TRIANGLES,t,r.UNSIGNED_SHORT,2*e)},t.drawElementLines=function(e,t){var r=this.webgl;r.drawElements(r.LINES,t,r.UNSIGNED_SHORT,2*e)},t.setStates=function(e,r){void 0===r&&(r=!1),t.showFace(e.state_showface,r),t.zWrite(e.state_zwrite),t.zTest(e.state_ztest),t.blend(e.state_blend,e.state_blendEquation,e.state_blendSrcRGB,e.state_blendDestRGB,e.state_blendSrcAlpha,e.state_blendDestALpha),e.state_ztest&&t.zTestMethod(e.state_ztest_method)},t.draw=function(r,a,i,n,s,o){if(void 0===s&&(s="base"),void 0===o&&(o=!1),a){var h=a.getShader();if(h){var l=h.passes[s+r.drawtype];if(l||(l=h.passes["base"+r.drawtype]),l)for(var c=this.webgl,u=0;u<l.length;u++){var p=l[u],d=e.GlProgram.get(p,r,a);this.setStates(p,o);var f=t.useProgram(d.program);d.uploadUniforms(a,r,f),d.bindAttributes(i,n,f);var _=i.glTFMesh.primitives[n],g=i.glTFAsset.getAccessor(_.attributes.POSITION),m=i.glTFAsset.getBufferOffset(g);if(void 0!==_.indices){var v=i.glTFAsset.getAccessor(_.indices);switch(_.mode){case 1:c.drawElements(c.LINES,v.count,c.UNSIGNED_SHORT,m);break;case 4:default:c.drawElements(c.TRIANGLES,v.count,c.UNSIGNED_SHORT,m)}}else switch(_.mode){case 1:c.drawArrays(c.LINES,m,g.count);break;case 4:default:c.drawArrays(c.TRIANGLES,m,g.count)}}}}},t.resetState=function(){this._activeTextureIndex=-1,this._showFace=void 0,this._zWrite=void 0,this._zTest=void 0,this._zTestMethod=void 0,this._blend=void 0,this._program=void 0},t.init=function(e,r){var a=e.getContext("webgl",r)||e.getContext("experimental-webgl",r);null==t._texNumber&&(this.webgl=a,t._texNumber=[],t._texNumber.push(a.TEXTURE0),t._texNumber.push(a.TEXTURE1),t._texNumber.push(a.TEXTURE2),t._texNumber.push(a.TEXTURE3),t._texNumber.push(a.TEXTURE4),t._texNumber.push(a.TEXTURE5),t._texNumber.push(a.TEXTURE6),t._texNumber.push(a.TEXTURE7),t._texNumber.push(a.TEXTURE8),t._texNumber.push(a.TEXTURE9),t.LEQUAL=a.LEQUAL,t.NEVER=a.NEVER,t.EQUAL=a.EQUAL,t.GEQUAL=a.GEQUAL,t.NOTEQUAL=a.NOTEQUAL,t.LESS=a.LESS,t.GREATER=a.GREATER,t.ALWAYS=a.ALWAYS,t.FUNC_ADD=a.FUNC_ADD,t.FUNC_SUBTRACT=a.FUNC_SUBTRACT,t.FUNC_REVERSE_SUBTRACT=a.FUNC_REVERSE_SUBTRACT,t.ONE=a.ONE,t.ZERO=a.ZERO,t.SRC_ALPHA=a.SRC_ALPHA,t.SRC_COLOR=a.SRC_COLOR,t.ONE_MINUS_SRC_ALPHA=a.ONE_MINUS_SRC_ALPHA,t.ONE_MINUS_SRC_COLOR=a.ONE_MINUS_SRC_COLOR,t.ONE_MINUS_DST_ALPHA=a.ONE_MINUS_DST_ALPHA,t.ONE_MINUS_DST_COLOR=a.ONE_MINUS_DST_COLOR,this.capabilities.initialize(a))},t._maxVertexAttribArray=0,t._usedTextureUnits=0,t._texNumber=null,t._activeTextureIndex=-1,t._frontFaceCW=!1,t.capabilities=new e.WebGLCapabilities,t}();e.WebGLKit=t,__reflect(t.prototype,"egret3d.WebGLKit")}(egret3d||(egret3d={}));var egret3d;!function(e){function t(){var e=paper.Application.sceneManager.getActiveScene(),t=e.gameObjects;r(t)}function r(e){u.length=0;for(var t={},r=0,n=e;r<n.length;r++){var s=n[r];a(s,t)}for(var o in t)for(var h=t[o],l=0,c=h;l<c.length;l++){var p=c[l];i(p)}u.length=0}function a(t,r,i){if(!(u.indexOf(t.hashCode)>=0)){u.push(t.hashCode);for(var n=0,s=t.transform.children;n<s.length;n++){var o=s[n];o&&a(o.gameObject,r,i)}if(t.isStatic){var h=t.getComponent(e.MeshFilter),l=t.getComponent(e.MeshRenderer);if(h&&h.mesh&&l&&l.materials&&!(l.materials.length<1)){var c=l.materials,d=h.mesh,f=l.lightmapIndex+"_";c.forEach(function(e){f=f+"_"+e.hashCode}),r[f]||(r[f]=[],r[f].push(new p));var _=r[f],g=_[_.length-1];g.vertexCount+d.vertexCount>e.MAX_VERTEX_COUNT_PER_BUFFER&&(g=new p,r[f].push(g)),g.root||(g.root=i?i:t,g.lightmapIndex=l.lightmapIndex,g.lightmapScaleOffset=l.lightmapScaleOffset);for(var m=d.glTFAsset,v=d.glTFMesh.primitives,y=0;y<v.length;y++){var w=v[y];for(var b in v[y].attributes){var x=b;g.meshAttribute[x]||(g.vertexBufferSize+=e.GLTFAsset.getAccessorTypeCount(m.getAccessor(w.attributes[b]).type)),g.meshAttribute[x]=x}g.indexBufferTotalSize+=m.getBufferLength(m.getAccessor(w.indices))/Uint16Array.BYTES_PER_ELEMENT}g.vertexCount+=d.vertexCount,g.instances.push(t)}}}}function i(t){var r=n(t),a=t.root;if(a){var i=a.getComponent(e.MeshFilter);i.mesh=r}}function n(t){e.Matrix.inverse(t.root.transform.getWorldMatrix(),c);var r=t.meshAttribute,a=t.lightmapScaleOffset,i=[],n=[],u={};for(var p in r)u[p]=[],i.push(p);for(var d=0,f=0,_=0,g=t.instances;_<g.length;_++){for(var m=g[_],v=m.getComponent(e.MeshFilter),y=m.getComponent(e.MeshRenderer),w=m.transform.getWorldMatrix(),b=y.lightmapScaleOffset,x=v.mesh,T=x.glTFAsset,E=x.glTFMesh.primitives,A=x.isSharedBuffer,D=!0,S=0;S<E.length;S++){var C=E[S];if(D){D=!A;for(var M=x.getVertexCount(S),R=E[S].attributes,L=T.createTypeArrayFromAccessor(T.getAccessor(R.POSITION)),O=0;O<L.length;O+=3)h.x=L[O+0],h.y=L[O+1],h.z=L[O+2],e.Matrix.transformVector3(h,w,l),e.Matrix.transformVector3(l,c,h),u.POSITION.push(h.x,h.y,h.z);if(r.NORMAL&&(R.NORMAL?s(T,R.NORMAL,u.NORMAL):o(u.NORMAL,M,[0,0,0])),r.TANGENT&&(R.TANGENT?s(T,R.TANGENT,u.TANGENT):o(u.TANGENT,M,[0,0,0,1])),r.COLOR_0&&(R.COLOR_0?s(T,R.COLOR_0,u.COLOR_0):o(u.COLOR_0,M,[1,1,1,1])),r.TEXCOORD_0&&(R.TEXCOORD_0?s(T,R.TEXCOORD_0,u.TEXCOORD_0):o(u.TEXCOORD_0,M,[0,0])),r.TEXCOORD_1)if(t.lightmapIndex>=0)for(var P=R.TEXCOORD_1?T.createTypeArrayFromAccessor(T.getAccessor(R.TEXCOORD_1)):T.createTypeArrayFromAccessor(T.getAccessor(R.TEXCOORD_0)),O=0;O<P.length;O+=2){var z=P[O+0],V=P[O+1];z=(z*b.x+b.z-a.z)/a.x,V=(V*b.y-b.y-b.w+a.w+a.y)/a.y,u.TEXCOORD_1.push(z,V)}else R.TEXCOORD_1?s(T,R.TEXCOORD_1,u.TEXCOORD_1):o(u.TEXCOORD_1,M,[0,0]);r.JOINTS_0&&(R.JOINTS_0?s(T,R.JOINTS_0,u.JOINTS_0):o(u.JOINTS_0,M,[0,0,0,0])),r.WEIGHTS_0&&(R.WEIGHTS_0?s(T,R.WEIGHTS_0,u.WEIGHTS_0):o(u.WEIGHTS_0,M,[1,0,0,0])),r.COLOR_1&&(R.COLOR_1?s(T,R.COLOR_1,u.COLOR_1):o(u.COLOR_1,M,[1,1,1,1]))}var F=T.createTypeArrayFromAccessor(T.getAccessor(C.indices));n[S]||(n[S]=[]);for(var O=0;O<F.length;O++){var B=F[O]+d;n[S].push(B),f=B>f?B:f}}d=f+1,v.mesh=null}var I=new Float32Array(t.vertexBufferSize*t.vertexCount),U=new Uint16Array(t.indexBufferTotalSize),N=0;for(var p in u)for(var G=u[p],k=0,W=G;k<W.length;k++){var V=W[k];I[N++]=V}var j=0;for(var p in n)for(var G=n[p],X=0,H=G;X<H.length;X++){var V=H[X];U[j++]=V}for(var K=new e.Mesh(I,U,n[0].length,i,1),Q=0,S=0;S<n.length;S++){var $=n[S].length;S>0&&(K.addSubMesh(Q,$,S),K.uploadSubIndexBuffer(S)),Q+=$}return K}function s(e,t,r){var a=e.createTypeArrayFromAccessor(e.getAccessor(t)),i=a.length,n=r.length;r.length+=i;for(var s=0;i>s;s++)r[n+s]=a[s]}function o(e,t,r){var a=e.length,i=r.length;e.length+=t*i;for(var n=0;t>n;n++)for(var s=0;i>s;s++)e[a++]=r[s]}e.MAX_VERTEX_COUNT_PER_BUFFER=5e4;var h=new e.Vector3,l=new e.Vector3,c=new e.Matrix,u=[];e.autoCombine=t,e.combine=r;var p=function(){function t(){this.vertexCount=0,this.vertexBufferSize=0,this.indexBufferTotalSize=0,this.lightmapIndex=-1,this.lightmapScaleOffset=new e.Vector4,this.meshAttribute={},this.root=null,this.instances=[]}return t}();__reflect(p.prototype,"CombineInstance")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(){function e(){}return e.getEntity=function(e){return this._entities[e]},e.getFPS=function(){var e=this.getEntity("fps");return e&&e.averageDelta?Math.floor(1e3/e.averageDelta):0},e.updateFPS=function(){this.enable&&(this.endCounter("fps"),this.startCounter("fps",60))},e._getNow=function(){return window.performance?window.performance.now():(new Date).getTime()},e.startCounter=function(e,t){if(void 0===t&&(t=1),this.enable){var r=this._entities[e];r||(r={start:0,end:0,delta:0,_cache:[],averageRange:1,averageDelta:0},this._entities[e]=r),r.start=this._getNow(),r.averageRange=t}},e.endCounter=function(e){if(this.enable){var t=this._entities[e];if(t&&(t.end=this._getNow(),t.delta=t.end-t.start,t.averageRange>1)){t._cache.push(t.delta);var r=t._cache.length;if(r>=t.averageRange){r>t.averageRange&&(t._cache.shift(),r--);for(var a=0,i=0;r>i;i++)a+=t._cache[i];t.averageDelta=a/r}}}},e._entities={},e.enable=!1,e}();e.Performance=t,__reflect(t.prototype,"egret3d.Performance")}(egret3d||(egret3d={}));var egret3d;!function(e){function t(){var t="precision "+e.WebGLKit.capabilities.maxPrecision+" float; \n";return t+="precision "+e.WebGLKit.capabilities.maxPrecision+" int; \n",t+="#define PI 3.14159265359 \n",t+="#define EPSILON 1e-6 \n",t+="float pow2( const in float x ) { return x*x; } \n",t+="#define LOG2 1.442695 \n",t+="#define RECIPROCAL_PI 0.31830988618 \n",t+="#define saturate(a) clamp( a, 0.0, 1.0 ) \n",t+="#define whiteCompliment(a) ( 1.0 - saturate( a ) ) \n"}function r(e,t){var r="";return e.lightCount>0&&(r+="#define USE_LIGHT "+e.lightCount+"\n",e.directLightCount>0&&(r+="#define USE_DIRECT_LIGHT "+e.directLightCount+"\n"),e.pointLightCount>0&&(r+="#define USE_POINT_LIGHT "+e.pointLightCount+"\n"),e.spotLightCount>0&&(r+="#define USE_SPOT_LIGHT "+e.spotLightCount+"\n"),e.receiveShadow&&(r+="#define USE_SHADOW \n",r+="#define USE_PCF_SOFT_SHADOW \n")),r}function a(e,r,a,i){var n=r.createShader(e);o||(o=t()),r.shaderSource(n,o+i+u(a.src)),r.compileShader(n);var s=r.getShaderParameter(n,r.COMPILE_STATUS);return s?n:(confirm("shader compile:"+a.name+" "+e+" error! ->"+r.getShaderInfoLog(n)+"\n. did you want see the code?")&&(r.deleteShader(n),alert(a.src)),null)}function i(e,t,r,i){var n,s=e.createProgram();n=t.name+i;var o=l[n];if(!o){var h=t.name+i;o=a(e.VERTEX_SHADER,e,t,i),l[h]=o}n=r.name+i;var u=c[n];if(!u){var p=r.name+i;u=a(e.FRAGMENT_SHADER,e,r,i),c[p]=u}e.attachShader(s,o),e.attachShader(s,u),e.linkProgram(s);var d=e.getProgramParameter(s,e.LINK_STATUS);return d?s:(alert("program compile: "+t.name+"_"+r.name+" error! ->"+e.getProgramInfoLog(s)),e.deleteProgram(s),null)}function n(t,r){for(var a={},i=t.getProgramParameter(r,t.ACTIVE_ATTRIBUTES),n=0;i>n;n++){var s=t.getActiveAttrib(r,n),o=s.name,h=new e.WebGLAttribute(t,r,s);a[o]=h}return a}function s(t,r){for(var a={},i=t.getProgramParameter(r,t.ACTIVE_UNIFORMS),n=0;i>n;n++){var s=t.getActiveUniform(r,n),o=s.name,h=new e.WebGLUniform(t,r,s);a[o]=h}return a}var o,h={_glesVertex:{name:"POSITION",normalized:!1},_glesNormal:{name:"NORMAL",normalized:!0},_glesTangent:{name:"TANGENT",normalized:!0},_glesMultiTexCoord0:{name:"TEXCOORD_0",normalized:!1},_glesMultiTexCoord1:{name:"TEXCOORD_1",normalized:!1},_glesColor:{name:"COLOR_0",normalized:!1},_glesColorEx:{name:"COLOR_1",normalized:!1},_glesBlendIndex4:{name:"JOINTS_0",normalized:!1},_glesBlendWeight4:{name:"WEIGHTS_0",normalized:!1}},l={},c={},u=function(t){function r(t,r){var a=e.ShaderChunk[r];if(void 0===a)throw new Error("Can not resolve #include <"+r+">");return u(a)}var a=/#include +<([\w\d.]+)>/g;return t.replace(a,r)},p=function(){function t(e,t,r,a){this._unifromsValue={},this._cacheContextVer=-1,this._cacheMeshVer=-1,this._cacheMeshEbo=-1,this._cacheMaterialVer=-1,this._samplerUnitMap={},this._cacheTextureUniforms=[],this.gl=e;var o=i(e,t,r,a);this.program=o,this._attributes=n(e,o),this._uniforms=s(e,o),this._allocTexUnits()}return t.get=function(a,i,n){var s=r(i,n),o=a.vShaderInfo.name+"_"+a.fShaderInfo.name+"_"+s;return this._programMap[o]||(this._programMap[o]=new t(e.WebGLKit.webgl,a.vShaderInfo,a.fShaderInfo,s)),this._programMap[o]},t.prototype._allocTexUnits=function(){var t=this,r=[],a=[];for(var i in this._uniforms)(this._uniforms[i].type==e.WEBGL_UNIFORM_TYPE.SAMPLER_2D||this._uniforms[i].type==e.WEBGL_UNIFORM_TYPE.SAMPLER_CUBE)&&(i.indexOf("[")>-1?r.push(i):a.push(i));var n=a.concat(r),s=0;n.forEach(function(e){t._samplerUnitMap[e]=s,s++})},t.prototype.bindAttributes=function(t,r,a){if(void 0===r&&(r=0),void 0===a&&(a=!1),a||this._cacheMesh!=t||this._cacheMeshVer!=t._version||this._cacheMeshEbo!=r)if(r>=0&&r<t.glTFMesh.primitives.length){this._cacheMesh=t,this._cacheMeshVer=t._version,this._cacheMeshEbo=r;var i=this.gl,n=t.glTFAsset,s=t.glTFMesh.primitives[r],o=t.ibos[r];i.bindBuffer(i.ARRAY_BUFFER,t.vbo),o&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,o);for(var l in this._attributes){var c=this._attributes[l],u=c.location,p=c.name,d=h[p],f=s.attributes[d.name];if(void 0!==f){var _=n.getAccessor(f),g=n.getBufferOffset(_),m=e.GLTFAsset.getAccessorTypeCount(_.type);i.vertexAttribPointer(u,m,c.format,d.normalized,0,g),i.enableVertexAttribArray(u)}else i.disableVertexAttribArray(u)}}else console.warn("Error arguments.")},t.prototype._updateRenderContextUniforms=function(e){for(var t in this._uniforms)switch(t){case"glstate_matrix_model":this.setMatrix4(t,e.matrix_m);break;case"glstate_matrix_mvp":this.setMatrix4(t,e.matrix_mvp);break;case"glstate_directLights[0]":e.directLightCount>0&&this.setFloatv(t,e.directLightArray);break;case"glstate_pointLights[0]":e.pointLightCount>0&&this.setFloatv(t,e.pointLightArray);break;case"glstate_spotLights[0]":e.spotLightCount>0&&this.setFloatv(t,e.spotLightArray);break;case"glstate_lightCount":this.setFloat(t,e.lightCount);break;case"glstate_directionalShadowMatrix[0]":this.setMatrix4v(t,e.directShadowMatrix);break;case"glstate_spotShadowMatrix[0]":this.setMatrix4v(t,e.spotShadowMatrix);break;case"glstate_directionalShadowMap[0]":for(var r=0;r<e.directShadowMaps.length;r++)e.directShadowMaps[r]&&this.setWebGLTexture("glstate_directionalShadowMap["+r+"]",e.directShadowMaps[r]);break;case"glstate_pointShadowMap[0]":for(var r=0;r<e.pointShadowMaps.length;r++)e.pointShadowMaps[r]&&this.setWebGLTexture("glstate_pointShadowMap["+r+"]",e.pointShadowMaps[r]);break;case"glstate_spotShadowMap[0]":for(var r=0;r<e.spotShadowMaps.length;r++)e.spotShadowMaps[r]&&this.setWebGLTexture("glstate_spotShadowMap["+r+"]",e.spotShadowMaps[r]);break;case"_LightmapTex":this.setTexture(t,e.lightmap);break;case"glstate_lightmapOffset":this.setVector4_2(t,e.lightmapOffset);break;case"glstate_lightmapUV":this.setFloat(t,e.lightmapUV);break;case"glstate_vec4_bones[0]":this.setVector4v(t,e.boneData);break;case"glstate_matrix_bones":this.setVector4v(t,e.boneData);break;case"glstate_referencePosition":this.setVector4_2(t,e.lightPosition);break;case"glstate_nearDistance":this.setFloat(t,e.lightShadowCameraNear);break;case"glstate_farDistance":this.setFloat(t,e.lightShadowCameraFar)}},t.prototype.setMatrix4=function(e,t){var r=this._uniforms[e];r.value=t.rawData,this.gl.uniformMatrix4fv(r.location,!1,r.value)},t.prototype.setMatrix4v=function(e,t){var r=this._uniforms[e];r.value=t,this.gl.uniformMatrix4fv(r.location,!1,r.value)},t.prototype.setVector4v=function(e,t){var r=this._uniforms[e];r.value=t,this.gl.uniform4fv(r.location,r.value)},t.prototype.setFloat=function(e,t){if(this._uniforms[e].value!=t){var r=this._uniforms[e];r.value=t,this.gl.uniform1f(r.location,r.value)}},t.prototype.setFloatv=function(e,t){var r=this._uniforms[e];r.value=t,this.gl.uniform1fv(r.location,r.value)},t.prototype.setVector4_2=function(e,t){var r=this._uniforms[e],a=r.value;a?(r.value=t,this.gl.uniform4fv(r.location,r.value)):(r.value=t,this.gl.uniform4fv(r.location,r.value))},t.prototype.setVector4=function(e,t){var r=this._uniforms[e],a=r.value;a?(a[0]!=t.x||a[1]!=t.y||a[2]!=t.z||a[3]!=t.w)&&(a[0]=t.x,a[1]=t.y,a[2]=t.z,a[3]=t.w,this.gl.uniform4fv(r.location,r.value)):(r.value=[t.x,t.y,t.z,t.w],this.gl.uniform4fv(r.location,r.value))},t.prototype.setTexture=function(t,r){var a=this._uniforms[t];a.value=r?r.glTexture:null;var i=this._samplerUnitMap[t],n=null!=a.value?a.value.texture:null,s=this._cacheTextureUniforms[i];s?(s.texture=n,s.dirty=!0):(this.gl.uniform1i(a.location,i),this._cacheTextureUniforms[i]={dirty:!0,texture:n,cube:a.type===e.WEBGL_UNIFORM_TYPE.SAMPLER_CUBE})},t.prototype.setWebGLTexture=function(t,r){var a=this._uniforms[t];a.value=r;var i=this._samplerUnitMap[t],n=null!=a.value?r:null,s=this._cacheTextureUniforms[i];s?(s.texture=n,s.dirty=!0):(this.gl.uniform1i(a.location,i),this._cacheTextureUniforms[i]={dirty:!0,texture:n,cube:a.type===e.WEBGL_UNIFORM_TYPE.SAMPLER_CUBE})},t.prototype._updateUniforms=function(t){for(var r in t){var a=t[r].type,i=t[r].value,n=this._uniforms[r];if(null!=n)switch(a){case e.UniformTypeEnum.Float:this.setFloat(r,i);break;case e.UniformTypeEnum.Floatv:this.setFloatv(r,i);break;case e.UniformTypeEnum.Float4:this.setVector4(r,i);break;case e.UniformTypeEnum.Float4v:this.setVector4v(r,i);break;case e.UniformTypeEnum.Float4x4:this.setMatrix4(r,i);break;case e.UniformTypeEnum.Float4x4v:this.setMatrix4(r,i);break;case e.UniformTypeEnum.Texture:this.setTexture(r,i)}}},t.prototype.uploadUniforms=function(t,r,a){void 0===a&&(a=!1);var i=this._cacheMaterial!==t||this._cacheMaterialVer!==t.version;i&&(this._updateUniforms(t.$uniforms),this._cacheMaterial=t,this._cacheMaterialVer=t.version);var n=this._cacheContext!=r||this._cacheContextVer!=r.version;if(n&&(this._updateRenderContextUniforms(r),this._cacheContext=r,this._cacheContextVer=r.version),a)for(var s=0;s<this._cacheTextureUniforms.length;s++){var o=this._cacheTextureUniforms[s];o&&(e.WebGLKit.activeTexture(s),this.gl.bindTexture(o.cube?this.gl.TEXTURE_CUBE_MAP:this.gl.TEXTURE_2D,o.texture))}else if(i||n)for(var s=0;s<this._cacheTextureUniforms.length;s++){var o=this._cacheTextureUniforms[s];o&&o.dirty&&(e.WebGLKit.activeTexture(s),this.gl.bindTexture(o.cube?this.gl.TEXTURE_CUBE_MAP:this.gl.TEXTURE_2D,o.texture))}},t._programMap={},t}();e.GlProgram=p,__reflect(p.prototype,"egret3d.GlProgram")}(egret3d||(egret3d={}));var egret3d;!function(e){var t=function(){function t(e,t,r,a,i){void 0===i&&(i=!0),this.gray=i,this.width=r,this.height=a;var n=e.createFramebuffer(),s=e.getParameter(e.FRAMEBUFFER_BINDING);e.bindFramebuffer(e.FRAMEBUFFER,n),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0);var o=new Uint8Array(this.width*this.height*4);if(o[0]=2,e.readPixels(0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,o),e.deleteFramebuffer(n),e.bindFramebuffer(e.FRAMEBUFFER,s),i){this.data=new Uint8Array(this.width*this.height);for(var h=0;r*a>h;h++)this.data[h]=o[4*h]}else this.data=o}return t.prototype.getPixel=function(t,r){var a=t*this.width|0,i=r*this.height|0;if(0>a||a>=this.width||0>i||i>=this.height)return 0;if(this.gray)return this.data[i*this.width+a];var n=4*(i*this.width+a);return new e.Color(this.data[n],this.data[n+1],this.data[n+2],this.data[n+3])},t}();e.TextureReader=t,__reflect(t.prototype,"egret3d.TextureReader");var r=function(){function e(e,t,r,a,i){void 0===a&&(a=!1),void 0===i&&(i=!1),this.width=t,this.height=r,this.fbo=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.fbo),(a||i)&&(this.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,this.renderbuffer),a&&i?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t,r),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,this.renderbuffer)):a?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t,r),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.renderbuffer)):(e.renderbufferStorage(e.RENDERBUFFER,e.STENCIL_INDEX8,t,r),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,this.renderbuffer)),e.bindRenderbuffer(e.RENDERBUFFER,null)),this.texture=e.createTexture(),this.fbo.width=t,this.fbo.height=r,e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,r,0,e.RGBA,e.UNSIGNED_BYTE,null),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0)}return e.prototype.use=function(e){e.bindFramebuffer(e.FRAMEBUFFER,this.fbo)},e.useNull=function(e){e.bindFramebuffer(e.FRAMEBUFFER,null)},e.prototype.dispose=function(e){null!=this.texture&&(e.deleteFramebuffer(this.renderbuffer),this.renderbuffer=null,e.deleteTexture(this.texture),this.texture=null)},e.prototype.caclByteLength=function(){return this.width*this.height*4},e.prototype.isFrameBuffer=function(){return!0},e}();e.GlRenderTarget=r,__reflect(r.prototype,"egret3d.GlRenderTarget",["egret3d.IRenderTarget","egret3d.ITexture"]);var a=function(){function e(e,t,r,a,i){void 0===a&&(a=!1),void 0===i&&(i=!1),this.activeCubeFace=0,this.width=t,this.height=r,this.fbo=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.fbo),(a||i)&&(this.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,this.renderbuffer),a&&i?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t,r),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,this.renderbuffer)):a?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t,r),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.renderbuffer)):(e.renderbufferStorage(e.RENDERBUFFER,e.STENCIL_INDEX8,t,r),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,this.renderbuffer)),e.bindRenderbuffer(e.RENDERBUFFER,null)),this.texture=e.createTexture(),this.fbo.width=t,this.fbo.height=r,e.bindTexture(e.TEXTURE_CUBE_MAP,this.texture),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);for(var n=0;6>n;n++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,e.RGBA,t,r,0,e.RGBA,e.UNSIGNED_BYTE,null);e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+this.activeCubeFace,this.texture,0)}return e.prototype.use=function(e){e.bindFramebuffer(e.FRAMEBUFFER,this.fbo),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+this.activeCubeFace,this.texture,0)},e.useNull=function(e){e.bindFramebuffer(e.FRAMEBUFFER,null)},e.prototype.dispose=function(e){null!=this.texture&&(e.deleteFramebuffer(this.renderbuffer),this.renderbuffer=null,e.deleteTexture(this.texture),this.texture=null)},e.prototype.caclByteLength=function(){return this.width*this.height*4},e.prototype.isFrameBuffer=function(){return!0},e}();e.GlRenderTargetCube=a,__reflect(a.prototype,"egret3d.GlRenderTargetCube",["egret3d.IRenderTarget","egret3d.ITexture"]);var i=function(){function e(e,t,r,a){void 0===t&&(t=1),void 0===r&&(r=!1),void 0===a&&(a=!0),this.loaded=!1,this.width=0,this.height=0,this.mipmap=!1,this.webgl=e,this.format=t,this.texture=e.createTexture()}return e.prototype.uploadImage=function(e,t,r,a,i,n,s){void 0===a&&(a=!0),void 0===i&&(i=!1),void 0===n&&(n=!1),void 0===s&&(s=!1),this.width=e.width,this.height=e.height,this.mipmap=t,this.loaded=!0,this.webgl.pixelStorei(this.webgl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a?1:0),this.webgl.pixelStorei(this.webgl.UNPACK_FLIP_Y_WEBGL,0),this.webgl.bindTexture(this.webgl.TEXTURE_2D,this.texture);var o=this.webgl.RGBA;2==this.format?o=this.webgl.RGB:3==this.format&&(o=this.webgl.LUMINANCE),this.webgl.texImage2D(this.webgl.TEXTURE_2D,0,o,o,this.webgl.UNSIGNED_BYTE,e),t?(this.webgl.generateMipmap(this.webgl.TEXTURE_2D),r?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MAG_FILTER,this.webgl.LINEAR),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MIN_FILTER,this.webgl.LINEAR_MIPMAP_LINEAR)):(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MAG_FILTER,this.webgl.NEAREST),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MIN_FILTER,this.webgl.NEAREST_MIPMAP_NEAREST))):r?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MAG_FILTER,this.webgl.LINEAR),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MIN_FILTER,this.webgl.LINEAR)):(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MAG_FILTER,this.webgl.NEAREST),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MIN_FILTER,this.webgl.NEAREST)),i?n&&s?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.MIRRORED_REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.MIRRORED_REPEAT)):n?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.MIRRORED_REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.REPEAT)):s?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.MIRRORED_REPEAT)):(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.REPEAT)):(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.CLAMP_TO_EDGE),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.CLAMP_TO_EDGE))},e.prototype.uploadByteArray=function(e,t,r,a,i,n,s,o){void 0===n&&(n=!1),void 0===s&&(s=!1),void 0===o&&(o=!1),this.width=r,this.height=a,this.mipmap=e,this.loaded=!0,this.webgl.pixelStorei(this.webgl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this.webgl.pixelStorei(this.webgl.UNPACK_FLIP_Y_WEBGL,0),this.webgl.bindTexture(this.webgl.TEXTURE_2D,this.texture);var h=this.webgl.RGBA;2==this.format?h=this.webgl.RGB:3==this.format&&(h=this.webgl.LUMINANCE),this.webgl.texImage2D(this.webgl.TEXTURE_2D,0,h,r,a,0,h,this.webgl.UNSIGNED_BYTE,i),e?(this.webgl.generateMipmap(this.webgl.TEXTURE_2D),t?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MAG_FILTER,this.webgl.LINEAR),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MIN_FILTER,this.webgl.LINEAR_MIPMAP_LINEAR)):(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MAG_FILTER,this.webgl.NEAREST),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MIN_FILTER,this.webgl.NEAREST_MIPMAP_NEAREST))):t?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MAG_FILTER,this.webgl.LINEAR),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MIN_FILTER,this.webgl.LINEAR)):(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MAG_FILTER,this.webgl.NEAREST),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MIN_FILTER,this.webgl.NEAREST)),n?s&&o?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.MIRRORED_REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.MIRRORED_REPEAT)):s?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.MIRRORED_REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.REPEAT)):o?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.MIRRORED_REPEAT)):(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.REPEAT)):(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.CLAMP_TO_EDGE),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.CLAMP_TO_EDGE))},e.prototype.caclByteLength=function(){var e=1;1==this.format?e=4:2==this.format&&(e=3);var t=this.width*this.height*e;return this.mipmap&&(t=t*(1-Math.pow(.25,10))/.75),t},e.prototype.getReader=function(e){if(void 0===e&&(e=!1),null!=this.reader){if(this.reader.gray!=e)throw new Error("get param diff with this.reader");return this.reader}if(1!=this.format)throw new Error("only rgba texture can read");return null==this.texture?null:(null==this.reader&&(this.reader=new t(this.webgl,this.texture,this.width,this.height,e)),this.reader)},e.prototype.dispose=function(e){null!=this.texture&&(e.deleteTexture(this.texture),this.texture=null)},e.prototype.isFrameBuffer=function(){return!1},e.formGrayArray=function(t,r,a,i){for(var n=!1,s=!0,o=new e(t,1,n,s),h=new Uint8Array(4*r.length),l=0;a>l;l++)for(var c=0;a>c;c++){var u=512*l+c,p=l*a+c;h[4*u]=255*r[p],h[4*u+1]=255*r[p],h[4*u+2]=255*r[p],h[4*u+3]=255}return o.uploadByteArray(n,s,512,512,h),o},e.staticTexture=function(t,r){var a=e.mapTexture[r];if(void 0!=a)return a;var i=!1,n=!0;a=new e(t,1,i,n);var s=new Uint8Array(4),o=1,h=1;if(s[0]=128,s[1]=0,s[2]=128,s[3]=255,"gray"==r)s[0]=128,s[1]=128,s[2]=128,s[3]=255;else if("white"==r)s[0]=255,s[1]=255,s[2]=255,s[3]=255;else if("black"==r)s[0]=0,s[1]=0,s[2]=0,s[3]=255;else if("grid"==r){o=256,h=256,s=new Uint8Array(o*o*4);for(var l=0;h>l;l++)for(var c=0;o>c;c++){var u=4*(l*o+c);(c-.5*o)*(l-.5*h)>0?(s[u]=0,s[u+1]=0,s[u+2]=0,s[u+3]=255):(s[u]=255,s[u+1]=255,s[u+2]=255,s[u+3]=255)}}return a.uploadByteArray(i,n,o,h,s),e.mapTexture[r]=a,a},e.mapTexture={},e}();e.GlTexture2D=i,__reflect(i.prototype,"egret3d.GlTexture2D",["egret3d.ITexture"]);var n=function(){function e(e,t,r,a,i,n,s,o,h){void 0===t&&(t=1),void 0===n&&(n=!0),void 0===s&&(s=!1),void 0===o&&(o=!1),void 0===h&&(h=!1),this.premultiply=!0,this.repeat=!1,this.mirroredU=!1,this.mirroredV=!1,this.width=0,this.height=0,this.webgl=e,this.texture=e.createTexture(),this.webgl.pixelStorei(this.webgl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n?1:0),this.webgl.pixelStorei(this.webgl.UNPACK_FLIP_Y_WEBGL,0),this.webgl.bindTexture(this.webgl.TEXTURE_2D,this.texture),this.format=t,this.formatGL=this.webgl.RGBA,2==t?this.formatGL=this.webgl.RGB:3==t&&(this.formatGL=this.webgl.LUMINANCE);var l=null;this.webgl.texImage2D(this.webgl.TEXTURE_2D,0,this.formatGL,r,a,0,this.formatGL,this.webgl.UNSIGNED_BYTE,l),i?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MAG_FILTER,this.webgl.LINEAR),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MIN_FILTER,this.webgl.LINEAR)):(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MAG_FILTER,this.webgl.NEAREST),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MIN_FILTER,this.webgl.NEAREST)),s?o&&h?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.MIRRORED_REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.MIRRORED_REPEAT)):o?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.MIRRORED_REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.REPEAT)):h?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.MIRRORED_REPEAT)):(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.REPEAT)):(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.CLAMP_TO_EDGE),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.CLAMP_TO_EDGE))
}return e.prototype.updateRect=function(e,t,r,a,i){this.webgl.bindTexture(this.webgl.TEXTURE_2D,this.texture),this.webgl.texSubImage2D(this.webgl.TEXTURE_2D,0,t,r,a,i,this.formatGL,this.webgl.UNSIGNED_BYTE,e)},e.prototype.updateRectImg=function(e,t,r){this.webgl.bindTexture(this.webgl.TEXTURE_2D,this.texture),this.webgl.texSubImage2D(this.webgl.TEXTURE_2D,0,t,r,this.formatGL,this.webgl.UNSIGNED_BYTE,e)},e.prototype.isFrameBuffer=function(){return!1},e.prototype.dispose=function(e){null!=this.texture&&(e.deleteTexture(this.texture),this.texture=null)},e.prototype.caclByteLength=function(){var e=1;1==this.format?e=4:2==this.format&&(e=3);var t=this.width*this.height*e;return t},e}();e.WriteableTexture2D=n,__reflect(n.prototype,"egret3d.WriteableTexture2D",["egret3d.ITexture"])}(egret3d||(egret3d={}));var egret3d;!function(e){var t;!function(e){e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.FLOAT=5126]="FLOAT",e[e.BYTE=65535]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT"}(t=e.WEBGL_ATTRIBUTE_TYPE||(e.WEBGL_ATTRIBUTE_TYPE={}));var r=function(){function e(e,t,r){this.gl=e,this.name=r.name,this.type=r.type,this.size=r.size,this.location=e.getAttribLocation(t,this.name),this.count=this._initCount(this.type),this.format=this._initFormat(e,this.type)}return e.prototype._initCount=function(e){var r=0;switch(e){case t.FLOAT:case t.BYTE:case t.UNSIGNED_BYTE:case t.UNSIGNED_SHORT:r=1;break;case t.FLOAT_VEC2:r=2;break;case t.FLOAT_VEC3:r=3;break;case t.FLOAT_VEC4:r=4}return r},e.prototype._initFormat=function(e,r){var a;switch(r){case t.FLOAT:case t.FLOAT_VEC2:case t.FLOAT_VEC3:case t.FLOAT_VEC4:a=e.FLOAT;break;case t.UNSIGNED_BYTE:a=e.UNSIGNED_BYTE;break;case t.UNSIGNED_SHORT:a=e.UNSIGNED_SHORT;break;case t.BYTE:a=e.BYTE}return a},e}();e.WebGLAttribute=r,__reflect(r.prototype,"egret3d.WebGLAttribute")}(egret3d||(egret3d={}));var paper;!function(e){function t(t){var r=null;t instanceof e.GameObject?(r=t.transform.parent,t.transform._parent=null):t instanceof egret3d.Transform&&(r=t.parent,t._parent=null);var a=e.serialize(t);t instanceof e.GameObject?t.transform._parent=r:t instanceof egret3d.Transform&&(t._parent=r);var i={};if("assets"in a)for(var n=0,s=a.assets;n<s.length;n++){var o=s[n];i[o.hashCode]=e.Asset.find(o.url)}return e.deserialize(a,i)}e.clone=t}(paper||(paper={}));